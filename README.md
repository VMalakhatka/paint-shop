# üõí Paint Shop (WooCommerce)

## üöÄ –ü–µ—Ä–µ–Ω–æ—Å –±–∞–∑—ã WordPress –∏–∑ –ª–æ–∫–∞–ª—å–Ω–æ–π —Å—Ä–µ–¥—ã (Local) –Ω–∞ —Å–µ—Ä–≤–µ—Ä
<details>
<summary><strong>deploy db to kreul.com.ua </strong></summary>

–î–ª—è –¥–µ–ø–ª–æ—è –∑–∞–ø—É—Å—Ç–∏ 

```bash
./export_and_push.sh
```
### –û–ø–∏—Å–∞–Ω–∏–µ –Ω—é–∞–Ω—Å–æ–≤
- `wp-content/deploy_db.sh` ‚Äî —Å–∫—Ä–∏–ø—Ç –¥–ª—è —Å–µ—Ä–≤–µ—Ä–∞.  
  –î–æ–ª–∂–µ–Ω –ª–µ–∂–∞—Ç—å –≤ –¥–æ–º–∞—à–Ω–µ–π –ø–∞–ø–∫–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è **vmalakhatka** –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ: 

  ~/deploy_db.sh 

```text
(–∏ –±—ã—Ç—å –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º: `chmod +x ~/deploy_db.sh`).

- `wp-content/export_and_push.sh` ‚Äî —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ –Ω–∞ Mac.  
–û–Ω:
1. –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –±–∞–∑—É –∏–∑ Local —á–µ—Ä–µ–∑ —Å–æ–∫–µ—Ç.
2. –°–∂–∏–º–∞–µ—Ç –¥–∞–º–ø.
3. –ö–æ–ø–∏—Ä—É–µ—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä.
4. –í—ã–∑—ã–≤–∞–µ—Ç `deploy_db.sh` –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞.

–û–±–∞ —Å–∫—Ä–∏–ø—Ç–∞ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –≤ `wp-content/`, —á—Ç–æ–±—ã –≤—Å–µ–≥–¥–∞ –±—ã–ª–∏ –ø–æ–¥ —Ä—É–∫–æ–π.

---

###  üîß –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞

1. –£–±–µ–¥–∏—Å—å, —á—Ç–æ SSH-–∫–ª—é—á –¥–æ–±–∞–≤–ª–µ–Ω –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è `vmalakhatka` –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ.  
 –ü—Ä–æ–≤–µ—Ä–∫–∞:

```bash
 ssh -p 2022 vmalakhatka@51.83.33.95(–∏ –±—ã—Ç—å –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º: `chmod +x ~/deploy_db.sh`).
```

- `wp-content/export_and_push.sh` ‚Äî —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ –Ω–∞ Mac.  
–û–Ω:
1. –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –±–∞–∑—É –∏–∑ Local —á–µ—Ä–µ–∑ —Å–æ–∫–µ—Ç.
2. –°–∂–∏–º–∞–µ—Ç –¥–∞–º–ø.
3. –ö–æ–ø–∏—Ä—É–µ—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä.
4. –í—ã–∑—ã–≤–∞–µ—Ç `deploy_db.sh` –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞.

–û–±–∞ —Å–∫—Ä–∏–ø—Ç–∞ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –≤ `wp-content/`, —á—Ç–æ–±—ã –≤—Å–µ–≥–¥–∞ –±—ã–ª–∏ –ø–æ–¥ —Ä—É–∫–æ–π.

--- 

### üîß –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞

1. –£–±–µ–¥–∏—Å—å, —á—Ç–æ SSH-–∫–ª—é—á –¥–æ–±–∞–≤–ª–µ–Ω –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è `vmalakhatka` –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ.  
 –ü—Ä–æ–≤–µ—Ä–∫–∞:
 
```bash
 ssh -p 2022 vmalakhatka@51.83.33.95
```

(–ª–æ–≥–∏–Ω –±–µ–∑ –ø–∞—Ä–æ–ª—è).
	2.	–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ –≤ ~/deploy_db.sh –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ø—Ä–∞–≤–∞ –Ω–∞ –∑–∞–ø—É—Å–∫:

```bash
chmod +x ~/deploy_db.sh
```


üöÄ Setup Environment (Local ‚Üí Server deploy)

–ß—Ç–æ–±—ã —Å–∫—Ä–∏–ø—Ç—ã deploy_safe.sh –∏ export_and_push.sh —Ä–∞–±–æ—Ç–∞–ª–∏ –±–µ–∑ –æ—à–∏–±–æ–∫ –∏ –ª–∏—à–Ω–∏—Ö –ø–∞—Ä–æ–ª–µ–π, –Ω—É–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ:

1. MySQL client

–ù–∞ macOS (Apple Silicon) —Å—Ç–∞–≤–∏–º –∫–ª–∏–µ–Ω—Ç:

```bash
brew install mysql-client
```
–î–æ–±–∞–≤–ª—è–µ–º –≤ PATH (~/.zshrc –∏ ~/.zprofile):

```bash

if [ -d /opt/homebrew/opt/mysql-client/bin ]; then
  export PATH="/opt/homebrew/opt/mysql-client/bin:$PATH"
fi

```

–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å –æ–±–æ–ª–æ—á–∫—É:

```bash

source ~/.zshrc

```

–ü—Ä–æ–≤–µ—Ä–∫–∞:

```bash

mysql --version
mysqldump --version


```


2. MySQL credentials (~/.my.cnf)

–°–æ–∑–¥–∞—ë–º —Ñ–∞–π–ª:

```bash

cat > ~/.my.cnf <<'EOF'
[client]
user=root
password=root
socket=/Users/admin/.local-mysql/mysqld.sock
EOF
chmod 600 ~/.my.cnf

```

‚ö†Ô∏è socket –∫–∞–∂–¥—ã–π —Ä–∞–∑ –º–æ–∂–µ—Ç –º–µ–Ω—è—Ç—å—Å—è –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ Local. –ß—Ç–æ–±—ã –Ω–µ –æ–±–Ω–æ–≤–ª—è—Ç—å —Ä—É–∫–∞–º–∏:

–∏ –≤ ~/.my.cnf –ø—Ä–æ–ø–∏—Å—ã–≤–∞–µ–º socket=/Users/admin/.local-mysql/mysqld.sock.

–¢–µ–ø–µ—Ä—å mysql –∏ mysqldump —Ä–∞–±–æ—Ç–∞—é—Ç –±–µ–∑ –ø–µ—Ä–µ–¥–∞—á–∏ -u/-p –∏ –±–µ–∑ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –ø—Ä–æ –ø–∞—Ä–æ–ª—å.

‚∏ª
3. SSH config (~/.ssh/config)

–°–æ–∑–¥–∞—ë–º/–¥–æ–ø–æ–ª–Ω—è–µ–º —Ñ–∞–π–ª ~/.ssh/config:

```bash

Host kreul
  HostName 51.83.33.95
  Port 2022
  User vmalakhatka
  ServerAliveInterval 15
  ServerAliveCountMax 4
  ConnectTimeout 10
  IdentityFile ~/.ssh/id_rsa

```

–¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –ø–æ–¥–∫–ª—é—á–∞—Ç—å—Å—è –∫–æ—Ä–æ—Ç–∫–æ:

```bash

ssh kreul
scp file.sql.gz kreul:/var/www/virtuals/kreul.com.ua/

```

4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

```bash 

ssh kreul "echo connected ok"
scp /etc/hosts kreul:/tmp/

```

5. –ó–∞–ø—É—Å–∫ –¥–µ–ø–ª–æ—è

–ö–æ–¥ ‚Üí —Å–µ—Ä–≤–µ—Ä:

```bash
dcode
```

–ë–∞–∑–∞ ‚Üí —Å–µ—Ä–≤–µ—Ä:

```bash
./export_and_push.sh
```

```text

üëâ –¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º:
	‚Ä¢	MySQL –¥–æ—Å—Ç—É–ø–µ–Ω —á–µ—Ä–µ–∑ mysqldump –±–µ–∑ –ø–∞—Ä–æ–ª–µ–π;
	‚Ä¢	SSH –∏–¥—ë—Ç –ø–æ –∞–ª–∏–∞—Å—É kreul;
	‚Ä¢	–í—Å–µ —Å–∫—Ä–∏–ø—Ç—ã (deploy_safe.sh, export_and_push.sh) —Ä–∞–±–æ—Ç–∞—é—Ç –±–µ–∑ –ª–∏—à–Ω–∏—Ö —Ñ–ª–∞–≥–æ–≤.

‚∏ª

```

‚ñ∂Ô∏è –≠–∫—Å–ø–æ—Ä—Ç –∏ –ø–µ—Ä–µ–Ω–æ—Å

–ù–∞ –ª–æ–∫–∞–ª—å–Ω–æ–º Mac, –≤ –ø–∞–ø–∫–µ wp-content –ø—Ä–æ–µ–∫—Ç–∞, –∑–∞–ø—É—Å—Ç–∏:

```bash
./export_and_push.sh
```

```text
–°–∫—Ä–∏–ø—Ç –≤—ã–≤–µ–¥–µ—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å:
	‚Ä¢	–≠–∫—Å–ø–æ—Ä—Ç –∏–∑ –ª–æ–∫–∞–ª—å–Ω–æ–π –ë–î ‚Üí /tmp/site-YYYYMMDD-HHMM.sql.gz
	‚Ä¢	–ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–º–ø–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
	‚Ä¢	–ë—ç–∫–∞–ø —Ç–µ–∫—É—â–µ–π –ë–î –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ ‚Üí ~/backup-db-YYYYMMDD-HHMM.sql.gz
	‚Ä¢	–ò–º–ø–æ—Ä—Ç –¥–∞–º–ø–∞ –≤ –ë–î —Å–µ—Ä–≤–µ—Ä–∞
	‚Ä¢	–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ URL —Å http://paint.local ‚Üí https://kreul.com.ua
	‚Ä¢	–°–±—Ä–æ—Å –ø—Ä–∞–≤–∏–ª –ø–µ—Ä–º–∞–ª–∏–Ω–∫–æ–≤ –∏ –∫—ç—à–∞

‚∏ª

üì¶ –ë—ç–∫–∞–ø—ã
	‚Ä¢	–ë—ç–∫–∞–ø—ã –±–∞–∑—ã —Å–æ–∑–¥–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤ ~ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:
	backup-db-YYYYMMDD-HHMM.sql.gz

	‚Ä¢	–ü—Ä–∏ —Å–±–æ–µ –≤—Å–µ–≥–¥–∞ –º–æ–∂–Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å:
```

```bash
gunzip -c ~/backup-db-YYYYMMDD-HHMM.sql.gz | mysql -u aphp -p kreul
```

```text
‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ —É —Ç–µ–±—è:
	‚Ä¢	–ü–æ–ª–Ω–∞—è –∫–æ–ø–∏—è –ª–æ–∫–∞–ª—å–Ω–æ–π –±–∞–∑—ã –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ.
	‚Ä¢	–í—Å–µ –≤–∏–¥–∂–µ—Ç—ã, –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏ –∫–æ–Ω—Ç–µ–Ω—Ç –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω—ã.
	‚Ä¢	–î–æ–º–µ–Ω –ø—Ä–∏–≤–µ–¥—ë–Ω –∫ https://kreul.com.ua.
	‚Ä¢	–ö—ç—à –∏ –ø–µ—Ä–º–∞–ª–∏–Ω–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã.
```
</details>

<details>
<summary><strong> –ü–µ—Ä–µ–Ω–æ—Å –∫–æ–¥–∞ (–∏–∑ GitHub)</strong></summary>

```text
–°–∫—Ä–∏–ø—Ç
	‚Ä¢	deploy_safe.sh ‚Äî –ª–µ–∂–∏—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –≤ ~/deploy_safe.sh.
	‚Ä¢	–ò—Å—Ö–æ–¥–Ω–∏–∫ —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏: wp-content/deploy_safe.sh.
	‚Ä¢	–µ—Å–ª–∏ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–ª deploy_safe.sh –∏ –æ–Ω —É–∂–µ –ø–æ–ø–∞–ª –Ω–∞ —Å–µ—Ä–≤–µ—Ä –≤ wp-content/
	‚Ä¢	—Ç–æ –µ–≥–æ –Ω–∞–¥–æ –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å –≤ HOME –∏ –æ—Ç–∫—Ä—ã—Ç—å –ø—Ä–∞–≤–∞ 
```

```bash
cp -f /var/www/virtuals/kreul.com.ua/wp-content/deploy_safe.sh ~/
chmod 755 ~/deploy_safe.sh
```

–ê–ª–≥–æ—Ä–∏—Ç–º
	1.	–ö–æ–¥ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤:

```bash
~/deploy/paint-shop
```
	2.	–ó–∞–ø—É—Å–∫ –¥–µ–ø–ª–æ—è:
```bash
~/deploy_safe.sh
```

```text
–°–∫—Ä–∏–ø—Ç:
	‚Ä¢	–¥–µ–ª–∞–µ—Ç git pull,
	‚Ä¢	–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–æ–≤—ã–µ –∫–æ–º–º–∏—Ç—ã,
	‚Ä¢	–±—ç–∫–∞–ø–∏—Ç –ø–ª–∞–≥–∏–Ω—ã –∏ —Ç–µ–º—ã (tar.gz –≤ ~/),
	‚Ä¢	—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–µ –∫–∞—Ç–∞–ª–æ–≥–∏:
	‚Ä¢	wp-content/mu-plugins/
	‚Ä¢	wp-content/themes/generatepress-child/
	‚Ä¢	wp-content/plugins/paint-core/
	‚Ä¢	wp-content/plugins/paint-shop-ux/
	‚Ä¢	wp-content/plugins/role-price/
	‚Ä¢	—á–∏—Å—Ç–∏—Ç –∫—ç—à WordPress.

–ü–æ–ª–µ–∑–Ω—ã–µ –æ–ø—Ü–∏–∏
	‚Ä¢	Dry run (–ø–æ–∫–∞–∑–∞—Ç—å, —á—Ç–æ –±—É–¥–µ—Ç —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ, –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π):
```
```bash
DRY_RUN=1 ~/deploy_safe.sh
```
	‚Ä¢	–õ–æ–≥: –≤–µ—Å—å –≤—ã–≤–æ–¥ –ø–∏—à–µ—Ç—Å—è –≤ ~/deploy.log.
```bash
tail -n 200 ~/deploy.log
```

```text
	‚Ä¢	–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–æ—Ç–∞—Ü–∏—è –ª–æ–≥–∞ (—Ö—Ä–∞–Ω–∏—Ç—Å—è ‚â§1MB).

‚∏ª

3. –ê–ª–∏–∞—Å—ã (–¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞)

–ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –≤ ~/.bashrc –∏–ª–∏ ~/.zshrc –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:
```
```bash
alias dcode="~/deploy_safe.sh"
alias ddb="~/deploy_db.sh site.sql.gz"
```
```md
## –û–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã (server side)

–°–∫—Ä–∏–ø—Ç—ã `deploy_db.sh` –∏ `export_and_push.sh` —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –≤ `wp-content/`, –Ω–æ –∏—Å–ø–æ–ª–Ω—è—é—Ç—Å—è —Å —Å–µ—Ä–≤–µ—Ä–∞ –∏–∑ –¥–æ–º–∞—à–Ω–µ–π –ø–∞–ø–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

–í–æ –≤—Ä–µ–º—è –¥–µ–ø–ª–æ—è `deploy_safe.sh` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
- –∫–æ–ø–∏—Ä—É–µ—Ç –∏—Ö –∏–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –≤ `$HOME`,
- –¥–µ–ª–∞–µ—Ç –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º–∏ (`chmod 755`),
- –¥–æ–±–∞–≤–ª—è–µ—Ç –∞–ª–∏–∞—Å—ã (–µ—Å–ª–∏ –∏—Ö –µ—â—ë –Ω–µ—Ç):
  - `dcode` ‚Üí `~/deploy_safe.sh`
  - `ddb`   ‚Üí `~/deploy_db.sh site.sql.gz`

> ‚ö†Ô∏è –°–∞–º `deploy_safe.sh` –Ω–µ –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏, —á—Ç–æ–±—ã –Ω–µ –º–µ–Ω—è—Ç—å —Å–∫—Ä–∏–ø—Ç –≤ –º–æ–º–µ–Ω—Ç –µ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è. –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å –µ–≥–æ –≤–µ—Ä—Å–∏—é —Å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è ‚Äî —Å–¥–µ–ª–∞–π—Ç–µ —ç—Ç–æ –≤—Ä—É—á–Ω—É—é –∏–ª–∏ –¥–µ—Ä–∂–∏—Ç–µ —à–∞–±–ª–æ–Ω `deploy_safe.sample.sh`.
```

```text
‚ö° –ü–æ—Å–ª–µ —ç—Ç–∏—Ö —à–∞–≥–æ–≤:
	‚Ä¢	–ë–∞–∑–∞ = –∫–∞–∫ –Ω–∞ –ª–æ–∫–∞–ª–∫–µ (–≤–∏–¥–∂–µ—Ç—ã, –ø–ª–∞–≥–∏–Ω—ã, –Ω–∞—Å—Ç—Ä–æ–π–∫–∏).
	‚Ä¢	–ö–æ–¥ = —Å–≤–µ–∂–∏–π –∏–∑ GitHub.
	‚Ä¢	–î–æ–º–µ–Ω –∏ –∫—ç—à —á–∏–Ω—è—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.

```
</details>

<details>
<summary><strong> üîí ~/full_backup.sh ‚Äî –ø–æ–ª–Ω—ã–π –±—ç–∫–∞–ø + —Ä–æ—Ç–∞—Ü–∏—è </strong></summary>

pull_latest_backup.sh

–ª–µ–∂–∏—Ç –≤ wp-content 
 –∑–∞–ø—É—Å—Ç–∏—Ç—å —Å —ç—Ç–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏

 ```bash
./pull_latest_backup.sh
 ```
 	3.	–ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –Ω–∞ –ª–µ—Ç—É:

```bash
PORT=2022 USER=vmalakhatka HOST=51.83.33.95 DEST_DIR=~/Downloads ~/pull_latest_backup.sh
```

–∏–ª–∏, –µ—Å–ª–∏ –±—ç–∫–∞–ø—ã –ª–µ–∂–∞—Ç –Ω–µ –≤ ~/backups:

```bash
REMOTE_DIR=/var/backups PATTERN="kreul-full-*.tar.gz" ~/pull_latest_backup.sh
```

```text
	‚Ä¢	–î–µ–ª–∞–µ—Ç –¥–∞–º–ø –ë–î
	‚Ä¢	–ê—Ä—Ö–∏–≤–∏—Ä—É–µ—Ç –≤–µ—Å—å –∫–∞—Ç–∞–ª–æ–≥ WP
	‚Ä¢	–°–∫–ª–µ–∏–≤–∞–µ—Ç –≤ –æ–¥–∏–Ω –∞—Ä—Ö–∏–≤ full-backup-YYYYmmdd-HHMMSS.tar.gz
	‚Ä¢	–•—Ä–∞–Ω–∏—Ç —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 5 –∞—Ä—Ö–∏–≤–æ–≤ (–º–µ–Ω—è–µ—Ç—Å—è –∫–æ–Ω—Å—Ç–∞–Ω—Ç–æ–π RETAIN)

–°–æ—Ö—Ä–∞–Ω–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –≤ ~ –∏ —Å–¥–µ–ª–∞–π –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º:
```
```bash
chmod +x ~/full_backup.sh
```
‚è∞ –ü–æ—Å—Ç–∞–≤–∏—Ç—å –Ω–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ (—Ä–∞–∑ –≤ –Ω–µ–¥–µ–ª—é)

–û—Ç–∫—Ä–æ–π cron:

```bash
crontab -e
```

–î–æ–±–∞–≤—å (–≤—Å, 04:00):
```bash
0 4 * * 0 ~/full_backup.sh >> ~/backup_cron.log 2>&1
```
‚¨áÔ∏è –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –±—ç–∫–∞–ø –Ω–∞ –ª–æ–∫–∞–ª—å–Ω—ã–π Mac

—Å –ø–æ–º–æ—â—å—é pull_latest_backup.sh 

–∏–ª–∏ –≤—Ä—É—á–Ω—É—é 

–í–∞—Ä–∏–∞–Ω—Ç A: –∑–∞–±—Ä–∞—Ç—å —Å–∞–º—ã–π —Å–≤–µ–∂–∏–π –∞—Ä—Ö–∏–≤ –æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥–æ–π

```bash
scp -P 2022 \
"vmalakhatka@51.83.33.95:$(ssh -p 2022 vmalakhatka@51.83.33.95 'ls -1t ~/backups/full-backup-*.tar.gz | head -1')" \
~/Downloads/
```

–∏–ª–∏ —Å –¥–æ–∫–∞—á–∫–æ–π —á–µ—Ä–µ–∑ rsync

```bash
LATEST=$(ssh -p 2022 vmalakhatka@51.83.33.95 \
  'ls -1t ~/backups/full-backup-*.tar.gz | head -1')

rsync -avzP -e "ssh -p 2022" \
  "vmalakhatka@51.83.33.95:$LATEST" \
  ~/Downloads/
```

–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –∞—Ä—Ö–∏–≤ –±—É–¥–µ—Ç –≤ ~/Downloads/.

–í–∞—Ä–∏–∞–Ω—Ç B: –∑–∞–±—Ä–∞—Ç—å –≤—Å–µ –±—ç–∫–∞–ø—ã

```bash
scp -P 2022 "vmalakhatka@51.83.33.95:~/backups/full-backup-*.tar.gz" ~/Backups/
```
(–°–æ–∑–¥–∞–π –∫–∞—Ç–∞–ª–æ–≥ –∑–∞—Ä–∞–Ω–µ–µ: mkdir -p ~/Backups.)

–í–∞—Ä–∏–∞–Ω—Ç C: —á–µ—Ä–µ–∑ rsync (—É–¥–æ–±–Ω–æ –¥–ª—è –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤/–¥–æ–∫–∞—á–∫–∏)

```bash
rsync -avP -e "ssh -p 2022" \
  vmalakhatka@51.83.33.95:backups/full-backup-*.tar.gz \
  ~/Backups/
```
üîπ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –±—ç–∫–∞–ø–æ–≤
```bash
ls -lh ~/backups/full-backup-*.tar.gz
```
üîπ –†–∞—Å–ø–∞–∫–æ–≤–∞—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —á—Ç–æ–±—ã –ø—Ä–æ–≤–µ—Ä–∏—Ç—å)
```bash
cd ~/Downloads
tar -xvzf full-backup-20250904-094059.tar.gz
```
```text
–¢–∞–º –±—É–¥—É—Ç:
	‚Ä¢	db-YYYYmmdd-HHMMSS.sql.gz ‚Äî –¥–∞–º–ø –±–∞–∑—ã,
	‚Ä¢	files-YYYYmmdd-HHMMSS.tar.gz ‚Äî –≤—Å–µ —Ñ–∞–π–ª—ã WordPress.
```

</details>


E-commerce –ø—Ä–æ–µ–∫—Ç –Ω–∞ –±–∞–∑–µ **WordPress + WooCommerce**, –∫–∞—Å—Ç–æ–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–¥ –∑–∞–¥–∞—á–∏ –º–∞–≥–∞–∑–∏–Ω–∞ –∫—Ä–∞—Å–æ–∫.

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
<details>
<summary><strong>–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞</strong></summary>

```text

üìÇ –¢–µ–ø–µ—Ä—å —Å—Ö–µ–º–∞:
	‚Ä¢	wp-config.php (–æ–±—â–∏–π –∑–∞–≥—Ä—É–∑—á–∏–∫, –≤ —Ä–µ–ø–æ)
	‚Ä¢	wp-config.common.php (–≤ —Ä–µ–ø–æ, –≤—Å—ë –æ–±—â–µ–µ)
	‚Ä¢	wp-config.local.php (–≤ .gitignore, –ª–æ–∫–∞–ª—å–Ω—ã–µ –∫—Ä–µ–¥—ã –∏ WP_DEBUG)
	‚Ä¢	wp-config.production.php (–≤ .gitignore, –ø—Ä–æ–¥–∞–∫—à–µ–Ω –∫—Ä–µ–¥—ã –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏)

‚∏ª

wp-content/
‚îú‚îÄ mu-plugins/
‚îÇ  ‚îú‚îÄ 00-composer-autoload.php       # –æ–±—â–∏–π vendor (autoload –¥–ª—è phpoffice/phpspreadsheet)
‚îÇ  ‚îú‚îÄ psu-force-per-page.php
‚îÇ  ‚îú‚îÄ stock-import-csv-lite.php
‚îÇ  ‚îú‚îÄ stock-locations-ui.php
‚îÇ  ‚îî‚îÄ stock-sync-to-woo.php
‚îÇ
‚îú‚îÄ plugins/
‚îÇ  ‚îú‚îÄ paint-core/
‚îÇ  ‚îÇ  ‚îú‚îÄ assets/css/catalog-qty.css
‚îÇ  ‚îÇ  ‚îú‚îÄ inc/‚Ä¶ (qty, allocator, role-price-importer, sku/gtin, stock-‚Ä¶)
‚îÇ  ‚îÇ  ‚îî‚îÄ paint-core.php
‚îÇ  ‚îÇ
‚îÇ  ‚îú‚îÄ paint-shop-ux/
‚îÇ  ‚îÇ  ‚îî‚îÄ paint-shop-ux.php
‚îÇ  ‚îÇ
‚îÇ  ‚îú‚îÄ role-price/
‚îÇ  ‚îÇ  ‚îî‚îÄ role-price.php
‚îÇ  ‚îÇ
‚îÇ  ‚îú‚îÄ pc-order-import-export/       # üöÄ –Ω–æ–≤—ã–π –ø–ª–∞–≥–∏–Ω Import/Export
‚îÇ  ‚îÇ  ‚îú‚îÄ pc-order-import-export.php # bootstrap
‚îÇ  ‚îÇ  ‚îú‚îÄ inc/
‚îÇ  ‚îÇ  ‚îÇ  ‚îú‚îÄ Plugin.php              # init, ajax —Ö—É–∫–∏
‚îÇ  ‚îÇ  ‚îÇ  ‚îú‚îÄ Helpers.php             # GTIN, qty, –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è, labels
‚îÇ  ‚îÇ  ‚îÇ  ‚îú‚îÄ Exporter.php            # –µ–∫—Å–ø–æ—Ä—Ç CSV/XLSX (Cart/Order)
‚îÇ  ‚îÇ  ‚îÇ  ‚îú‚îÄ ImporterCart.php        # —ñ–º–ø–æ—Ä—Ç —É –∫–æ—à–∏–∫
‚îÇ  ‚îÇ  ‚îÇ  ‚îú‚îÄ ImporterDraft.php       # —ñ–º–ø–æ—Ä—Ç —É —á–µ—Ä–Ω–µ—Ç–∫—É –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è
‚îÇ  ‚îÇ  ‚îÇ  ‚îî‚îÄ Ui.php                  # –∫–Ω–æ–ø–∫–∏, –ø–∞–Ω–µ–ª—ñ, inline JS
‚îÇ  ‚îÇ  ‚îî‚îÄ assets/
‚îÇ  ‚îÇ     ‚îî‚îÄ pcoe.js                 # JS (–º–æ–∂–Ω–∞ inline)
‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ ‚Ä¶ —ñ–Ω—à—ñ –ø–ª–∞“ë—ñ–Ω–∏ ‚Ä¶
‚îÇ
‚îú‚îÄ themes/generatepress-child/
‚îÇ  ‚îî‚îÄ style.css
‚îÇ
‚îî‚îÄ uploads/
```
</details>



## üöÄ –ö–∞–∫ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å –ø—Ä–æ–µ–∫—Ç
<details>
    <summary><strong> install </strong></summary>
1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å WordPress –∏ WooCommerce (—á–µ—Ä–µ–∑ WP-CLI):
   ```bash
   wp core download --locale=ru_RU
   wp core config --dbname=paint --dbuser=root --dbpass=root --dbhost=localhost
   wp core install --url=http://localhost --title="Paint Shop" --admin_user=admin --admin_password=admin --admin_email=admin@example.com
   wp plugin install woocommerce --activate
	2.	–ü–æ–¥—Ç—è–Ω—É—Ç—å –∫–∞—Å—Ç–æ–º–Ω—ã–µ —Ñ–∞–π–ª—ã:
   git clone git@github.com:VMalakhatka/paint-shop.git .
   	3.	–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–º—É:
    wp theme activate my-theme
    	4.	–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –∫–∞—Å—Ç–æ–º–Ω—ã–µ –ø–ª–∞–≥–∏–Ω—ã:

        wp plugin activate my-custom-plugin

</details>

## üéØ –ö–∞—Ä—Ç–∞ –º–æ–¥—É–ª–µ–π (—á—Ç–æ –∑–∞ —á—Ç–æ –æ—Ç–≤–µ—á–∞–µ—Ç)
<details>
### üß© MU Plugins
| –§–∞–π–ª / –ú–æ–¥—É–ª—å | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ | –ö–ª—é—á–µ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ / —Ö—É–∫–∏ | –ì–¥–µ –∏—Å–∫–∞—Ç—å –≤ –∞–¥–º–∏–Ω–∫–µ |
|---------------|------------|---------------------------|----------------------|
| **mu-plugins/psu-force-per-page.php** | –í—ã–¥–∞—ë—Ç –Ω–∞ –≤–∏—Ç—Ä–∏–Ω–∞—Ö —Ç–æ–≤–∞—Ä–æ–≤ `per_page = –∫–æ–ª–æ–Ω–∫–∏ √ó —Ä—è–¥—ã`. –ö–æ–ª–æ–Ω–∫–∏ –º–µ—Ä—è—é—Ç—Å—è –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ, –ø–∏—à—É—Ç—Å—è –≤ cookie. | –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã: `PSUFP_ROWS`, `PSUFP_FALLBACK_COLS`, `PSUFP_COOKIE_COLS`, `PSUFP_COOKIE_ROWS`, `PSUFP_DEBUG`, `PSUFP_ROWS_MOBILE`, `PSUFP_ROWS_MOBILE_BP` | ‚Äî (–∫–æ–¥–æ–≤—ã–π MU-–º–æ–¥—É–ª—å, –±–µ–∑ UI) |
| **mu-plugins/stock-import-csv-lite.php** | –õ—ë–≥–∫–∏–π –∏–º–ø–æ—Ä—Ç CSV (–æ—Å—Ç–∞—Ç–∫–∏ –ø–æ —Å–∫–ª–∞–¥–∞–º). | –ß—Ç–µ–Ω–∏–µ CSV, –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã. | Woo ‚Üí –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –∏–º–ø–æ—Ä—Ç–∞ |
| **mu-plugins/stock-locations-ui.php** | UI-–ø–∞—Ç—á–∏ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ—Å—Ç–∞—Ç–∫–æ–≤ –ø–æ —Å–∫–ª–∞–¥–∞–º (–≤ –∫–∞—Ç–∞–ª–æ–≥–µ –∏ PDP). | –•—É–∫–∏ WooCommerce + —à–∞–±–ª–æ–Ω—ã. | –í –∫–∞—Ä—Ç–æ—á–∫–∞—Ö —Ç–æ–≤–∞—Ä–∞ |

---

### üõ† Paint Core (–∫–∞—Å—Ç–æ–º–Ω—ã–π –ø–ª–∞–≥–∏–Ω)
| –§–∞–π–ª / –ú–æ–¥—É–ª—å | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ | –ö–ª—é—á–µ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ / —Ö—É–∫–∏ | –ì–¥–µ –∏—Å–∫–∞—Ç—å –≤ –∞–¥–º–∏–Ω–∫–µ |
|---------------|------------|---------------------------|----------------------|
| **paint-core/assets/css/catalog-qty.css** | –°—Ç–∏–ª–∏ qty/–∫–Ω–æ–ø–æ–∫ ¬´–≤ –∫–æ—Ä–∑–∏–Ω—É¬ª –≤ –∫–∞—Ç–∞–ª–æ–≥–µ. | CSS –∫–ª–∞—Å—Å—ã: `.loop-qty`, `.loop-buy-row`. | –í–Ω–µ—à–Ω–∏–π –≤–∏–¥ ‚Üí –†–µ–¥–∞–∫—Ç–æ—Ä —Ñ–∞–π–ª–æ–≤ —Ç–µ–º—ã |
| **paint-core/inc/catalog-qty-add-to-cart.php** | qty + –∫–Ω–æ–ø–∫–∞ ¬´–≤ –∫–æ—Ä–∑–∏–Ω—É¬ª –≤ –æ–¥–∏–Ω —Ä—è–¥, –ª–∏–º–∏—Ç—ã –∏ disabled-—Å–æ—Å—Ç–æ—è–Ω–∏—è. | –•—É–∫–∏: `woocommerce_after_shop_loop_item`. | –ö–∞—Ç–∞–ª–æ–≥ Woo |
| **paint-core/inc/header-allocation-switcher.php** | –ë–ª–æ–∫ ¬´–°–ø–∏—Å–∞–Ω–∏–µ: [—Ä–µ–∂–∏–º] [—Å–∫–ª–∞–¥]¬ª. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤—ã–±–æ—Ä –≤ —Å–µ—Å—Å–∏—é + cookie. –†–µ–∂–∏–º—ã: `auto`, `manual`, `single`. | Ajax `pc_set_alloc_pref`; cookie `pc_alloc_pref`. | UI –≤ —à–∞–ø–∫–µ |
| **paint-core/inc/order-allocator.php** | –†–∞—Å—á—ë—Ç –ø–ª–∞–Ω–∞ —Å–ø–∏—Å–∞–Ω–∏—è –ø–æ —Å–∫–ª–∞–¥–∞–º (`slu_allocation_plan`). | –§–∏–ª—å—Ç—Ä `slu_allocation_plan`. | ‚Äî |
| **paint-core/inc/order-attach-csv.php** | –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ CSV-–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è –∑–∞–∫–∞–∑–æ–≤. | –ü–∞—Ä—Å–µ—Ä CSV. | Woo ‚Üí –ó–∞–∫–∞–∑—ã |
| **paint-core/inc/role-price-importer.php** | –ò–º–ø–æ—Ä—Ç —Ü–µ–Ω –ø–æ —Ä–æ–ª—è–º (—Å—Ç—Ä–∞–Ω–∏—Ü–∞ –≤ –∞–¥–º–∏–Ω–∫–µ). | –ú–µ—Ç–∞-–∫–ª—é—á–∏: `_wpc_price_role_*`. | Woo ‚Üí –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –∏–º–ø–æ—Ä—Ç–∞ |
| **paint-core/inc/sku-gtin-admin-columns.php** | –î–æ–±–∞–≤–ª—è–µ—Ç SKU/GTIN –≤ —Ç–∞–±–ª–∏—Ü–µ —Ç–æ–≤–∞—Ä–æ–≤ –≤ –∞–¥–º–∏–Ω–∫–µ. | –§–∏–ª—å—Ç—Ä `manage_edit-product_columns`. | Woo ‚Üí –¢–æ–≤–∞—Ä—ã |
| **paint-core/inc/sku-gtin-front-emails.php** | –í—ã–≤–æ–¥ SKU/GTIN –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ –∏ –≤ email-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è—Ö. | –•—É–∫–∏ Woo –ø–∏—Å–µ–º. | Woo ‚Üí Email-—à–∞–±–ª–æ–Ω—ã |
| **paint-core/inc/stock-import-table.php** | –¢–∞–±–ª–∏—Ü–∞ –∏–º–ø–æ—Ä—Ç–∞ –æ—Å—Ç–∞—Ç–∫–æ–≤. | –°–æ–∑–¥–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü. | Woo ‚Üí –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –∏–º–ø–æ—Ä—Ç–∞ |
| **paint-core/inc/stock-locations-display.php** | –í–∏–¥–∂–µ—Ç—ã/—à–∞–±–ª–æ–Ω—ã –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ—Å—Ç–∞—Ç–∫–æ–≤ –ø–æ —Å–∫–ª–∞–¥–∞–º. | –í—Å—Ç–∞–≤–∫–∞ –±–ª–æ–∫–æ–≤ –æ—Å—Ç–∞—Ç–∫–æ–≤. | PDP / –∫–∞—Ç–∞–ª–æ–≥ |
| **paint-core/inc/config.php** | –ë–∞–∑–æ–≤—ã–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –∏ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª–∏. | ‚Äî | ‚Äî |
| **paint-core/inc/paint-core.php** | –ó–∞–≥—Ä—É–∑—á–∏–∫ –∏–Ω–∫–ª—É–¥–æ–≤. | `require_once`. | ‚Äî |
| **paint-core/paint-core.php** | –ì–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª –ø–ª–∞–≥–∏–Ω–∞ Paint Core. | –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–ª–∞–≥–∏–Ω–∞. | Woo ‚Üí –ü–ª–∞–≥–∏–Ω—ã |

---

### üé® UX & –î–æ–ø. –ø–ª–∞–≥–∏–Ω—ã
| –§–∞–π–ª / –ú–æ–¥—É–ª—å | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ | –ö–ª—é—á–µ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ / —Ö—É–∫–∏ | –ì–¥–µ –∏—Å–∫–∞—Ç—å –≤ –∞–¥–º–∏–Ω–∫–µ |
|---------------|------------|---------------------------|----------------------|
| **paint-shop-ux/paint-shop-ux.php** | –ú–µ–ª–∫–∏–µ UX-–ø—Ä–∞–≤–∫–∏ –º–∞–≥–∞–∑–∏–Ω–∞. | ‚Äî | ‚Äî |
| **role-price/role-price.php** | –¶–µ–Ω—ã –ø–æ —Ä–æ–ª—è–º: –≤—ã–±–æ—Ä –º–µ—Ç–∞-–∫–ª—é—á–∞ `_wpc_price_role_*`. | Woo —Ñ–∏–ª—å—Ç—Ä `woocommerce_product_get_price`. | Woo ‚Üí –¶–µ–Ω—ã –ø–æ —Ä–æ–ª—è–º |
| **stock-sync-to-woo/stock-sync-to-woo.php** | –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –æ—Å—Ç–∞—Ç–∫–æ–≤ –≤ Woo (–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –≤–Ω–µ—à–Ω–∏–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏). | –ö—Ä–æ–Ω-—Ö—É–∫–∏ / API. | Woo ‚Üí –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ |

---

### üé≠ –¢–µ–º–∞ (GeneratePress Child)
| –§–∞–π–ª / –ú–æ–¥—É–ª—å | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ | –ö–ª—é—á–µ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ / —Ö—É–∫–∏ | –ì–¥–µ –∏—Å–∫–∞—Ç—å –≤ –∞–¥–º–∏–Ω–∫–µ |
|---------------|------------|---------------------------|----------------------|
| **themes/generatepress-child/style.css** | –°–µ—Ç–∫–∞ –∫–∞—Ç–∞–ª–æ–≥–∞ (CSS Grid), –≤–∏–∑—É–∞–ª –∫–∞—Ä—Ç–æ—á–µ–∫/–∫–Ω–æ–ø–æ–∫/qty; —Å—Ç–∏–ª–∏ —Å–µ–ª–µ–∫—Ç–æ—Ä–æ–≤ ¬´–°–ø–∏—Å–∞–Ω–∏–µ/–°–∫–ª–∞–¥¬ª –≤ —à–∞–ø–∫–µ. | `grid-template-columns: repeat(auto-fit, minmax(...))` ‚Äî –º–µ–Ω—è–µ—Ç –∫–æ–ª-–≤–æ –∫–æ–ª–æ–Ω–æ–∫. | –í–Ω–µ—à–Ω–∏–π –≤–∏–¥ ‚Üí –†–µ–¥–∞–∫—Ç–æ—Ä —Ñ–∞–π–ª–æ–≤ —Ç–µ–º—ã |
| **themes/generatepress-child/functions.php** | –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Å—Ç–∏–ª–µ–π, —Ö–ª–µ–±–Ω—ã–µ –∫—Ä–æ—à–∫–∏. ‚ö†Ô∏è –õ–æ–≥–∏–∫–∞ `per_page` –≤—ã–Ω–µ—Å–µ–Ω–∞ –≤ MU. | ‚Äî | ‚Äî |
| **themes/generatepress-child/inc/header-allocation-switcher.php** | –î—É–±–ª–∏—Ä—É—é—â–∏–π –∫–æ–¥ —Å–µ–ª–µ–∫—Ç–æ—Ä–∞ —Å–∫–ª–∞–¥–∞ (UI –≤ —Ç–µ–º–µ). | Cookie `pc_alloc_pref`. | –®–∞–ø–∫–∞ —Ç–µ–º—ã |

---

### üóÑ SQL / –ò–º–ø–æ—Ä—Ç
| –§–∞–π–ª / –ú–æ–¥—É–ª—å | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ | –ö–ª—é—á–µ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ / —Ö—É–∫–∏ | –ì–¥–µ –∏—Å–∫–∞—Ç—å –≤ –∞–¥–º–∏–Ω–∫–µ |
|---------------|------------|---------------------------|----------------------|
| **(SQL) ¬´–ò–º–ø–æ—Ä—Ç —Ü–µ–Ω –ø–æ —Ä–æ–ª—è–º¬ª** | –ú–∞—Å—Å–æ–≤–∞—è –∑–∞–ø–∏—Å—å `_wpc_price_role_*` –ø–æ SKU. | –ú–µ—Ç–∞–∫–ª—é—á–∏: `_wpc_price_role_partner`, `_wpc_price_role_opt`, `_wpc_price_role_opt_osn`, `_wpc_price_role_schule`. | Woo ‚Üí –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –∏–º–ø–æ—Ä—Ç–∞ + –∑–∞–ø—É—Å–∫ SQL |
</details>

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—Å—Ç–∞—Ç–∫–∞–º–∏

<details>
<summary><strong>–û–ø–∏—Å–∞–Ω–∏–µ</strong></summary>

```text
0) –¢–µ—Ä–º–∏–Ω—ã –∏ —Ä–æ–ª–∏
	‚Ä¢	–°–∫–ª–∞–¥ (location) ‚Äî —Ç–µ—Ä–º–∏–Ω —Ç–∞–∫—Å–æ–Ω–æ–º–∏–∏ location.
	‚Ä¢	–ü–µ—Ä–µ—Å—á–∏—Ç–∞–Ω–Ω—ã–π –æ—Å—Ç–∞—Ç–æ–∫ —Ç–æ–≤–∞—Ä–∞ ‚Äî —Å—É–º–º–∞ –æ—Å—Ç–∞—Ç–∫–æ–≤ –ø–æ –≤—Å–µ–º —Å–∫–ª–∞–¥–∞–º.
	‚Ä¢	–ü–ª–∞–Ω —Å–ø–∏—Å–∞–Ω–∏—è (allocation plan) ‚Äî —Ä–∞–∑–±–∏–µ–Ω–∏–µ —Ç—Ä–µ–±—É–µ–º–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø–æ —Å–∫–ª–∞–¥–∞–º: { term_id => qty, ... }.
	‚Ä¢	Soft-—Ä–µ–∑–µ—Ä–≤ (–≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π) ‚Äî –∫–æ—Ä–∑–∏–Ω–∞/—á–µ–∫–∞—É—Ç —É—á–∏—Ç—ã–≤–∞—é—Ç ¬´–ø–ª–∞–Ω¬ª, –Ω–æ —Ñ–∏–∑–∏—á–µ—Å–∫–∏–π —Å—Ç–æ–∫ –µ—â—ë –Ω–µ –∏–∑–º–µ–Ω—ë–Ω.
	‚Ä¢	Hard-—Å–ø–∏—Å–∞–Ω–∏–µ ‚Äî —É–º–µ–Ω—å—à–µ–Ω–∏–µ _stock_at_* –∏ _stock –≤ –º–æ–º–µ–Ω—Ç, –∫–æ–≥–¥–∞ –∑–∞–∫–∞–∑ –ø–µ—Ä–µ—à—ë–ª –≤ processing/completed.

‚∏ª

1) –°—Ö–µ–º–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö

1.1. –ü–µ—Ä-—Å–∫–ª–∞–¥–æ–≤—ã–µ –æ—Å—Ç–∞—Ç–∫–∏ (per-term)
	‚Ä¢	–í postmeta –ø—Ä–æ–¥—É–∫—Ç–∞:
	‚Ä¢	_stock_at_{TERM_ID} ‚Äî –¥–µ—Å—è—Ç–∏—á–Ω–æ–µ —á–∏—Å–ª–æ (—Å—Ç—Ä–æ–∫–∞), –æ—Å—Ç–∞—Ç–æ–∫ –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º —Å–∫–ª–∞–¥–µ.
	‚Ä¢	–§–æ–ª–±—ç–∫ –¥–ª—è –≤–∞—Ä–∏–∞—Ü–∏–π: –µ—Å–ª–∏ —É –≤–∞—Ä–∏–∞—Ü–∏–∏ –º–µ—Ç–∞ –ø—É—Å—Ç–∞, —á–∏—Ç–∞–µ–º —É —Ä–æ–¥–∏—Ç–µ–ª—è.

```
–•–µ–ª–ø–µ—Ä—ã:
```php
read_term_stock($product_id, $term_id): float // —á–∏—Ç–∞–µ—Ç _stock_at_TERM
add_term_stock($product_id, $term_id, $delta): void // += delta, –Ω–µ < 0
recalc_total_stock($product_id): void // —Å—É–º–º–∏—Ä—É–µ—Ç –≤—Å–µ _stock_at_* -> _stock, _stock_status
```

```text

1.2. –°–≤–æ–¥–Ω—ã–π –æ—Å—Ç–∞—Ç–æ–∫
	‚Ä¢	_stock ‚Äî —Å—É–º–º–∞ –ø–æ –≤—Å–µ–º _stock_at_*.
	‚Ä¢	_stock_status ‚Äî instock/outofstock –ø–æ –ø—Ä–∞–≤–∏–ª—É (sum > 0).

recalc_total_stock() –≤—Å–µ–≥–¥–∞ –æ–±–Ω–æ–≤–ª—è–µ—Ç –æ–±–∞ –∏ —á–∏—Å—Ç–∏—Ç —Ç–æ–≤–∞—Ä–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∏–µ–Ω—Ç—ã WooCommerce.

1.3. –ü—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è —Å–ø–∏—Å–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
	‚Ä¢	–°–µ—Å—Å–∏—è/–∫—É–∫–∞ pc_alloc_pref:

```

```json

{ "mode": "auto|manual|single", "term_id": <int> }

```

```text
	–ß—Ç–µ–Ω–∏–µ/–∑–∞–ø–∏—Å—å: pc_get_alloc_pref() / pc_set_alloc_pref().

1.4. –ü–ª–∞–Ω –≤ –∫–æ—Ä–∑–∏–Ω–µ/–∑–∞–∫–∞–∑–µ
	‚Ä¢	–í –∫–æ—Ä–∑–∏–Ω–µ (—ç—Ñ–µ–º–µ—Ä–Ω–æ):
WC()->cart->cart_contents[$key]['pc_alloc_plan'] = {term_id=>qty,...}
	‚Ä¢	–í –∑–∞–∫–∞–∑–µ (—Å—Ç—Ä–æ–∫–∞ –∑–∞–∫–∞–∑–∞, –ø–µ—Ä–µ–Ω–æ—Å —Å –∫–æ—Ä–∑–∏–Ω—ã):
	‚Ä¢	_pc_alloc_plan ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π –∫–ª—é—á.
	‚Ä¢	–í –∑–∞–∫–∞–∑–µ (—Ñ–ª–∞–≥ –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏):
_pc_stock_reduced ‚Äî ¬´—Å–ø–∏—Å–∞–Ω–∏–µ –ø–æ –ø–ª–∞–Ω—É —É–∂–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ¬ª.

‚∏ª

2) –ú–æ–¥—É–ª–∏ –∏ –∏—Ö –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å

2.1. –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ (UI + —è–¥—Ä–æ)

–§–∞–π–ª: inc/header-allocation-switcher.php
	‚Ä¢	–†–µ–Ω–¥–µ—Ä–∏—Ç —Å–µ–ª–µ–∫—Ç —Ä–µ–∂–∏–º–æ–≤ –∏ —Å–∫–ª–∞–¥–æ–≤ –≤ —à–∞–ø–∫–µ.
	‚Ä¢	–î–µ—Ä–∂–∏—Ç –µ–¥–∏–Ω—É—é —Ç–æ—á–∫—É —Ä–∞—Å—á—ë—Ç–∞ –ø–ª–∞–Ω–∞:
	‚Ä¢	pc_build_alloc_plan(WC_Product $product, int $need): array
—É—á–∏—Ç—ã–≤–∞–µ—Ç mode/term_id, —Å–æ–±–∏—Ä–∞–µ—Ç –æ—Å—Ç–∞—Ç–∫–∏ –ø–æ –≤—Å–µ–º —Å–∫–ª–∞–¥–∞–º (—á–µ—Ä–µ–∑ –≤–∞—à–∏ SLW-—Ö–µ–ª–ø–µ—Ä—ã) –∏ —Å—Ç—Ä–æ–∏—Ç {term_id=>qty}.
	‚Ä¢	pc_calc_plan_for($product, $qty) ‚Äî –¥–µ–ª–µ–≥–∞—Ç–æ—Ä:
	1.	–¥–∞—ë—Ç —à–∞–Ω—Å –≤–Ω–µ—à–Ω–µ–º—É —Ñ–∏–ª—å—Ç—Ä—É slu_allocation_plan,
	2.	–∏–Ω–∞—á–µ ‚Äî pc_build_alloc_plan.
	‚Ä¢	–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—â–∏–µ –º–µ—Ö–∞–Ω–∏–∑–º—ã:
	‚Ä¢	AJAX pc_set_alloc_pref (—Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤—ã–±–æ—Ä).
	‚Ä¢	pc_recalc_alloc_plans_for_cart() ‚Äî –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç –ø–ª–∞–Ω –¥–ª—è –≤—Å–µ—Ö –ø–æ–∑–∏—Ü–∏–π –∫–æ—Ä–∑–∏–Ω—ã –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ä–µ–∂–∏–º–∞/—Å–∫–ª–∞–¥–∞, –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –≤ –∫–æ—Ä–∑–∏–Ω—É –∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ qty.

–î–µ—Ñ–æ–ª—Ç—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏: –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –ø—Ä–µ—Ñ–æ–≤ mode='auto', term_id=0.
–í–∞–∂–Ω–æ: —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∫–∞—Ç–∞–ª–æ–≥–∞ –ø–æ —Å–∫–ª–∞–¥—É –Ω–µ –≤–∫–ª—é—á–∞–µ—Ç—Å—è, –µ—Å–ª–∏ —Ä–µ–∂–∏–º –Ω–µ single –∏–ª–∏ —Å–∫–ª–∞–¥ –Ω–µ –≤—ã–±—Ä–∞–Ω.

2.2. Cart Guard (–æ–Ω–ª–∞–π–Ω-–≤–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ—Ä–∑–∏–Ω—ã)

–§–∞–π–ª: pc-cart-guard.php
	‚Ä¢	–ù–∞ –∫–∞–∂–¥–æ–º —Ä–µ–Ω–¥–µ—Ä–µ/–∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∫–ª–∞–º–ø–∏—Ç qty –∏ —É–¥–∞–ª—è–µ—Ç –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏.
	‚Ä¢	–ò—Å—Ç–æ—á–Ω–∏–∫ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏:
	‚Ä¢	–ï—Å–ª–∏ –µ—Å—Ç—å –≤–∞—à pc_build_stock_view($product) ‚Äî –±–µ—Ä—ë—Ç —Å—É–º–º–∞—Ä–Ω—É—é –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å (sum).
	‚Ä¢	–ò–Ω–∞—á–µ slu_available_for_add($product).
	‚Ä¢	–ò–Ω–∞—á–µ —Ñ–æ–ª–±—ç–∫ ‚Äî Woo _stock.
	‚Ä¢	–û–±–Ω–æ–≤–ª—è–µ—Ç max/step —É qty-–∏–Ω–ø—É—Ç–æ–≤.
	‚Ä¢	–†–∏—Å—É–µ—Ç –º–∏–Ω–∏-–ø–∞–Ω–µ–ª—å –æ—Å—Ç–∞—Ç–∫–æ–≤ –ø–æ —Å–∫–ª–∞–¥–∞–º (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω slu_render_stock_panel).
	‚Ä¢	–í–∫–ª—é—á–∞–µ—Ç –ª–æ–≥–∏, –≤—ã—á–∏—â–∞–µ—Ç wc-cart-fragments, –¥–µ—Ä–≥–∞–µ—Ç –∞–ø–¥–µ–π—Ç—ã –ø—Ä–∏ —Å–º–µ–Ω–µ —Ä–µ–∂–∏–º–∞/—Å–∫–ª–∞–¥–∞ (—Å–µ–ª–µ–∫—Ç–æ—Ä—ã).
	‚Ä¢	–•—É–∫–∏:
	‚Ä¢	woocommerce_cart_loaded_from_session, woocommerce_before_calculate_totals,
	‚Ä¢	–ø–ª—é—Å AJAX-—Ä—É—á–∫–∏ –¥–ª—è –ø–æ–¥—Å—Ç—Ä–æ–π–∫–∏ qty –∏ –º–∏–Ω–∏-–∏–Ω—Ñ–æ.

2.3. –ê–ª–ª–æ–∫–∞—Ç–æ—Ä –∑–∞–∫–∞–∑–∞ (–∂–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª —Å–ø–∏—Å–∞–Ω–∏—è)

–§–∞–π–ª: order-allocator.php (namespace PaintCore\Stock)
	‚Ä¢	–ù–∞ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–∫–∞–∑–∞: woocommerce_new_order ‚Üí build_allocation_plan_for_order()
‚Äî –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç –ø–ª–∞–Ω –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã –≤ –º–µ—Ç—É —Å—Ç—Ä–æ–∫ –∑–∞–∫–∞–∑–∞ (–µ—Å–ª–∏ –ø–ª–∞–Ω –µ—â—ë –Ω–µ –ª–µ–∂–∞–ª).
	‚Ä¢	–ù–∞ hard-—Å–ø–∏—Å–∞–Ω–∏–∏:
woocommerce_order_status_processing/completed ‚Üí reduce_stock_from_plan():
	1.	–≤–∫–ª—é—á–∞–µ—Ç ¬´–∫–æ—Ä–∏–¥–æ—Ä –∑–∞–ø–∏—Å–∏¬ª $GLOBALS['PC_ALLOW_STOCK_WRITE']=true,
	2.	–¥–ª—è –∫–∞–∂–¥–æ–π —Å—Ç—Ä–æ–∫–∏ –∑–∞–∫–∞–∑–∞ –±–µ—Ä—ë—Ç –ø–ª–∞–Ω (–∏–∑ –º–µ—Ç—ã; –µ—Å–ª–∏ –Ω–µ—Ç ‚Äî –ø–µ—Ä–µ—Å—á–∏—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ —Ç–æ—Ç –∂–µ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä),
	3.	—É–º–µ–Ω—å—à–∞–µ—Ç _stock_at_*, –¥–∞–ª–µ–µ recalc_total_stock() (–æ–±–Ω–æ–≤–∏—Ç _stock, _stock_status),
	4.	–ø–æ–º–µ—á–∞–µ—Ç –∑–∞–∫–∞–∑ _pc_stock_reduced = yes,
	5.	–∑–∞–∫—Ä—ã–≤–∞–µ—Ç –∫–æ—Ä–∏–¥–æ—Ä unset($GLOBALS['PC_ALLOW_STOCK_WRITE']);.
	‚Ä¢	–î–æ–ø. –∞–¥–º–∏–Ω-—ç–∫—à–µ–Ω—ã –≤ –∫–∞—Ä—Ç–æ—á–∫–µ –∑–∞–∫–∞–∑–∞:
	‚Ä¢	¬´Build stock allocation plan (PaintCore)¬ª
	‚Ä¢	¬´Reduce stock from plan (PaintCore)¬ª
	‚Ä¢	¬´RESTORE stock from plan (PaintCore)¬ª ‚Äî –æ–±—Ä–∞—Ç–Ω—ã–π —Ö–æ–¥ –¥–ª—è —Ç–µ—Å—Ç–æ–≤/–≤–æ–∑–≤—Ä–∞—Ç–∞.
	‚Ä¢	–ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å: –ø–æ–≤—Ç–æ—Ä–Ω–æ–µ –ø–æ–ø–∞–¥–∞–Ω–∏–µ –Ω–∞ —Ö—É–∫–∏ —Å–ø–∏—Å–∞–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ ‚Äî –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è _pc_stock_reduced.

2.4. –ë–∞—Ä—å–µ—Ä—ã –∏ –∞—É–¥–∏—Ç –∑–∞–ø–∏—Å–µ–π —Å—Ç–æ–∫–∞

MU-–ø–ª–∞–≥–∏–Ω—ã (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –≤ wp-content/mu-plugins):
	‚Ä¢	Stock Barrier (—Å–µ–ª–µ–∫—Ç–∏–≤–Ω—ã–π):
update_post_metadata —Å –≤—ã—Å–æ–∫–æ–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–æ—Å—Ç—å—é (9999):
	‚Ä¢	–ü—Ä–æ–ø—É—Å–∫–∞–µ—Ç –∑–∞–ø–∏—Å–∏:
	‚Ä¢	–≤ –∞–¥–º–∏–Ω–∫–µ/CRON,
	‚Ä¢	–≤–æ –≤—Ä–µ–º—è –Ω–∞—à–∏—Ö —Ü–µ–ª–µ–≤—ã—Ö —Ö—É–∫–æ–≤ (processing/completed),
	‚Ä¢	–ø—Ä–∏ —è–≤–Ω–æ–º ¬´–∫–æ—Ä–∏–¥–æ—Ä–µ¬ª $GLOBALS['PC_ALLOW_STOCK_WRITE'].
	‚Ä¢	–ë–ª–æ–∫–∏—Ä—É–µ—Ç –∑–∞–ø–∏—Å–∏ _stock, _stock_status, _stock_at_*, –µ—Å–ª–∏ –æ–Ω–∏ –ø—Ä–∏—Ö–æ–¥—è—Ç —Å —Ñ—Ä–æ–Ω—Ç–∞ –∏ —Å—Ç–µ–∫ —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ ¬´–ø–æ—Å—Ç–æ—Ä–æ–Ω–Ω–∏–µ¬ª SLW-—Ñ—É–Ω–∫—Ü–∏–∏ (helper-slw-frontend.php, class-slw-frontend-cart.php, helper-slw-order-item.php, class-slw-order-item.php).
	‚Ä¢	–ü–∏—à–µ—Ç –ª–æ–≥ [STOCK-BARRIER] ... (–ø–æ—á—Ç–∏ –∫–∞–∫ —É –≤–∞—Å).
	‚Ä¢	Stock Tap (—Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞):
–ª—ë–≥–∫–∏–π –ª–æ–≥–≥–µ—Ä [STOCK-TAP] UPDATE ... trace=..., —á—Ç–æ–±—ã –≤–∏–¥–µ—Ç—å, –∫—Ç–æ –ø—ã—Ç–∞–µ—Ç—Å—è –ø–∏—Å–∞—Ç—å –∏ –æ—Ç–∫—É–¥–∞.
–ü—Ä–∏–≤—è–∑—ã–≤–∞–µ—Ç—Å—è –∫ —Ç–µ–º –∂–µ –∫–ª—é—á–∞–º –º–µ—Ç—ã; —É–≤–∞–∂–∞–µ—Ç –æ–±—â–∏–µ —Ñ–ª–∞–≥–∏ WP_DEBUG, WP_DEBUG_LOG, WP_DEBUG_DISPLAY.
	‚Ä¢	–û—Ç–∫–ª—é—á–µ–Ω–∏–µ WooCommerce hold stock –∏ –∞–≤—Ç–æ—Å–ø–∏—Å–∞–Ω–∏–π –¥–æ –≤—ã—è—Å–Ω–µ–Ω–∏—è:
```

```php
add_filter('pre_option_woocommerce_hold_stock_minutes', '__return_empty_string', 9999);
add_filter('woocommerce_can_reduce_order_stock', '__return_false', 9999);
remove_action('woocommerce_checkout_order_processed', 'wc_maybe_reduce_stock_levels', 10);
remove_action('woocommerce_payment_complete',          'wc_maybe_reduce_stock_levels', 10);
remove_action('woocommerce_order_status_processing',   'wc_maybe_reduce_stock_levels', 10);
remove_action('woocommerce_order_status_completed',    'wc_maybe_reduce_stock_levels', 10);

```
–ò—Ç–æ–≥: –≤—Å–µ –≤–Ω–µ—à–Ω–∏–µ ¬´—Å–∞–º–æ–¥–µ—è—Ç–µ–ª—å–Ω—ã–µ¬ª –ø–æ–ø—ã—Ç–∫–∏ –º–µ–Ω—è—Ç—å —Å—Ç–æ–∫ –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è, –∞ –Ω–∞—à–∏ —Ü–µ–ª–µ–≤—ã–µ –ø—Ä–æ—Ü–µ–¥—É—Ä—ã –ø—Ä–æ—Ö–æ–¥—è—Ç.

3) –ü–æ—Ç–æ–∫–∏ (–ø—Ä–∏—Ö–æ–¥, —Ä–µ–∑–µ—Ä–≤, —Ä–∞—Å—Ö–æ–¥)

3.1. –ü—Ä–∏—Ö–æ–¥ (–æ–ø—Ä–∏—Ö–æ–¥–æ–≤–∞–Ω–∏–µ)

–í –∞–¥–º–∏–Ω–∫–µ –∏–ª–∏ —Å–∫—Ä–∏–ø—Ç–æ–º:

```php

add_term_stock($product_id, $term_id, +$qty);
recalc_total_stock($product_id);

```
–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: –¥–µ–ª–∞—Ç—å –±–∞—Ç—á–∞–º–∏ (bulk) –∏ –æ–¥–∏–Ω –æ–±—â–∏–π recalc_total_stock() –Ω–∞ –ø–æ–∑–∏—Ü–∏—é –ø–æ—Å–ª–µ –≤—Å–µ—Ö add_term_stock().

```text
3.2. –†–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏–µ (soft)
	‚Ä¢	–ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º Woo hold stock.
	‚Ä¢	–†–µ–∑–µ—Ä–≤ ‚Äî –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π: –∫–æ—Ä–∑–∏–Ω–∞ –∏ —á–µ–∫–∞—É—Ç —Å—á–∏—Ç–∞—é—Ç –ø–ª–∞–Ω —á–µ—Ä–µ–∑ pc_calc_plan_for() –∏ –∫–ª–∞–º–ø—è—Ç qty –ø–æ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏; –º–µ—Ç–∞ _stock* –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è.
	‚Ä¢	UI –º–æ–∂–µ—Ç –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å ¬´–ø–ª–∞–Ω¬ª –∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ (–º–∏–Ω–∏-–ø–∞–Ω–µ–ª–∏).

–ü–ª—é—Å—ã: –Ω–µ—Ç –ø–æ–¥–≤–∏—Å—à–∏—Ö —Ä–µ–∑–µ—Ä–≤–æ–≤, –Ω–µ—Ç –≥–æ–Ω–æ–∫/—Ç–∞–π–º–∞—É—Ç–æ–≤, —á—ë—Ç–∫–∏–π –º–æ–º–µ–Ω—Ç —Ä–∞—Å—Ö–æ–¥–∞.

3.3. –†–∞—Å—Ö–æ–¥ (hard) ‚Äî –¥–æ–∫—Ä—É—á–µ–Ω–æ

–ú–æ–º–µ–Ω—Ç: —Å–º–µ–Ω–∞ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–∫–∞–∑–∞ –Ω–∞ processing –∏–ª–∏ completed.

–ê–ª–≥–æ—Ä–∏—Ç–º reduce_stock_from_plan($order_or_id):
	1.	¬´–ö–æ—Ä–∏–¥–æ—Ä –∑–∞–ø–∏—Å–∏¬ª: $GLOBALS['PC_ALLOW_STOCK_WRITE']=true.
	2.	–î–ª—è –∫–∞–∂–¥–æ–≥–æ WC_Order_Item_Product:
	‚Ä¢	–ø–æ–ª—É—á–∏—Ç—å $plan = ensure_item_plan($item)
(–∏–∑ –º–µ—Ç—ã _pc_alloc_plan –∏–ª–∏ –ø–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å: –≤–Ω–µ—à–Ω–∏–π slu_allocation_plan ‚Üí pc_calc_plan_for() ‚Üí pc_build_alloc_plan()).
	‚Ä¢	–¥–ª—è –∫–∞–∂–¥–æ–π –ø–∞—Ä—ã (term_id => qty):
	‚Ä¢	add_term_stock($pid, $term_id, -$qty).
	3.	–î–ª—è –≤—Å–µ—Ö –∑–∞—Ç—Ä–æ–Ω—É—Ç—ã—Ö –ø—Ä–æ–¥—É–∫—Ç–æ–≤: recalc_total_stock($pid).
	4.	–ü–æ—Å—Ç–∞–≤–∏—Ç—å —Ñ–ª–∞–≥ _pc_stock_reduced = yes –Ω–∞ –∑–∞–∫–∞–∑ (–∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å).
	5.	–ó–∞–∫—Ä—ã—Ç—å –∫–æ—Ä–∏–¥–æ—Ä: unset($GLOBALS['PC_ALLOW_STOCK_WRITE']);.

–°–≤–æ–π—Å—Ç–≤–∞:
	‚Ä¢	–ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ (–ø–æ–≤—Ç–æ—Ä–Ω—ã–π –≤—ã–∑–æ–≤ ‚Äî no-op).
	‚Ä¢	–ë–∞—Ä—å–µ—Ä –Ω–µ –º–µ—à–∞–µ—Ç (–∫–æ—Ä–∏–¥–æ—Ä + —Ü–µ–ª–µ–≤—ã–µ —Ö—É–∫–∏).
	‚Ä¢	–°–æ–≤–º–µ—Å—Ç–∏–º–æ —Å —Ä—É—á–Ω—ã–º–∏ –∞–¥–º–∏–Ω-–¥–µ–π—Å—Ç–≤–∏—è–º–∏ ¬´Reduce from plan¬ª.

3.4. –í–æ–∑–≤—Ä–∞—Ç/–æ—Ç–º–µ–Ω–∞ (restore)

–ê–¥–º–∏–Ω-—ç–∫—à–µ–Ω ¬´RESTORE stock from plan (PaintCore)¬ª:
	‚Ä¢	–¥–ª—è –∫–∞–∂–¥–æ–π —Å—Ç—Ä–æ–∫–∏ –∑–∞–∫–∞–∑–∞ –±–µ—Ä—ë—Ç –ø–ª–∞–Ω –∏ –¥–µ–ª–∞–µ—Ç add_term_stock(..., +qty);
	‚Ä¢	recalc_total_stock($pid);
	‚Ä¢	–æ—á–∏—â–∞–µ—Ç _pc_stock_reduced.

–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: –¥–ª—è —á–∞—Å—Ç–∏—á–Ω–æ–≥–æ –≤–æ–∑–≤—Ä–∞—Ç–∞ ‚Äî –æ—Ñ–æ—Ä–º–∏—Ç—å —á–∞—Å—Ç–∏—á–Ω—ã–π –ø–ª–∞–Ω –∏–ª–∏ –ø—Ä–æ–≤–µ—Å—Ç–∏ –æ–ø—Ä–∏—Ö–æ–¥–æ–≤–∞–Ω–∏–µ —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏–π.

4) –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∫–∞—Ç–∞–ª–æ–≥–∞ –ø–æ —Å–∫–ª–∞–¥—É (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ —Ç–æ–≤–∞—Ä—ã –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Å–∫–ª–∞–¥–∞, –¥–µ–ª–∞–µ–º —ç—Ç–æ –≤ pre_get_posts, —Å—Ç—Ä–æ–≥–æ:
	‚Ä¢	–¢–æ–ª—å–∫–æ !is_admin() –∏ $q->is_main_query().
	‚Ä¢	–¢–æ–ª—å–∫–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∫–∞—Ç–∞–ª–æ–≥–∞: is_shop() || is_product_category() || is_product_tag().
	‚Ä¢	–¢–æ–ª—å–∫–æ –µ—Å–ª–∏ mode==='single' –∏ term_id>0.
	‚Ä¢	–û—Å—Ç–∞–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã (REST/AJAX/–≤–∏–¥–∂–µ—Ç—ã/–ø–æ–∏—Å–∫) –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º.

–î–æ–±–∞–≤–ª—è–µ–º —É—Å–ª–æ–≤–∏—è (–ø—Ä–∏–º–µ—Ä —á–µ—Ä–µ–∑ —Ç–∞–∫—Å–æ–Ω–æ–º–∏—é location, –∏–ª–∏ —á–µ—Ä–µ–∑ meta_query –ø–æ _stock_at_TERM > 0 ‚Äî –ø–æ —Å–∏—Ç—É–∞—Ü–∏–∏).

‚∏ª

5) –ü—É–±–ª–∏—á–Ω—ã–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã (API/—Ö—É–∫–∏)

5.1. –§—É–Ω–∫—Ü–∏–∏

```

```php

// –ü—Ä–µ—Ñ–µ—Ä–µ–Ω—Ü–∏–∏
pc_get_alloc_pref(): array
pc_set_alloc_pref(array $pref): void

// –†–∞—Å—á—ë—Ç –ø–ª–∞–Ω–æ–≤
pc_build_alloc_plan(WC_Product $p, int $need): array
pc_calc_plan_for(WC_Product $p, int $qty): array

// –ö–æ—Ä–∑–∏–Ω–∞
pc_recalc_alloc_plans_for_cart(): void

// –ó–∞–∫–∞–∑
PaintCore\Stock\build_allocation_plan_for_order($order_or_id): void
PaintCore\Stock\reduce_stock_from_plan($order_or_id): void

// –û—Å—Ç–∞—Ç–∫–∏
PaintCore\Stock\read_term_stock(int $pid, int $tid): float
PaintCore\Stock\add_term_stock(int $pid, int $tid, float $delta): void
PaintCore\Stock\recalc_total_stock(int $pid): void

```

```text

5.2. –•—É–∫–∏
	‚Ä¢	add_filter('slu_allocation_plan', callable $fn, 10, 4)
$fn($plan, WC_Product $product, int $need, string $context) ‚Üí {term_id=>qty} –∏–ª–∏ –ø—É—Å—Ç–æ.
–ö–æ–Ω—Ç–µ–∫—Å—Ç—ã: 'frontend-preview', 'order-fallback' (–∏ —Ç.–ø.).
	‚Ä¢	–•—É–∫–∏ Woo:
	‚Ä¢	woocommerce_checkout_create_order_line_item ‚Äî –ø–µ—Ä–µ–Ω–æ—Å –ø–ª–∞–Ω–∞ –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã.
	‚Ä¢	woocommerce_new_order ‚Äî —à—Ç–∞–º–ø–æ–≤–∫–∞ –ø–ª–∞–Ω–∞ –≤ —Å—Ç—Ä–æ–∫–∞—Ö.
	‚Ä¢	woocommerce_order_status_processing/completed ‚Äî —Å–ø–∏—Å–∞–Ω–∏–µ.

‚∏ª

6) –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –∏ –º–∏–≥—Ä–∞—Ü–∏–∏

6.1. –•—Ä–∞–Ω–∏–º—ã–µ –∫–ª—é—á–∏/—Ç–∏–ø—ã
	‚Ä¢	–ù–∞ –ø—Ä–æ–¥—É–∫—Ç–µ:
	‚Ä¢	_stock_at_{TERM_ID} ‚Äî DECIMAL(12,3) –∫–∞–∫ —Å—Ç—Ä–æ–∫–∞ –º–µ—Ç—ã (Woo —Ö—Ä–∞–Ω–∏—Ç —Å—Ç—Ä–æ–∫–∏).
	‚Ä¢	_stock ‚Äî DECIMAL(12,3) —Å—Ç—Ä–æ–∫–æ–π.
	‚Ä¢	_stock_status ‚Äî instock|outofstock.
	‚Ä¢	–í —Å—Ç—Ä–æ–∫–µ –∑–∞–∫–∞–∑–∞:
	‚Ä¢	_pc_alloc_plan ‚Äî array<int,int>.
	‚Ä¢	_stock_location_id/_slug ‚Äî –ø–µ—Ä–≤—ã–π —Å–∫–ª–∞–¥ –∏–∑ –ø–ª–∞–Ω–∞ (–¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å –æ—Ç—á—ë—Ç–∞–º–∏).
	‚Ä¢	–ù–∞ –∑–∞–∫–∞–∑–µ:
	‚Ä¢	_pc_stock_reduced ‚Äî yes|null.

6.2. –ú–∏–≥—Ä–∞—Ü–∏–∏
	‚Ä¢	–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è: –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–æ–≤–∞—Ä–∞ —Å –∑–∞–≤–µ–¥—ë–Ω–Ω—ã–º–∏ —Å–∫–ª–∞–¥–∞–º–∏ ‚Äî –≤—ã—Å—Ç–∞–≤–∏—Ç—å _stock_at_* –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç—å recalc_total_stock().
	‚Ä¢	–ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è (–∏—Å–ø–æ–ª—å–∑—É–µ–º postmeta).
	‚Ä¢	–ü–µ—Ä–≤–∏—á–Ω—ã–π –ø–µ—Ä–µ—Å—á—ë—Ç: —Å–∫—Ä–∏–ø—Ç-–æ–¥–Ω–æ—Ä–∞–∑–∫–∞, –∫–æ—Ç–æ—Ä—ã–π —Å—É–º–º–∏—Ä—É–µ—Ç legacy-–æ—Å—Ç–∞–Ω–∫ –∏ —Ä–∞—Å–∫–ª–∞–¥—ã–≤–∞–µ—Ç –ø–æ —Å–∫–ª–∞–¥–∞–º (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ).

‚∏ª

7) –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è / –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
	‚Ä¢	WP_DEBUG, WP_DEBUG_LOG, WP_DEBUG_DISPLAY ‚Äî —É–ø—Ä–∞–≤–ª—è—é—Ç –æ–±—ä—ë–º–æ–º –ª–æ–≥–æ–≤; –Ω–∞ –ø—Ä–æ–¥–µ: false/false/false (–∏–ª–∏ LOG=true —Ç–æ–ª—å–∫–æ –Ω–∞ –≤—Ä–µ–º—è —Ä–∞—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è).
	‚Ä¢	–ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –≤ MU-–ø–ª–∞–≥–∏–Ω–∞—Ö:
	‚Ä¢	—Ç—É–º–±–ª–µ—Ä—ã –ª–æ–≥–æ–≤ (PC_CART_GUARD_DEBUG –∏ —Ç.–ø.).
‚Ä¢	–ù–∞—Å—Ç—Ä–æ–π–∫–∏ Woo:
	‚Ä¢	hold_stock_minutes ‚Üí –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –ø—É—Å—Ç–æ –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ.
	‚Ä¢	–û—Ç–∫–ª—é—á–µ–Ω—ã –≤—ã–∑–æ–≤—ã wc_maybe_reduce_stock_levels –Ω–∞ —Ñ—Ä–æ–Ω—Ç–æ–≤—ã—Ö —Å–æ–±—ã—Ç–∏—è—Ö.

8) –õ–æ–≥–∏, –∞—É–¥–∏—Ç, –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
	‚Ä¢	Stock Tap:
[STOCK-TAP] UPDATE post={id} key={meta} old={x} new={y} user={id} url={uri} trace={stack}
–í–∫–ª—é—á–∞—Ç—å –Ω–∞ –ª–æ–∫–∞–ª–∫–µ / –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–∞ –ø—Ä–æ–¥–µ.
	‚Ä¢	Stock Barrier:
[STOCK-BARRIER] blocked (SLW): post=... key=... trace=...
	‚Ä¢	Cart-guard: pc(cart): ... ‚Äî –ø–æ–º–æ–≥–∞–µ—Ç –æ—Ç–ª–∞–≤–ª–∏–≤–∞—Ç—å –∫–ª–∞–º–ø—ã, max, –ø–µ—Ä–µ—Å—á—ë—Ç—ã.
	‚Ä¢	–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —Å–±–æ—Ä –ª–æ–≥–æ–≤ –≤ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π storage –∏ —Ñ–∏–ª—å—Ç—Ä—ã –ø–æ –ø—Ä–µ—Ñ–∏–∫—Å–∞–º.

KPI/–∞–ª–µ—Ä—Ç—ã:
	‚Ä¢	–ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å—É–º–º—ã _stock_at_* –∏ _stock (–ø–æ—Ä–æ–≥ > 0.001).
	‚Ä¢	–ü–æ—è–≤–ª–µ–Ω–∏–µ STOCK-BARRIER blocked > N –∑–∞ –æ–∫–Ω–æ –≤—Ä–µ–º–µ–Ω–∏.
	‚Ä¢	–ü–æ–ø—ã—Ç–∫–∞ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ —Å–ø–∏—Å–∞–Ω–∏—è –∑–∞–∫–∞–∑–∞ –±–µ–∑ _pc_stock_reduced.

9) –¢–µ—Å—Ç-–∫–µ–π—Å—ã / —á–µ–∫-–ª–∏—Å—Ç—ã

9.1. –Æ–Ω–∏—Ç—ã (–º–æ–∂–Ω–æ –∫–∞–∫ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã)
	‚Ä¢	pc_build_alloc_plan():
	‚Ä¢	mode=auto|manual|single, —Ä–∞–∑–Ω—ã–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ –æ—Å—Ç–∞—Ç–∫–æ–≤, –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞ primary –∏ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Å–∫–ª–∞–¥–∞.
	‚Ä¢	reduce_stock_from_plan():
	‚Ä¢	–ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å (–≤—Ç–æ—Ä–æ–π –≤—ã–∑–æ–≤ –Ω–∏—á–µ–≥–æ –Ω–µ –º–µ–Ω—è–µ—Ç).
	‚Ä¢	–ù–µ—Å–∫–æ–ª—å–∫–æ —Å—Ç—Ä–æ–∫ –∑–∞–∫–∞–∑–∞/—Ç–æ–≤–∞—Ä–æ–≤.
	‚Ä¢	–û—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏: –ø—É—Å—Ç–æ–π –ø–ª–∞–Ω, –Ω—É–ª–µ–≤—ã–µ –æ—Å—Ç–∞—Ç–∫–∏.

9.2. E2E —Å—Ü–µ–Ω–∞—Ä–∏–∏
	‚Ä¢	Soft-—Ä–µ–∑–µ—Ä–≤: –¥–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä(—ã) –≤ –∫–æ—Ä–∑–∏–Ω—É, –º–µ–Ω—è—Ç—å —Ä–µ–∂–∏–º/—Å–∫–ª–∞–¥ ‚Äî qty –∫–ª–∞–º–ø–∏—Ç—Å—è, _stock* –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è.
	‚Ä¢	Hard-—Å–ø–∏—Å–∞–Ω–∏–µ: —Å–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑ COD ‚Üí —Å—Ç–∞—Ç—É—Å processing ‚Üí _stock_at_* —É–±—ã–≤–∞–µ—Ç, _stock/_stock_status –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è.
	‚Ä¢	Restore: –Ω–∞–∂–∞—Ç—å ¬´RESTORE¬ª ‚Üí –æ—Å—Ç–∞—Ç–∫–∏ –≤–æ–∑–≤—Ä–∞—â–µ–Ω—ã, _pc_stock_reduced –æ—á–∏—â–µ–Ω.
	–ë–∞—Ä—å–µ—Ä: –¥–µ—Ä–Ω—É—Ç—å —Ñ—Ä–æ–Ω—Ç–æ–≤—ã–µ –ø—É—Ç–∏ SLW (cart/order-item helpers) –∏ —É–±–µ–¥–∏—Ç—å—Å—è –ø–æ –ª–æ–≥–∞–º, —á—Ç–æ –∑–∞–ø–∏—Å–∏ _stock/_stock_status/_stock_at_* –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è ([STOCK-BARRIER] blocked ‚Ä¶).
	‚Ä¢	–ö–∞—Ç–∞–ª–æ–≥: –≤–∫–ª—é—á–∏—Ç—å mode=single + –≤—ã–±—Ä–∞—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Å–∫–ª–∞–¥ ‚Üí —Å–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤ –≤ –∫–∞—Ç–∞–ª–æ–≥–µ –¥–æ–ª–∂–µ–Ω –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å—Å—è —ç—Ç–∏–º —Å–∫–ª–∞–¥–æ–º. –ü—Ä–∏ mode=auto/manual —Å–ø–∏—Å–æ–∫ –æ—Å—Ç–∞—ë—Ç—Å—è –ø–æ–ª–Ω—ã–º.
	‚Ä¢	–°–º–µ—à–∞–Ω–Ω—ã–π –∑–∞–∫–∞–∑: –¥–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É —Ç–æ–≤–∞—Ä—ã —Å —Ä–∞–∑–Ω—ã–º–∏ —Å–∫–ª–∞–¥–∞–º–∏ ‚Üí –ø—Ä–∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–∏ –∑–∞–∫–∞–∑–∞ –ø–ª–∞–Ω –≤ —Å—Ç—Ä–æ–∫–∞—Ö –∑–∞–∫–∞–∑–∞ –¥–æ–ª–∂–µ–Ω –æ—Ç—Ä–∞–∂–∞—Ç—å —Ä–∞–∑–±–∏–µ–Ω–∏–µ –ø–æ —Å–∫–ª–∞–¥–∞–º.
	‚Ä¢	–ú–∞—Å—Å–æ–≤—ã–π –∏–º–ø–æ—Ä—Ç: –∑–∞–ª–∏—Ç—å CSV —Å –ø—Ä–∏—Ö–æ–¥–æ–º (–Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–∫–ª–∞–¥–æ–≤, –æ–¥–∏–Ω —Ç–æ–≤–∞—Ä) ‚Üí –ø–æ—Å–ª–µ add_term_stock + recalc_total_stock —Å—É–º–º–∞ –¥–æ–ª–∂–Ω–∞ —Å–æ–≤–ø–∞–¥–∞—Ç—å.

‚∏ª

10) FAQ

Q: –ú–æ–∂–Ω–æ –ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç–æ –∫–∞–∫ ¬´–ø–æ–ª–Ω—É—é —Å—Ö–µ–º—É¬ª?
A: –î–∞ ‚Äî –ø–æ–∫—Ä—ã–≤–∞–µ—Ç –≤—Å–µ —É—Ä–æ–≤–Ω–∏: —Ö—Ä–∞–Ω–µ–Ω–∏–µ –æ—Å—Ç–∞—Ç–∫–æ–≤, –ø—Ä–∏—Ö–æ–¥, soft-—Ä–µ–∑–µ—Ä–≤, hard-—Å–ø–∏—Å–∞–Ω–∏–µ, –≤–æ–∑–≤—Ä–∞—Ç, —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é –∫–∞—Ç–∞–ª–æ–≥–∞, –±–∞—Ä—å–µ—Ä—ã –∏ –∞—É–¥–∏—Ç.

Q: –ß—Ç–æ –µ—Å–ª–∏ –ø–ª–∞–Ω –Ω–µ –∑–∞–ø–∏—Å–∞–ª—Å—è –≤ —Å—Ç—Ä–æ–∫—É –∑–∞–∫–∞–∑–∞?
A: ensure_item_plan() –ø–µ—Ä–µ—Å—á–∏—Ç–∞–µ—Ç –ø–æ —Ç–µ–º –∂–µ –ø—Ä–∞–≤–∏–ª–∞–º (—Å–Ω–∞—á–∞–ª–∞ –≤–Ω–µ—à–Ω–∏–π —Ñ–∏–ª—å—Ç—Ä slu_allocation_plan, –ø–æ—Ç–æ–º –Ω–∞—à –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä).

Q: –ü–æ—á–µ–º—É –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º WooCommerce hold stock?
A: –ß—Ç–æ–±—ã –Ω–µ –æ—Å—Ç–∞–≤–∞–ª–∏—Å—å –ø–æ–¥–≤–∏—Å—à–∏–µ —Ä–µ–∑–µ—Ä–≤—ã –∏ –Ω–µ –±—ã–ª–æ –≥–æ–Ω–æ–∫ –º–µ–∂–¥—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏. Soft-—Ä–µ–∑–µ—Ä–≤ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω —á–µ—Ä–µ–∑ –∫–ª–∞–º–ø –∫–æ—Ä–∑–∏–Ω—ã, –∞ —Ä–µ–∞–ª—å–Ω–æ–µ —Å–ø–∏—Å–∞–Ω–∏–µ ‚Äî –æ–¥–∏–Ω —Ä–∞–∑ –ø–æ —Å–æ–±—ã—Ç–∏—é —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–∫–∞–∑–∞.

Q: –ö–∞–∫ –∑–∞—â–∏—Ç–∏—Ç—å—Å—è –æ—Ç —Å—Ç–æ—Ä–æ–Ω–Ω–∏—Ö –∞–≤—Ç–æ–∑–∞–ø–∏—Å–µ–π _stock?
A: MU-–ø–ª–∞–≥–∏–Ω-–±–∞—Ä—å–µ—Ä (update_post_metadata —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º 9999) –±–ª–æ–∫–∏—Ä—É–µ—Ç –ª—é–±—ã–µ –Ω–µ–∂–µ–ª–∞—Ç–µ–ª—å–Ω—ã–µ –∑–∞–ø–∏—Å–∏ –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ. –ù–∞—à–∏ –ø—Ä–æ—Ü–µ–¥—É—Ä—ã –æ—Ç–∫—Ä—ã–≤–∞—é—Ç ¬´–∫–æ—Ä–∏–¥–æ—Ä –∑–∞–ø–∏—Å–∏¬ª $GLOBALS['PC_ALLOW_STOCK_WRITE'].

Q: –ö–∞–∫ –±—ã—Å—Ç—Ä–æ –ø—Ä–∏–Ω—è—Ç—å –ø—Ä–∏—Ö–æ–¥ –ø–æ CSV?
A: –î–ª—è –∫–∞–∂–¥–æ–π —Å—Ç—Ä–æ–∫–∏ product_id, term_id, delta:

```		

```php

add_term_stock($product_id, $term_id, +$delta);
recalc_total_stock($product_id);

```
–ü–æ—Å–ª–µ –±–∞—Ç—á–∞ ‚Äî –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ _stock —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å —Å—É–º–º–æ–π _stock_at_*.

‚∏ª
```text

1) –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ A ‚Äî –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

–ß–µ–∫–∞—É—Ç (COD):
	1.	–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç —Ä–µ–∂–∏–º/—Å–∫–ª–∞–¥ ‚Üí —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è pc_alloc_pref.
	2.	–ö–æ—Ä–∑–∏–Ω–∞ –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç –ø–ª–∞–Ω—ã (pc_recalc_alloc_plans_for_cart) –∏ –∫–ª–∞–º–ø–∏—Ç qty.
	3.	–ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–∫–∞–∑–∞ –ø–ª–∞–Ω—ã –ø–µ—Ä–µ–Ω–æ—Å—è—Ç—Å—è –≤ –º–µ—Ç—É —Å—Ç—Ä–æ–∫.
	4.	–°—Ç–∞—Ç—É—Å processing ‚Üí reduce_stock_from_plan():
	‚Ä¢	–æ—Ç–∫—Ä—ã—Ç—å ALLOW_WRITE,
	‚Ä¢	—Å–ø–∏—Å–∞—Ç—å add_term_stock(-qty) –ø–æ –ø–ª–∞–Ω—É,
	‚Ä¢	recalc_total_stock(),
	‚Ä¢	–æ—Ç–º–µ—Ç–∏—Ç—å –∑–∞–∫–∞–∑ _pc_stock_reduced=yes,
	‚Ä¢	–∑–∞–∫—Ä—ã—Ç—å ALLOW_WRITE.

–í–æ–∑–≤—Ä–∞—Ç:
	‚Ä¢	–ê–¥–º–∏–Ω –≤—ã–±–∏—Ä–∞–µ—Ç ¬´RESTORE¬ª ‚Üí add_term_stock(+qty) ‚Üí recalc_total_stock() ‚Üí _pc_stock_reduced —É–¥–∞–ª—è–µ—Ç—Å—è.

```

</details>

## üé≠ –¢–µ–º–∞ (GeneratePress Child)

<details>
<summary><strong>–û–±—â–µ–µ</strong></summary>

**–ò–¥–µ—è.** –¢–µ–º–∞ –æ—Å—Ç–∞—ë—Ç—Å—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ ¬´—Ç–æ–Ω–∫–æ–π¬ª: —Å–µ—Ç–∫–∞/—Å—Ç–∏–ª–∏/–∫–æ—Å–º–µ—Ç–∏–∫–∞. –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ ‚Äî –≤ –ø–ª–∞–≥–∏–Ω–∞—Ö.

**–í–∞–∂–Ω–æ:**
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ **–∫–æ–ª–æ–Ω–æ–∫** –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç **—Ç–æ–ª—å–∫–æ CSS Grid**.
- –ß–∏—Å–ª–æ —Ç–æ–≤–∞—Ä–æ–≤ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É (`per_page`) –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç MU-–ø–ª–∞–≥–∏–Ω, –∞ –Ω–µ —Ç–µ–º–∞.

</details>

<details>
<summary><strong>–§–∞–π–ª—ã —Ç–µ–º—ã</strong></summary>

| –ü—É—Ç—å | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|---|---|
| `wp-content/themes/generatepress-child/style.css` | CSS-—Å–µ—Ç–∫–∞ –∫–∞—Ç–∞–ª–æ–≥–∞ (Grid), —Å—Ç–∏–ª–∏ qty/–∫–Ω–æ–ø–æ–∫, –º–∏–Ω–∏-—Å—Ç–∏–ª–∏ —à–∞–ø–∫–∏ (¬´–°–ø–∏—Å–∞–Ω–∏–µ/–°–∫–ª–∞–¥¬ª). |
| `wp-content/themes/generatepress-child/functions.php` | –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Å—Ç–∏–ª–µ–π —Ç–µ–º—ã, –ª—ë–≥–∫–∏–µ –ø—Ä–∞–≤–∫–∏ (–Ω–∞–ø—Ä., —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å —Ö–ª–µ–±–Ω—ã—Ö –∫—Ä–æ—à–µ–∫). |
| `wp-content/themes/generatepress-child/header.php` | –®–∞–±–ª–æ–Ω —à–∞–ø–∫–∏ GeneratePress (–æ–±—ã—á–Ω–æ –±–µ–∑ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏; UI —Å–∫–ª–∞–¥–æ–≤ –º–æ–Ω—Ç–∏—Ä—É–µ–º –∏–∑ –ø–ª–∞–≥–∏–Ω–∞). |

</details>

<details>
<summary><strong>style.css ‚Äî –∫–ª—é—á –∫ —Å–µ—Ç–∫–µ –∫–∞—Ç–∞–ª–æ–≥–∞</strong></summary>

–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –Ω–∞–±–æ—Ä –ø—Ä–∞–≤–∏–ª (–±–µ–∑ –¥—É–±–ª–µ–π):

```css
/* Woo Grid base */
.woocommerce ul.products::before,
.woocommerce ul.products::after { content: none !important; }

.woocommerce ul.products{
  list-style:none; margin:0; padding:0;
  display:grid !important;
  gap:20px;
  grid-auto-flow:row;
  grid-template-columns:repeat(auto-fit, minmax(130px, 1fr));
}

/* Tablet */
@media (max-width:1024px){
  .woocommerce ul.products{
    grid-template-columns:repeat(auto-fit, minmax(160px, 1fr));
  }
}

/* Mobile */
@media (max-width:768px){
  .woocommerce ul.products{
    grid-template-columns:repeat(auto-fit, minmax(100px, 1fr));
  }
}

/* Reset widths that fight the grid */
.woocommerce ul.products li.product{
  float:none !important; width:auto !important; margin:0 !important; clear:none !important;
}
.woocommerce ul.products[class*="columns-"] li.product{
  width:auto !important; clear:none !important; margin-right:0 !important;
}

/* Even if Woo forces columns-1 ‚Äî keep grid */
.woocommerce ul.products.columns-1{ display:grid !important; }

–†—É—á–∫–∏: –º–µ–Ω—è–π ¬´–º–∏–Ω–∏–º—É–º¬ª –≤ minmax(‚Ä¶px, 1fr) ‚Äî —Ç–∞–∫ —É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —á–∏—Å–ª–æ –∫–æ–ª–æ–Ω–æ–∫ –Ω–∞ –±—Ä–µ–π–∫–ø–æ–∏–Ω—Ç–µ.
```

</details>

<details>
<summary><strong>functions.php ‚Äî —Ç–æ–ª—å–∫–æ –ª—ë–≥–∫–∏–µ —Ö—É–∫–∏</strong></summary>
<?php
// –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Å—Ç–∏–ª–µ–π –¥–æ—á–µ—Ä–Ω–µ–π —Ç–µ–º—ã
add_action('wp_enqueue_scripts', function () {
    wp_enqueue_style('generatepress-child-style', get_stylesheet_uri());
});

// –•–ª–µ–±–Ω—ã–µ –∫—Ä–æ—à–∫–∏: —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å
add_filter('woocommerce_breadcrumb_defaults', function ($defaults) {
    $defaults['delimiter'] = ' <span class="breadcrumb-delimiter">‚Üí</span> ';
    return $defaults;
});

</details>
<details>
<summary><strong>–ú–∏–Ω–∏-—Å—Ç–∏–ª–∏ —à–∞–ø–∫–∏ (—Å–µ–ª–µ–∫—Ç–æ—Ä—ã ¬´–°–ø–∏—Å–∞–Ω–∏–µ/–°–∫–ª–∞–¥¬ª)</strong></summary>
/* –†—è–¥–æ–º —Å –ª–æ–≥–æ—Ç–∏–ø–æ–º */
.site-branding{ display:flex; align-items:center; gap:12px; }

/* –ö–æ–Ω—Ç—Ä–æ–ª —Å–ø–∏—Å–∞–Ω–∏—è/—Å–∫–ª–∞–¥–∞ */
.pc-alloc{ display:flex; align-items:center; gap:8px; font:14px/1.2 system-ui; }
.pc-alloc small{ color:#666; }
.pc-alloc select{ max-height:34px; padding:4px 8px; line-height:1.2; min-width:0; }

/* –¢–µ–ª–µ—Ñ–æ–Ω—ã */
@media (max-width:480px){
  .site-branding{ gap:8px; }
  .pc-alloc{ gap:6px; }
  .pc-alloc small{ font-size:12px; }
  .pc-alloc select{ font-size:12px; height:32px; padding:0 22px 0 8px; }
}

/* –û—á–µ–Ω—å —É–∑–∫–∏–µ ‚Äî –≤ —Å—Ç–æ–ª–±–∏–∫ */
@media (max-width:360px){
  .pc-alloc{ flex-direction:column; align-items:stretch; gap:6px; }
  .pc-alloc > *{ width:100%; }
  .pc-alloc small{ display:none; }
}

</details>

## üß© MU-plugins

<details>
<summary><strong>–û–±—â–µ–µ</strong></summary>

MU-–ø–ª–∞–≥–∏–Ω—ã –≥—Ä—É–∑—è—Ç—Å—è –≤—Å–µ–≥–¥–∞ (–±–µ–∑ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –≤ –∞–¥–º–∏–Ω–∫–µ) –∏–∑ `wp-content/mu-plugins/`.  
–ó–¥–µ—Å—å –ª–µ–∂–∞—Ç ¬´–Ω–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–µ¬ª –≤–µ—â–∏, –∫–æ—Ç–æ—Ä—ã–µ –¥–æ–ª–∂–Ω—ã –ø—Ä–∏–º–µ–Ω—è—Ç—å—Å—è —Ä–∞–Ω—å—à–µ —Ç–µ–º—ã/–æ–±—ã—á–Ω—ã—Ö –ø–ª–∞–≥–∏–Ω–æ–≤.

</details>

---

<details>
<summary><strong>1) mu-plugins/psu-force-per-page.php ‚Äî –∞–≤—Ç–æ-–ø–µ—Ä–µ—Å—á—ë—Ç per_page</strong></summary>

**–ò–¥–µ—è.** –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–æ–≤ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ = **–∫–æ–ª–æ–Ω–∫–∏ √ó —Ä—è–¥—ã**.  
–ö–æ–ª–æ–Ω–∫–∏ –º–µ—Ä—è—é—Ç—Å—è –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ (–ø–æ CSS Grid), –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –≤ cookie ‚Üí —Å–µ—Ä–≤–µ—Ä —Å—Ç–∞–≤–∏—Ç `posts_per_page`.

### –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã (—Ä—É—á–∫–∏)
| –ö–æ–Ω—Å—Ç–∞–Ω—Ç–∞ | –ß—Ç–æ –¥–µ–ª–∞–µ—Ç | –î–µ—Ñ–æ–ª—Ç |
|---|---|---|
| `PSUFP_COOKIE_COLS` | –∏–º—è cookie —Å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –∫–æ–ª–æ–Ω–æ–∫ | `psu_cols` |
| `PSUFP_COOKIE_ROWS` | –∏–º—è cookie —Å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º —Ä—è–¥–æ–≤ | `psu_rows` |
| `PSUFP_ROWS_DESKTOP` | —Ä—è–¥—ã –¥–ª—è >480px | `3` |
| `PSUFP_ROWS_MOBILE` | —Ä—è–¥—ã –¥–ª—è 321‚Äì480px | `3` |
| `PSUFP_ROWS_XSMALL` | —Ä—è–¥—ã –¥–ª—è ‚â§320px | `2` |
| `PSUFP_FALLBACK_COLS` | –∫–æ–ª-–≤–æ –∫–æ–ª–æ–Ω–æ–∫ –ø–æ–∫–∞ cookie –Ω–µ—Ç | `5` |
| `PSUFP_DEBUG` | –æ—Ç–ª–∞–¥–∫–∞ (–∑–µ–ª—ë–Ω–∞—è –ø–ª–∞—à–∫–∞ + console.log) | `false` |

### Cookie
- `psu_cols` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–ª–æ–Ω–æ–∫, –∏–∑–º–µ—Ä–µ–Ω–Ω–æ–µ JS.
- `psu_rows` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä—è–¥–æ–≤, –≤—ã—á–∏—Å–ª–µ–Ω–Ω–æ–µ –ø–æ –±—Ä–µ–π–∫–ø–æ–∏–Ω—Ç–∞–º.

### –ì–¥–µ –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ–º `per_page`
- `loop_shop_per_page` (WooCommerce)
- `pre_get_posts` (—Ç–æ–ª—å–∫–æ main query, –∞—Ä—Ö–∏–≤—ã —Ç–æ–≤–∞—Ä–æ–≤)
- `woocommerce_product_query` (—Ç–æ–ª—å–∫–æ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –∞—Ä—Ö–∏–≤–æ–≤ —Ç–æ–≤–∞—Ä–æ–≤)

### –í–∞–∂–Ω—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏
- **–Ø–≤–Ω—ã–π –æ–≤–µ—Ä—Ä–∞–π–¥ —á–µ—Ä–µ–∑ URL:** –¥–æ–±–∞–≤–∏—Ç—å `?per_page=N` (1‚Ä¶200).  
  –ú–æ–¥—É–ª—å —É–≤–∞–∂–∏—Ç –∏ –≤–µ—Ä–Ω—ë—Ç —ç—Ç–æ –∑–Ω–∞—á–µ–Ω–∏–µ –≤–º–µ—Å—Ç–æ —Ä–∞—Å—á—ë—Ç–∞.

- **–•—É–∫ –¥–ª—è —Ç–æ–Ω–∫–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä—è–¥–æ–≤:** –º–æ–∂–Ω–æ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –≤—ã–±–æ—Ä —Ä—è–¥–æ–≤ –¥–ª—è —Å–µ—Ä–≤–µ—Ä–Ω–æ–π —Å—Ç–æ—Ä–æ–Ω—ã:
  ```php
  /**
   * @param int $rows   —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–Ω—ã–µ —Ä—è–¥—ã –ø–æ —Ç–µ–∫—É—â–µ–π —à–∏—Ä–∏–Ω–µ
   * @param int $width  —à–∏—Ä–∏–Ω–∞ (–µ—Å–ª–∏ –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è)
   * @return int
   */
  add_filter('psufp_rows_for_width', function($rows, $width){
      // –ø—Ä–∏–º–µ—Ä: –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ 2 —Ä—è–¥–∞ –Ω–∞ –ª—é–±—ã—Ö –º–æ–±–∏–ª–∫–∞—Ö
      if ($width <= 480) return 2;
      return $rows;
  }, 10, 2);

```  
–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: —Å–µ–π—á–∞—Å –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ —Ä—è–¥–æ–≤ –¥–µ–ª–∞–µ—Ç—Å—è –≤ JS; —ç—Ç–æ—Ç —Ñ–∏–ª—å—Ç—Ä ‚Äî –∑–∞–¥–µ–ª –¥–ª—è PHP-—Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ –∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π.

	‚Ä¢	–ö—Ç–æ —Ä–µ—à–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–ª–æ–Ω–æ–∫? –¢–æ–ª—å–∫–æ CSS –≤ —Ç–µ–º–µ:
grid-template-columns: repeat(auto-fit, minmax(..., 1fr));
JS –ª–∏—à—å ¬´—Å—á–∏—Ç—ã–≤–∞–µ—Ç¬ª —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏ –∫–ª–∞–¥—ë—Ç —á–∏—Å–ª–æ –≤ cookie.

–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
	1.	–í–∫–ª—é—á–∏ define('PSUFP_DEBUG', true); ‚Äî –≤–Ω–∏–∑—É –ø–æ—è–≤–∏—Ç—Å—è –±–ª–æ–∫ –≤–∏–¥–∞:
cols=5, rows=3, per_page=15, w=1280.
	2.	–ü—Ä–æ–≤–µ—Ä—å cookie psu_cols, psu_rows.
	3.	–£–±–µ–¥–∏—Å—å, —á—Ç–æ –≤ DevTools —É .woocommerce ul.products —Ä–µ–∞–ª—å–Ω–æ —Å—Ç–æ–∏—Ç –Ω–∞—à grid-template-columns.
	4.	–ï—Å–ª–∏ ¬´–Ω–µ –¥–æ–±–∏–≤–∞–µ—Ç¬ª –ø–æ—Å–ª–µ–¥–Ω–∏–π —Ä—è–¥ ‚Äî –æ–±—ã—á–Ω–æ –ª–∏–±–æ –∫–æ–ª–æ–Ω–æ–∫ –ø–æ—Å—á–∏—Ç–∞–ª–æ—Å—å –º–µ–Ω—å—à–µ, —á–µ–º –æ–∂–∏–¥–∞–ª–æ—Å—å (CSS), –ª–∏–±–æ —Ä—è–¥–æ–≤ –≤—ã–±—Ä–∞–Ω–æ –±–æ–ª—å—à–µ (–∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã).

```
</details>

<details>
<summary><strong>–ò–º–ø–æ—Ä—Ç —Ü–µ–Ω –ø–æ —Ä–æ–ª—è–º (CSV, –¥–ª—è –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤)</strong></summary>

**–ß—Ç–æ —ç—Ç–æ:** –ø—Ä–æ—Å—Ç–∞—è –∞–¥–º–∏–Ω-—Å—Ç—Ä–∞–Ω–∏—Ü–∞, –∫—É–¥–∞ –º–µ–Ω–µ–¥–∂–µ—Ä –∑–∞–≥—Ä—É–∂–∞–µ—Ç CSV ‚Üí –ø–ª–∞–≥–∏–Ω –æ–±–Ω–æ–≤–ª—è–µ—Ç –º–µ—Ç–∞-—Ü–µ–Ω—ã `_wpc_price_role_*` —É —Ç–æ–≤–∞—Ä–æ–≤ –ø–æ SKU.

**–ì–¥–µ –≤ –∞–¥–º–∏–Ω–∫–µ:** <code>–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã ‚Üí –ò–º–ø–æ—Ä—Ç —Ü–µ–Ω (CSV)</code>.

**–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–π —Ñ–æ—Ä–º–∞—Ç CSV (—Ç–æ—á–Ω–æ —ç—Ç–∏ –∑–∞–≥–æ–ª–æ–≤–∫–∏):**

```csv
sku;partner;opt;opt_osn;schule
CR-001;10.50;11.00;9.90;10.00
CR-002;12;12;11.5;11.5
```
```txt
- –†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏: `;` / `,` / `TAB`.
- –ö–æ–¥–∏—Ä–æ–≤–∫–∞: UTF-8 / CP1251 ‚Äî –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.
- –ü—É—Å—Ç—ã–µ –∫–ª–µ—Ç–∫–∏ –Ω–µ –æ–±–Ω–æ–≤–ª—è—é—Ç —Ü–µ–Ω—É –ø–æ —Ä–æ–ª–∏.
- –î–µ—Å—è—Ç–∏—á–Ω—ã–π —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å `.` –∏–ª–∏ `,` ‚Äî –¥–æ–ø—É—Å—Ç–∏–º.

**–ö–∞–∫–∏–µ —Ä–æ–ª–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è ¬´–∏–∑ –∫–æ—Ä–æ–±–∫–∏¬ª:**
- `partner` ‚Üí `_wpc_price_role_partner`
- `opt` ‚Üí `_wpc_price_role_opt`
- `opt_osn` ‚Üí `_wpc_price_role_opt_osn`
- `schule` ‚Üí `_wpc_price_role_schule`  
(–º–æ–∂–Ω–æ —Ä–∞—Å—à–∏—Ä–∏—Ç—å: –¥–æ–±–∞–≤–∏—Ç—å –∫–æ–ª–æ–Ω–∫—É ‚Äî –¥–æ–±–∞–≤–∏—Ç—å –≤ `$roleColumns` –≤–Ω—É—Ç—Ä–∏ –ø–ª–∞–≥–∏–Ω–∞)

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:**
1) –ü–æ `sku` –Ω–∞—Ö–æ–¥–∏–º —Ç–æ–≤–∞—Ä (`_sku`).  
2) –î–ª—è –∫–∞–∂–¥–æ–π –Ω–µ–ø—É—Å—Ç–æ–π —Ä–æ–ª–∏ –æ–±–Ω–æ–≤–ª—è–µ–º –º–µ—Ç–∞-–∫–ª—é—á `_wpc_price_role_<role>`.  
3) –ö–æ—Ä–∑–∏–Ω–∞/–≤–∏—Ç—Ä–∏–Ω–∞ —É–≤–∏–¥–∏—Ç –Ω–æ–≤—ã–µ —Ü–µ–Ω—ã (–ø–ª–∞–≥–∏–Ω `role-price` —É–∂–µ –∏—Ö –æ—Ç–¥–∞—ë—Ç).

**–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å / –æ—Ç–∫–∞—Ç:**
- –û–ø—Ü–∏—è ¬´–°–¥–µ–ª–∞—Ç—å –±—ç–∫–∞–ø¬ª ‚Äî —Å–æ–∑–¥–∞—ë—Ç —Ç–∞–±–ª–∏—Ü—É `wp_postmeta_backup_role_price_YYYYMMDDHHMMSS` —Å —Ç–µ–∫—É—â–∏–º–∏ `_wpc_price_role_*`.

**–®–∞–≥–∏ –¥–ª—è –º–µ–Ω–µ–¥–∂–µ—Ä–∞:**
1. –°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å CSV (—Å–º. —à–∞–±–ª–æ–Ω –≤—ã—à–µ).
2. –ó–∞–π—Ç–∏ –≤ **–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã ‚Üí –ò–º–ø–æ—Ä—Ç —Ü–µ–Ω (CSV)**.
3. –í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª ‚Üí (–æ–ø—Ü.) –≤–∫–ª—é—á–∏—Ç—å **–°–¥–µ–ª–∞—Ç—å –±—ç–∫–∞–ø** ‚Üí –Ω–∞–∂–∞—Ç—å **–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å**.
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç—á—ë—Ç (—Å–∫–æ–ª—å–∫–æ SKU –Ω–∞–π–¥–µ–Ω–æ/–æ–±–Ω–æ–≤–ª–µ–Ω–æ, —Å–∫–æ–ª—å–∫–æ –ø—Ä–æ–ø—É—â–µ–Ω–æ).

**–ó–∞–º–µ—á–∞–Ω–∏—è:**
- –ù–∞ –≤—Ä–µ–º—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ API ‚Äî —ç—Ç–æ–≥–æ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è 1‚Äì2 –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –≤ –Ω–µ–¥–µ–ª—é.
- –ö–æ–≥–¥–∞ API –±—É–¥–µ—Ç –≥–æ—Ç–æ–≤, —Å—Ç—Ä–∞–Ω–∏—Ü—É –º–æ–∂–Ω–æ —Å–∫—Ä—ã—Ç—å, –∞ –ª–æ–≥–∏–∫—É ‚Äî –ø–µ—Ä–µ–≤–µ—Å—Ç–∏ –Ω–∞ CRON/–≤–µ–±-—Ö—É–∫–∏.
```
</details>

<details>
<summary><strong>2) mu-plugins/stock-import-csv-lite.php ‚Äî –∏–º–ø–æ—Ä—Ç –æ—Å—Ç–∞—Ç–∫–æ–≤ –∏–∑ CSV (Lite)</strong></summary>

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ.** –ó–∞–≥—Ä—É–∂–∞–µ—Ç CSV —Å –æ—Å—Ç–∞—Ç–∫–∞–º–∏ –ø–æ —Å–∫–ª–∞–¥–∞–º –≤ —Ç–∞–±–ª–∏—Ü—É `wp_stock_import`. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç **–¥–ª–∏–Ω–Ω—ã–π** –∏ **—à–∏—Ä–æ–∫–∏–π** —Ñ–æ—Ä–º–∞—Ç, –∞–≤—Ç–æ-–æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∫–æ–¥–∏—Ä–æ–≤–∫—É –∏ —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å. –ï—Å—Ç—å –∫–Ω–æ–ø–∫–∞ **SMOKE-TEST**.

**–ì–¥–µ –≤ –∞–¥–º–∏–Ω–∫–µ:** ‚öôÔ∏è –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã ‚Üí **–ò–º–ø–æ—Ä—Ç –æ—Å—Ç–∞—Ç–∫–æ–≤ (Lite)**  
**–ü—Ä–∞–≤–∞:** `manage_options` (—Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω—ã)  
**–¢–∞–±–ª–∏—Ü–∞ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è:** `${$wpdb->prefix}stock_import`

---

### –§–æ—Ä–º–∞—Ç—ã CSV
**1) –î–ª–∏–Ω–Ω—ã–π** ‚Äî –æ–¥–∏–Ω —Å–∫–ª–∞–¥ –≤ —Å—Ç—Ä–æ–∫–µ:
```csv
sku;location_slug;qty
CR-TEST-001;kiev1;10
CR-TEST-001;odesa;3.5
CR-TEST-002;kiev1;0
```
**2) –®–∏—Ä–æ–∫–∏–π ‚Äî —Å–∫–ª–∞–¥—ã –∫–æ–ª–æ–Ω–∫–∞–º–∏:
```csv
sku,kiev1,odesa
A-AZ-001,"68583,91",0
AB-111-10X15,0,0
AB-111-20X20,3,1.5
```
–ü—É—Å—Ç—ã–µ/–Ω—É–ª–µ–≤—ã–µ —è—á–µ–π–∫–∏ –≤ ¬´—à–∏—Ä–æ–∫–æ–º¬ª —Ñ–æ—Ä–º–∞—Ç–µ –ø—Ä–æ–ø—É—Å–∫–∞—é—Ç—Å—è (—Å—Ç—Ä–æ–∫–∏ –Ω–µ —Å–æ–∑–¥–∞—é—Ç—Å—è).

‚∏ª
–ö—É–¥–∞ —Å–∫–ª–∞–¥—ã–≤–∞–µ—Ç:
	‚Ä¢	–¢–∞–±–ª–∏—Ü–∞ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è:

```sql
CREATE TABLE wp_stock_import (
  sku           VARCHAR(191) NOT NULL,
  location_slug VARCHAR(191) NOT NULL,
  qty           DECIMAL(18,3) NOT NULL,
  PRIMARY KEY (sku, location_slug)
);
```  

```
–ê–ª–≥–æ—Ä–∏—Ç–º –∏ –ø–æ–≤–µ–¥–µ–Ω–∏–µ
	‚Ä¢	–ö–æ–¥–∏—Ä–æ–≤–∫–∞: –∞–≤—Ç–æ (UTF-8 / CP1251 / ISO-8859-1 / Windows-1252). –£–±–∏—Ä–∞–µ—Ç—Å—è BOM.
	‚Ä¢	–†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å: –∞–≤—Ç–æ (; / , / TAB). –î–µ—Å—è—Ç–∏—á–Ω—ã–µ: , –∏ . –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è.
	‚Ä¢	–ó–∞–≥–æ–ª–æ–≤–∫–∏ –Ω–æ—Ä–º–∞–ª–∏–∑—É—é—Ç—Å—è (–∞–ª–∏–∞—Å—ã):
–∫–∏–µ–≤ / –∫–∏—ó–≤ / kiev / –∫ ‚Üí kiev1, –æ–¥–µ—Å—Å–∞ / –æ–¥–µ—Å–∞ / odessa / odesa / –æ ‚Üí odesa. –ù–µ–∑–Ω–∞–∫–æ–º—ã–µ ‚Äî sanitize_title().
	‚Ä¢	–ó–∞–ø–∏—Å—å –∏–¥—ë—Ç –ø–∞–∫–µ—Ç–∞–º–∏ –ø–æ 1000 –∑–Ω–∞—á–µ–Ω–∏–π (bulk insert).
	‚Ä¢	–ö–ª—é—á —Ç–∞–±–ª–∏—Ü—ã: (sku, location_slug). –í—Å—Ç–∞–≤–∫–∞ —Å ON DUPLICATE KEY UPDATE (upsert).
	‚Ä¢	–û–ø—Ü–∏—è TRUNCATE ‚Äî –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ –æ—á–∏—â–∞–µ—Ç —Ç–∞–±–ª–∏—Ü—É.
	‚Ä¢	–ö–Ω–æ–ø–∫–∞ SMOKE-TEST —Å–æ–∑–¥–∞—ë—Ç —Å—Ç—Ä–æ–∫—É (CR-TEST-SMOKE, kiev1, 7).

–°—Ö–µ–º–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è –æ—Å—Ç–∞—Ç–∫–æ–≤ –≤ –±–∞–∑–µ

üëâ –ü–æ—Å–ª–µ –∏–º–ø–æ—Ä—Ç–∞ –¥–∞–Ω–Ω—ã–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è –ø–æ –º–µ—Ç–∞-–∫–ª—é—á–∞–º —Ç–æ–≤–∞—Ä–∞ –∏ —Å–≤—è–∑—è–º:
	‚Ä¢	–ù–∞–ª–∏—á–∏–µ –Ω–∞ —Å–∫–ª–∞–¥–∞—Ö:
_stock_at_{term_id} = –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ (–Ω–∞–ø—Ä–∏–º–µ—Ä, _stock_at_3942 = 12)
	‚Ä¢	–û–±—â–∏–π –æ—Å—Ç–∞—Ç–æ–∫:
_stock = 44
	‚Ä¢	Primary (–æ—Å–Ω–æ–≤–Ω–æ–π —Å–∫–ª–∞–¥):
_yoast_wpseo_primary_location = term_id
	‚Ä¢	–ü—Ä–∏–≤—è–∑–∫–∞ –∫ —Å–∫–ª–∞–¥–∞–º:
wp_term_relationships (taxonomy = location ‚Üí wp_term_taxonomy ‚Üí wp_terms)

–ì–¥–µ —á—Ç–æ —Ö—Ä–∞–Ω–∏—Ç—Å—è (–∏—Ç–æ–≥):

–ß—Ç–æ                      –ì–¥–µ —Ö—Ä–∞–Ω–∏—Ç—Å—è
–û–±—â–∏–π –æ—Å—Ç–∞—Ç–æ–∫            wp_postmeta._stock
–û—Å—Ç–∞—Ç–æ–∫ –ø–æ —Å–∫–ª–∞–¥—É        wp_postmeta._stock_at_{term_id}
Primary-—Å–∫–ª–∞–¥            wp_postmeta._yoast_wpseo_primary_location (–∑–Ω–∞—á–µ–Ω–∏–µ = term_id)
–°–ø–∏—Å–æ–∫ –ª–æ–∫–∞—Ü–∏–π —É —Ç–æ–≤–∞—Ä–∞  wp_term_relationships (—Ç–∞–∫—Å–æ–Ω–æ–º–∏—è location ‚Üí wp_term_taxonomy ‚Üí wp_terms)
```
SQL-–ø—Ä–∏–º–µ—Ä (–≤—ã–≥—Ä—É–∑–∏—Ç—å –æ—Å—Ç–∞—Ç–∫–∏ –ø–æ —Å–∫–ª–∞–¥–∞–º –¥–ª—è —Ç–æ–≤–∞—Ä–æ–≤)
```sql
SELECT
  p.ID,
  p.post_title,
  sku.meta_value                                AS sku,
  t.term_id,
  t.name                                        AS location_name,
  t.slug                                        AS location_slug,
  CAST(pm_qty.meta_value AS SIGNED)             AS qty,
  CAST(pm_total.meta_value AS SIGNED)           AS total_stock,
  pm_primary.meta_value                         AS primary_location_term_id,
  CASE WHEN pm_primary.meta_value = t.term_id THEN 1 ELSE 0 END AS is_primary
FROM wp_posts p
JOIN wp_postmeta sku
  ON sku.post_id = p.ID
 AND sku.meta_key = '_sku'
 AND sku.meta_value <> ''
/* —Å—Ç—Ä–æ–∫–∏ –≤–∏–¥–∞ _stock_at_{term_id} */
JOIN wp_postmeta pm_qty
  ON pm_qty.post_id = p.ID
 AND pm_qty.meta_key REGEXP '^_stock_at_[0-9]+$'
/* –≤—ã–Ω–∏–º–∞–µ–º term_id –∏–∑ –∫–ª—é—á–∞ */
JOIN wp_terms t
  ON t.term_id = CONVERT(SUBSTRING_INDEX(pm_qty.meta_key, '_stock_at_', -1), UNSIGNED)
JOIN wp_term_taxonomy tt
  ON tt.term_id = t.term_id
 AND tt.taxonomy = 'location'
/* –æ–±—â–∏–π –æ—Å—Ç–∞—Ç–æ–∫ –∏ primary location */
LEFT JOIN wp_postmeta pm_total
  ON pm_total.post_id = p.ID
 AND pm_total.meta_key = '_stock'
LEFT JOIN wp_postmeta pm_primary
  ON pm_primary.post_id = p.ID
 AND pm_primary.meta_key = '_yoast_wpseo_primary_location'
WHERE p.post_type = 'product'
  AND p.post_status IN ('publish','private')
-- AND sku.meta_value = 'CR-CE0900056730'   -- (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –ø–æ SKU
ORDER BY sku, location_name;
```

–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü—ã (DDL)

–ï—Å–ª–∏ —Ç–∞–±–ª–∏—Ü—ã –Ω–µ—Ç ‚Äî —Å–æ–∑–¥–∞–π:
```
CREATE TABLE wp_stock_import (
  sku           VARCHAR(191) NOT NULL,
  location_slug VARCHAR(191) NOT NULL,
  qty           DECIMAL(18,3) NOT NULL,
  PRIMARY KEY (sku, location_slug)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
```
```
–ü–æ–ª—è –æ—Ç—á—ë—Ç–∞ (—á—Ç–æ –≤–µ—Ä–Ω—ë—Ç —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ø–æ—Å–ª–µ –∏–º–ø–æ—Ä—Ç–∞)
	‚Ä¢	ok (bool), format (long|wide), encoding, delimiter
	‚Ä¢	rows_read (—Å–∫–æ–ª—å–∫–æ —Å—Ç—Ä–æ–∫ –ø—Ä–æ—á–∏—Ç–∞–ª–∏ –∏–∑ CSV)
	‚Ä¢	rows_pushed (—Å–∫–æ–ª—å–∫–æ –∑–∞–ø–∏—Å–µ–π –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–æ/–≤—Å—Ç–∞–≤–ª–µ–Ω–æ)
	‚Ä¢	errors (–ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏ –∏–∑-–∑–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏)
	‚Ä¢	time_sec (–≤—Ä–µ–º—è), last_error (–æ—à–∏–±–∫–∞ –ë–î, –µ—Å–ª–∏ –±—ã–ª–∞)

‚∏ª

–ß–∞—Å—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã / –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
	‚Ä¢	¬´–ù–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω —Ñ–æ—Ä–º–∞—Ç¬ª ‚Äî –ø—Ä–æ–≤–µ—Ä—å –∑–∞–≥–æ–ª–æ–≤–∫–∏. –î–ª—è –¥–ª–∏–Ω–Ω–æ–≥–æ –Ω—É–∂–Ω—ã sku,location_slug,qty.
	‚Ä¢	¬´SKU –Ω–µ –Ω–∞–π–¥–µ–Ω‚Ä¶¬ª ‚Äî —ç—Ç–æ—Ç –∏–º–ø–æ—Ä—Ç –Ω–µ –ª–µ–∑–µ—Ç –≤ –ø—Ä–æ–¥—É–∫—Ç—ã; –æ–Ω —Ç–æ–ª—å–∫–æ –ø–∏—à–µ—Ç –≤ wp_stock_import. –î–∞–ª—å—à–µ –¥–∞–Ω–Ω—ã–µ –∑–∞–±–µ—Ä—ë—Ç –º–æ–¥—É–ª—å —Å–∏–Ω–∫–∞.
	‚Ä¢	¬´–ö–∏—Ä–∏–ª–ª–∏—Ü–∞/–∫—Ä–∞–∫–æ–∑—è–±—Ä—ã¬ª ‚Äî —É–±–µ–¥–∏—Å—å, —á—Ç–æ CSV –≤ UTF-8 –∏–ª–∏ CP1251 (–∞–≤—Ç–æ-–∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤–∫–ª—é—á–µ–Ω–∞).
	‚Ä¢	¬´–ù—É–ª–∏/–ø—É—Å—Ç—ã–µ —è—á–µ–π–∫–∏¬ª ‚Äî –≤ —à–∏—Ä–æ–∫–æ–º —Ñ–æ—Ä–º–∞—Ç–µ –æ–Ω–∏ –∏–≥–Ω–æ—Ä–∏—Ä—É—é—Ç—Å—è (–Ω–µ —Å–æ–∑–¥–∞—é—Ç —Å—Ç—Ä–æ–∫).
	‚Ä¢	–ì–¥–µ —Å–º–æ—Ç—Ä–µ—Ç—å –æ—à–∏–±–∫—É SQL? ‚Äî –ø–æ–ª–µ last_error –≤ –æ—Ç—á—ë—Ç–µ –∏ wp-content/debug.log (–µ—Å–ª–∏ –≤–∫–ª—é—á—ë–Ω WP_DEBUG_LOG).

‚∏ª

–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ –ø–∞–π–ø–ª–∞–π–Ω
	1.	–ó–∞–≥—Ä—É–∑–∏–ª–∏ CSV —Å—é–¥–∞ ‚Üí
	2.	wp_stock_import –∑–∞–ø–æ–ª–Ω–∏–ª–∞—Å—å ‚Üí
	3.	–º–æ–¥—É–ª—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ wp_stock_import –≤ –º–µ—Ç—ã —Ç–æ–≤–∞—Ä–∞ (–∏–ª–∏ –≤ –≤–∞—à—É —Å–∏—Å—Ç–µ–º—É –æ—Å—Ç–∞—Ç–∫–æ–≤).
```
</details>

<details>
<summary><strong>PC Order Import/Export</strong></summary>

```markdown
# PC Order Import/Export

–ü–ª–∞–≥—ñ–Ω –¥–ª—è WooCommerce: –µ–∫—Å–ø–æ—Ä—Ç –∫–æ—à–∏–∫–∞/–∑–∞–º–æ–≤–ª–µ–Ω—å —É CSV/XLSX + —ñ–º–ø–æ—Ä—Ç —É –∫–æ—à–∏–∫/—á–µ—Ä–Ω–µ—Ç–∫—É.

## üì¶ –í–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è
1. –°–∫–æ–ø—ñ—é–≤–∞—Ç–∏ –∫–∞—Ç–∞–ª–æ–≥ `pc-order-import-export` —É `wp-content/plugins/`.
2. –ê–∫—Ç–∏–≤—É–≤–∞—Ç–∏ –ø–ª–∞–≥—ñ–Ω —É WordPress ‚Üí –ü–ª–∞–≥—ñ–Ω–∏.
3. –î–ª—è XLSX –ø–æ—Ç—Ä—ñ–±–µ–Ω –ø–∞–∫–µ—Ç [`phpoffice/phpspreadsheet`](https://phpspreadsheet.readthedocs.io).

## üì§ –ï–∫—Å–ø–æ—Ä—Ç
- –î–æ—Å—Ç—É–ø–Ω—ñ —Ñ–æ—Ä–º–∞—Ç–∏: **CSV** —ñ **XLSX**.
- –ü–∞—Ä–∞–º–µ—Ç—Ä–∏:
  - –≤–∏–±—ñ—Ä –∫–æ–ª–æ–Ω–æ–∫ (SKU, GTIN, Name, Qty, Price, Total, Note);
  - —Ä–µ–∂–∏–º split: `agg` (–∑–≤–µ–¥–µ–Ω–æ) –∞–±–æ `per_loc` (–ø–æ —Å–∫–ª–∞–¥–∞—Ö –∑ –∫–æ–ª–æ–Ω–∫–æ—é Note).

## üì• –Ü–º–ø–æ—Ä—Ç

### –£ –∫–æ—à–∏–∫
- –î–æ–¥–∞—é—Ç—å—Å—è –ª–∏—à–µ —Ç–æ–≤–∞—Ä–∏, —â–æ —î –Ω–∞ —Å–∫–ª–∞–¥—ñ.
- –ü–µ—Ä–µ–≤—ñ—Ä—è—é—Ç—å—Å—è `min/max` —ñ –∑–∞–ª–∏—à–æ–∫.
- –Ø–∫—â–æ –Ω–µ–º–∞—î –Ω–∞ —Å–∫–ª–∞–¥—ñ ‚Äî —Ä—è–¥–æ–∫ –ø—Ä–æ–ø—É—Å–∫–∞—î—Ç—å—Å—è.

### –£ —á–µ—Ä–Ω–µ—Ç–∫—É –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è
- –°—Ç–≤–æ—Ä—é—î—Ç—å—Å—è –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è –∑—ñ —Å—Ç–∞—Ç—É—Å–æ–º **–ß–µ—Ä–Ω–µ—Ç–∫–∞ (—ñ–º–ø–æ—Ä—Ç)**.
- –î–æ–¥–∞—é—Ç—å—Å—è –≤—Å—ñ —Ç–æ–≤–∞—Ä–∏ –Ω–µ–∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ –∑–∞–ª–∏—à–∫—ñ–≤.
- –Ñ–¥–∏–Ω–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞: –∫—ñ–ª—å–∫—ñ—Å—Ç—å > 0.
- Email-–ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –Ω–µ –≤—ñ–¥–ø—Ä–∞–≤–ª—è—é—Ç—å—Å—è.

## üìë –§–æ—Ä–º–∞—Ç CSV/XLSX
–ú—ñ–Ω—ñ–º—É–º –¥–≤—ñ –∫–æ–ª–æ–Ω–∫–∏:

sku;qty
gtin;qty


# PC Order Import/Export

–ü–ª–∞–≥—ñ–Ω –¥–ª—è WooCommerce, —â–æ –¥–æ–¥–∞—î –µ–∫—Å–ø–æ—Ä—Ç —Ç–∞ —ñ–º–ø–æ—Ä—Ç –∫–æ—à–∏–∫–∞/–∑–∞–º–æ–≤–ª–µ–Ω—å —É CSV/XLSX.

## –ú–æ–∂–ª–∏–≤–æ—Å—Ç—ñ

- **–ï–∫—Å–ø–æ—Ä—Ç**
  - –ö–æ—à–∏–∫ –∞–±–æ –æ–∫—Ä–µ–º–µ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è
  - –§–æ—Ä–º–∞—Ç–∏: CSV (UTF-8, `;`) –∞–±–æ XLSX (—á–µ—Ä–µ–∑ PhpSpreadsheet)
  - –ù–∞–ª–∞—à—Ç–æ–≤—É–≤–∞–Ω—ñ –∫–æ–ª–æ–Ω–∫–∏ (SKU, GTIN, –ù–∞–∑–≤–∞, –ö-—Å—Ç—å, –¶—ñ–Ω–∞, –°—É–º–∞, –ü—Ä–∏–º—ñ—Ç–∫–∞)
  - –†–µ–∂–∏–º–∏: ¬´–ó–∞–≥–∞–ª—å–Ω–∞¬ª –∞–±–æ ¬´–ü–æ —Å–∫–ª–∞–¥–∞—Ö¬ª (split per location)
  - –ü–∞–º‚Äô—è—Ç–∞—î –≤–∏–±—ñ—Ä –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ (localStorage)

- **–Ü–º–ø–æ—Ä—Ç**
  - –Ü–º–ø–æ—Ä—Ç —É **–∫–æ—à–∏–∫** (–∑ —É—Ä–∞—Ö—É–≤–∞–Ω–Ω—è–º —Å–∫–ª–∞–¥—ñ–≤, –∑–∞–ª–∏—à–∫—ñ–≤, –º—ñ–Ω/–º–∞–∫—Å)
  - –Ü–º–ø–æ—Ä—Ç —É **—á–µ—Ä–Ω–µ—Ç–∫—É –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è** (–Ω–æ–≤–∏–π —Å—Ç–∞—Ç—É—Å `wc-pc-draft`)
    - –î–æ–¥–∞—î –≤—Å—ñ –ø–æ–∑–∏—Ü—ñ—ó –Ω–µ–∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ –Ω–∞ —Å–∫–ª–∞–¥—ñ
    - –ü—ñ–¥—Ö–æ–¥–∏—Ç—å –¥–ª—è ¬´—à–∞–±–ª–æ–Ω—ñ–≤ –∑–∞–º–æ–≤–ª–µ–Ω—å¬ª —á–∏ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ—Ö –∑–∞—è–≤–æ–∫
    - –ù–µ –Ω–∞–¥—Å–∏–ª–∞—î –µ–º–µ–π–ª–∏

- **–§–æ—Ä–º–∞—Ç CSV**

```
sku;qty
gtin;qty
```
‚Ä¢	–ú–∏–Ω–∏–º—É–º –±–µ–∑ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤

```csv
CR-CE0900056400;3
CR-CE0900056428;10
```

‚Üí —Ç—Ä–∞–∫—Ç—É–µ—Ç—Å—è –∫–∞–∫ sku;qty.

	‚Ä¢	–° –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```csv
–ê—Ä—Ç–∏–∫—É–ª;–ö—ñ–ª—å–∫—ñ—Å—Ç—å
CR-CE0900056400;3
CR-CE0900056428;10
```

–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è –∫–æ–ª–æ–Ω–æ–∫

–ü–ª–∞–≥–∏–Ω –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç –∑–∞–≥–æ–ª–æ–≤–∫–∏ (–Ω–∏–∂–Ω–∏–π —Ä–µ–≥–∏—Å—Ç—Ä, —É–±–∏—Ä–∞–µ—Ç –ø—Ä–æ–±–µ–ª—ã, –≤–∞—Ä–∏–∞–Ω—Ç—ã –Ω–∞ —É–∫—Ä/—Ä—É—Å/–∞–Ω–≥–ª).
–î–ª—è –∫–∞–∂–¥–æ–π –ª–æ–≥–∏—á–µ—Å–∫–æ–π –∫–æ–ª–æ–Ω–∫–∏ –µ—Å—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –¥–æ–ø—É—Å—Ç–∏–º—ã—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤:

–ü–æ–ª–µ				–ü—Ä–∏–º–µ—Ä—ã –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤
SKU				sku, –∞—Ä—Ç–∏–∫—É–ª, –∫–æ–¥, product_sku, —Ç–æ–≤–∞—Ä
GTIN			gtin, —à—Ç—Ä–∏—Ö–∫–æ–¥, ean, ean13, barcode, UPC
–ö—ñ–ª—å–∫—ñ—Å—Ç—å (qty)	qty, –∫—ñ–ª—å–∫—ñ—Å—Ç—å, –∫–æ–ª-–≤–æ, –∫-—Å—Ç—å, quantity, amount, q
–¶—ñ–Ω–∞ (price)	price, —Ü—ñ–Ω–∞, —Å—Ç–æ–∏–º–æ—Å—Ç—å, unit price, cena

–ê–ª–≥–æ—Ä–∏—Ç–º
	1.	–ï—Å–ª–∏ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –Ω–µ—Ç ‚Üí —Å—á–∏—Ç–∞–µ–º, —á—Ç–æ –ø–µ—Ä–≤—ã–µ –¥–≤–µ –∫–æ–ª–æ–Ω–∫–∏ —ç—Ç–æ sku;qty.
	2.	–ï—Å–ª–∏ –∑–∞–≥–æ–ª–æ–≤–∫–∏ –µ—Å—Ç—å ‚Üí –∏—â–µ–º —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è –ø–æ —Ç–∞–±–ª–∏—Ü–µ –≤—ã—à–µ.
	3.	–û—Å—Ç–∞–ª—å–Ω–æ–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä name, note) –º–æ–∂–Ω–æ –≤–∫–ª—é—á–∞—Ç—å, –Ω–æ –æ–Ω–æ –±—É–¥–µ—Ç –ø—Ä–æ–∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–æ –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ.

‚∏ª

–ü—Ä–∏–º–µ—Ä ¬´–≥–∏–±–∫–æ–≥–æ¬ª —Ñ–∞–π–ª–∞

```csv
ean13,amount,unit price
4820035801234,5,124.00
4820035805678,2,248.00

–ö–æ–¥;–ö-—Å—Ç—å;–¶—ñ–Ω–∞
CR-CE0900056400;3;124.00
CR-CE0900056428;10;124.00
```

–æ–±–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã üëç

- –†–æ–∑–¥—ñ–ª—é–≤–∞—á `;` –∞–±–æ `,`
- –î—Ä–æ–±–æ–≤—ñ: –∫—Ä–∞–ø–∫–∞ –∞–±–æ –∫–æ–º–∞
- –¢–∏—Å—è—á–Ω—ñ –ø—Ä–æ–±—ñ–ª–∏ —ñ –Ω–µ-–∑–Ω–∞–∫ —ñ–≥–Ω–æ—Ä—É—é—Ç—å—Å—è

## –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è

- –ú‚Äô—è–∫–∞ –∑–∞–ª–µ–∂–Ω—ñ—Å—Ç—å –≤—ñ–¥ WooCommerce
- PhpSpreadsheet —Ç—è–≥–Ω–µ—Ç—å—Å—è —á–µ—Ä–µ–∑ –∑–∞–≥–∞–ª—å–Ω–∏–π `wp-content/vendor`  
(autoload —É `mu-plugins/00-composer-autoload.php`)

## –°—Ç–∞—Ç—É—Å

- –í–µ—Ä—Å—ñ—è: 1.0.0
- –ê–≤—Ç–æ—Ä: PaintCore
- –õ—ñ—Ü–µ–Ω–∑—ñ—è: GPL-2.0+


</details>


<details>
<summary><strong>stock-sync-to-woo.php ‚Äî —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –æ—Å—Ç–∞—Ç–∫–æ–≤ –≤ WooCommerce</strong></summary>

```txt
–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ.
–ë–µ—Ä—ë—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã wp_stock_import (sku, location_slug, qty) –∏ –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç –∏—Ö –≤ WooCommerce:
	‚Ä¢	–ø–∏—à–µ—Ç –æ—Å—Ç–∞—Ç–∫–∏ –≤ –º–µ—Ç–∞-–∫–ª—é—á–∏ _stock_at_{TERM_ID} (–∏ –ø—Ä–∏ –æ–ø—Ü–∏–∏ ‚Äî _stock_at_{slug}),
	‚Ä¢	—Å—É–º–º–∏—Ä—É–µ—Ç –∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç _stock,
	‚Ä¢	–æ–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å in stock / out of stock,
	‚Ä¢	–ø—Ä–∏–≤—è–∑—ã–≤–∞–µ—Ç —Ç–æ–≤–∞—Ä –∫ —Ç–µ—Ä–º–∞–º —Ç–∞–∫—Å–æ–Ω–æ–º–∏–∏ location,
	‚Ä¢	–º–æ–∂–µ—Ç –≤—ã—Å—Ç–∞–≤–∏—Ç—å Primary location.

‚∏ª

–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç
	1.	–ë–µ—Ä—ë–º –ø–∞—Ä—Ç–∏–∏ —Å—Ç—Ä–æ–∫ –∏–∑ wp_stock_import (batch size ‚Äî –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 500).
	2.	–î–ª—è –∫–∞–∂–¥–æ–≥–æ SKU:
	‚Ä¢	–∏—â–µ–º —Ç–æ–≤–∞—Ä –ø–æ SKU (product –∏–ª–∏ variation),
	‚Ä¢	–∏—â–µ–º —Å–∫–ª–∞–¥ –ø–æ location_slug –≤ —Ç–∞–∫—Å–æ–Ω–æ–º–∏–∏ location,
	‚Ä¢	–ø–∏—à–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤ _stock_at_{TERM_ID},
	‚Ä¢	–ø—Ä–∏ –≤–∫–ª—é—á—ë–Ω–Ω–æ–π –æ–ø—Ü–∏–∏ ‚Äî –¥—É–±–ª–∏—Ä—É–µ–º –≤ _stock_at_{slug}.
	3.	–û–±–Ω–æ–≤–ª—è–µ–º —Å—É–º–º–∞—Ä–Ω—ã–π –æ—Å—Ç–∞—Ç–æ–∫ _stock.
	4.	–ü–æ –æ–ø—Ü–∏—è–º:
	‚Ä¢	upd_status ‚Äî –æ–±–Ω–æ–≤–∏—Ç—å _stock_status (instock / outofstock),
	‚Ä¢	set_manage ‚Äî –≤–∫–ª—é—á–∏—Ç—å manage_stock=yes,
	‚Ä¢	attach_terms ‚Äî –ø—Ä–∏–≤—è–∑–∞—Ç—å —Ç–æ–≤–∞—Ä –∫ —Ç–∞–∫—Å–æ–Ω–æ–º–∏–∏ location,
	‚Ä¢	set_primary ‚Äî –µ—Å–ª–∏ –Ω–µ—Ç primary, –ø–æ—Å—Ç–∞–≤–∏—Ç—å –ø–µ—Ä–≤—ã–π –∏–∑ —Å–∫–ª–∞–¥–æ–≤,
	‚Ä¢	delete_rows ‚Äî —É–¥–∞–ª—è—Ç—å –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏,
	‚Ä¢	loop_until_empty ‚Äî –ø–æ–≤—Ç–æ—Ä—è—Ç—å —Ü–∏–∫–ª –¥–æ –ø—É—Å—Ç–æ–π —Ç–∞–±–ª–∏—Ü—ã.

‚∏ª

–û–ø—Ü–∏–∏ (–∞–¥–º–∏–Ω–∫–∞ ‚Üí –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã ‚Üí ¬´–°–∏–Ω—Ö—Ä. –æ—Å—Ç–∞—Ç–∫–æ–≤ ‚Üí Woo¬ª)
	‚Ä¢	Batch size ‚Äî —Å–∫–æ–ª—å–∫–æ —Å—Ç—Ä–æ–∫ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –∑–∞ –ø—Ä–æ—Ö–æ–¥.
	‚Ä¢	Dry-Run ‚Äî —Ç–æ–ª—å–∫–æ –ø–æ–∫–∞–∑–∞—Ç—å, –±–µ–∑ –∑–∞–ø–∏—Å–∏.
	‚Ä¢	–§–∏–ª—å—Ç—Ä –ø–æ SKU (–ø—Ä–µ—Ñ–∏–∫—Å) ‚Äî –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ —Ç–æ–≤–∞—Ä—ã —Å –∑–∞–¥–∞–Ω–Ω—ã–º –ø—Ä–µ—Ñ–∏–∫—Å–æ–º SKU.
	‚Ä¢	–û–±–Ω–æ–≤–ª—è—Ç—å —Å—Ç–∞—Ç—É—Å –Ω–∞–ª–∏—á–∏—è (_stock_status).
	‚Ä¢	–í–∫–ª—é—á–∞—Ç—å manage_stock.
	‚Ä¢	–£–¥–∞–ª—è—Ç—å —Å—Ç—Ä–æ–∫–∏ –∏–∑ wp_stock_import –ø–æ—Å–ª–µ –∑–∞–ø–∏—Å–∏.
	‚Ä¢	–ö—Ä—É—Ç–∏—Ç—å—Å—è –¥–æ –ø—É—Å—Ç–æ–π —Ç–∞–±–ª–∏—Ü—ã (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–æ —É–¥–∞–ª–µ–Ω–∏–µ —Å—Ç—Ä–æ–∫).
	‚Ä¢	–ü—Ä–∏–≤—è–∑—ã–≤–∞—Ç—å location –∫ —Ç–æ–≤–∞—Ä–∞–º.
	‚Ä¢	–°—Ç–∞–≤–∏—Ç—å Primary location.
	‚Ä¢	–î—É–±–ª–∏—Ä–æ–≤–∞—Ç—å –º–µ—Ç—ã –ø–æ slug ‚Äî –ø–∏—Å–∞—Ç—å _stock_at_{slug} –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏.

‚∏ª

–ü—Ä–∏–º–µ—Ä —Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–æ—Å–ª–µ —Å–∏–Ω–∫–∞
	‚Ä¢	_stock_at_3942 = 12
	‚Ä¢	_stock_at_3943 = 32
	‚Ä¢	_stock = 44
	‚Ä¢	_yoast_wpseo_primary_location = 3942
	‚Ä¢	–ü—Ä–∏–≤—è–∑–∫–∞ –∫ taxonomy = location (—á–µ—Ä–µ–∑ wp_term_relationships).

‚∏ª

–û—Ç—á—ë—Ç

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç:
	‚Ä¢	—Å–∫–æ–ª—å–∫–æ —Å—Ç—Ä–æ–∫ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ,
	‚Ä¢	—Å–∫–æ–ª—å–∫–æ —Ç–æ–≤–∞—Ä–æ–≤ –æ–±–Ω–æ–≤–ª–µ–Ω–æ,
	‚Ä¢	–∫–∞–∫–∏–µ SKU –Ω–µ –Ω–∞–π–¥–µ–Ω—ã,
	‚Ä¢	–∫–∞–∫–∏–µ location_slug –Ω–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω—ã,
	‚Ä¢	–∫–∞–∫–∏–µ –º–µ—Ç–∞-–∫–ª—é—á–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏—Å—å,
	‚Ä¢	—Å–∫–æ–ª—å–∫–æ –∑–∞–ø–∏—Å–µ–π –¥–æ–±–∞–≤–ª–µ–Ω–æ/–æ–±–Ω–æ–≤–ª–µ–Ω–æ –≤ wp_postmeta.

‚∏ª

–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
	‚Ä¢	Dry-Run ‚Üí –º–æ–∂–Ω–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –æ—Ç—á—ë—Ç –±–µ–∑ –∑–∞–ø–∏—Å–∏ –≤ –º–µ—Ç—É.
	‚Ä¢	–ï—Å–ª–∏ SKU –Ω–µ –Ω–∞–π–¥–µ–Ω ‚Äî –±—É–¥–µ—Ç –≤ not_found_skus.
	‚Ä¢	–ï—Å–ª–∏ —Å–∫–ª–∞–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω ‚Äî –±—É–¥–µ—Ç –≤ not_found_locations.
	‚Ä¢	–°–æ—Å—Ç–æ—è–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã: SELECT COUNT(*) FROM wp_stock_import;.
```
</details>

<details>
<summary><strong>3) mu-plugins/stock-locations-ui.php ‚Äî UI —Å–∫–ª–∞–¥–æ–≤ (–∫–∞—Ç–∞–ª–æ–≥ / PDP / –∫–æ—Ä–∑–∏–Ω–∞)</strong></summary>

```

–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ. –ï–¥–∏–Ω—ã–π –±–ª–æ–∫ –æ—Å—Ç–∞—Ç–∫–æ–≤ –ø–æ —Å–∫–ª–∞–¥–∞–º –∏ —Å—Ç—Ä–æ–∫–∞ ¬´–°–ø–∏—Å–∞–Ω–∏–µ¬ª –≤ –∫–æ—Ä–∑–∏–Ω–µ/—á–µ–∫–∞—É—Ç–µ.
–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç:
	‚Ä¢	–ó–∞–∫–∞–∑ —Å–æ —Å–∫–ª–∞–¥–∞: –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–π (–≤—ã–±—Ä–∞–Ω–Ω—ã–π/primary)
	‚Ä¢	–î—Ä—É–≥–∏–µ —Å–∫–ª–∞–¥—ã: —Å–ø–∏—Å–æ–∫ ¬´–ò–º—è ‚Äî qty¬ª (—Ç–æ–ª—å–∫–æ —Å qty > 0)
	‚Ä¢	–í—Å–µ–≥–æ: —Å—É–º–º–∞—Ä–Ω—ã–π –æ—Å—Ç–∞—Ç–æ–∫
	‚Ä¢	–í –∫–æ—Ä–∑–∏–Ω–µ/—á–µ–∫–∞—É—Ç–µ —Å—Ç—Ä–æ–∫—É ¬´–°–ø–∏—Å–∞–Ω–∏–µ: –ö–∏—ó–≤ ‚Äî 2, –û–¥–µ—Å–∞ ‚Äî 1¬ª –ø–æ –ø–ª–∞–Ω—É —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è.

–†–µ–∂–∏–º—ã —Ä–∞–±–æ—Ç—ã: auto / manual / single (–±–µ—Ä—É—Ç—Å—è –∏–∑ —Å–µ–ª–µ–∫—Ç–æ—Ä–∞ –≤ —à–∞–ø–∫–µ: cookie/—Å–µ—Å—Å–∏—è).
–ö–æ–Ω—Ç–µ–∫—Å—Ç –ø–æ–∫–∞–∑–∞: PDP, –ª—É–ø –∫–∞—Ç–∞–ª–æ–≥–∞, –∫–æ—Ä–∑–∏–Ω–∞/—á–µ–∫–∞—É—Ç.

```
–ì–¥–µ –±–µ—Ä—É—Ç—Å—è –¥–∞–Ω–Ω—ã–µ
```

–ß—Ç–æ                                   –ò—Å—Ç–æ—á–Ω–∏–∫

–°–ø–∏—Å–æ–∫ –ª–æ–∫–∞—Ü–∏–π —Ç–æ–≤–∞—Ä–∞           —Ç–∞–∫—Å–æ–Ω–æ–º–∏—è location (wp_term_relationships ‚Üí wp_terms)
–û—Å—Ç–∞—Ç–æ–∫ –ø–æ –ª–æ–∫–∞—Ü–∏–∏              wp_postmeta._stock_at_{term_id} (–¥–ª—è –≤–∞—Ä–∏–∞—Ü–∏–π ‚Äî —Ñ–æ–ª–±—ç–∫ –∫ —Ä–æ–¥–∏—Ç–µ–ª—é)
–û–±—â–∏–π –æ—Å—Ç–∞—Ç–æ–∫                   wp_postmeta._stock (–µ—Å–ª–∏ –Ω–µ—Ç ‚Äî —Å—É–º–º–∏—Ä—É–µ–º _stock_at_%)
Primary-–ª–æ–∫–∞—Ü–∏—è                 wp_postmeta._yoast_wpseo_primary_location (–∑–Ω–∞—á–µ–Ω–∏–µ = term_id)
–£–∂–µ –≤ –∫–æ—Ä–∑–∏–Ω–µ                   –æ–±—ä—ë–º –∏–∑ WC()->cart –ø–æ –ø—Ä–æ–¥—É–∫—Ç—É/–≤–∞—Ä–∏–∞—Ü–∏–∏

```
–ö–ª—é—á–µ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
```php

pc_build_stock_view( WC_Product $product ): array
// –°–æ–±–∏—Ä–∞–µ—Ç –∏ —Å–æ—Ä—Ç–∏—Ä—É–µ—Ç –ª–æ–∫–∞—Ü–∏–∏ –ø–æ–¥ —Ä–µ–∂–∏–º (—É–±–∏—Ä–∞–µ—Ç –Ω—É–ª–µ–≤—ã–µ), –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç:
// ['mode','preferred','primary','ordered' => [term_id => ['name','qty']], 'sum']

slu_render_stock_panel( WC_Product $product, array $opts = [] ): string
// –†–µ–Ω–¥–µ—Ä –±–ª–æ–∫–∞ (–∫–∞—Ç–∞–ª–æ–≥ + PDP), —É—á–∏—Ç—ã–≤–∞–µ—Ç —Ä–µ–∂–∏–º –∏ –æ–ø—Ü–∏–∏ (—Å–º. —Ç–∞–±–ª–∏—Ü—É –Ω–∏–∂–µ)

slu_get_allocation_plan( WC_Product $product, int $need, string $strategy='primary_first' ): array
// –°—Ç—Ä–æ–∏—Ç –ø–ª–∞–Ω —Å–ø–∏—Å–∞–Ω–∏—è [ term_id => qty ] —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º primary ‚Üí –æ—Å—Ç–∞–ª—å–Ω—ã–µ (qty –ø–æ —É–±—ã–≤–∞–Ω–∏—é)

slu_render_allocation_line( WC_Product $product, int $need ): string
// –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç—Ä–æ–∫—É "–ö–∏—ó–≤ ‚Äî 2, –û–¥–µ—Å–∞ ‚Äî 1" –ø–æ –ø–ª–∞–Ω—É —Å–ø–∏—Å–∞–Ω–∏—è

```
–û–ø—Ü–∏–∏ —Ä–µ–Ω–¥–µ—Ä–∞ –ø–∞–Ω–µ–ª–∏ (slu_render_stock_panel)
```

–û–ø—Ü–∏—è         –¢–∏–ø       –î–µ—Ñ–æ–ª—Ç        –ß—Ç–æ –¥–µ–ª–∞–µ—Ç
wrap_class    string      ''        –î–æ–ø. –∫–ª–∞—Å—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
show_primary  bool      true        –û—Å—Ç–∞–≤–ª–µ–Ω–æ –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ (–ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–µ—Ä–≤—É—é —Å—Ç—Ä–æ–∫—É)
show_others   bool      true        –ü–æ–∫–∞–∑ –æ—Å—Ç–∞–ª—å–Ω—ã—Ö –ª–æ–∫–∞—Ü–∏–π
show_total    bool      true        –ü–æ–∫–∞–∑ —Å—Ç—Ä–æ–∫–∏ ¬´–í—Å–µ–≥–æ: N¬ª
show_incart   bool      false       (–∑–∞—Ä–µ–∑. –Ω–∞ –±—É–¥—É—â–µ–µ)
show_incart_plan bool   false       (–∑–∞—Ä–µ–∑. –Ω–∞ –±—É–¥—É—â–µ–µ)
hide_when_zero   bool   false       –ï—Å–ª–∏ –Ω–µ—á–µ–≥–æ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å (–ø–æ—Å–ª–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –Ω—É–ª–µ–π) ‚Äî —Å–∫—Ä—ã—Ç—å –±–ª–æ–∫

–í–∞–∂–Ω–æ: –ø–µ—Ä–µ–¥ —Ä–µ–Ω–¥–µ—Ä–æ–º –Ω—É–ª–µ–≤—ã–µ —Å–∫–ª–∞–¥—ã –∑–µ—Ä–∫–∞–ª—å–Ω–æ —Ñ–∏–ª—å—Ç—Ä—É—é—Ç—Å—è (qty <= 0 ‚Üí –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º).
–í —Ä–µ–∂–∏–º–µ single –±–ª–æ–∫ –≤–æ–æ–±—â–µ –Ω–µ —Ä–∏—Å—É–µ—Ç—Å—è, –µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Å–∫–ª–∞–¥ –ø—É—Å—Ç.

‚∏ª

–í—Å—Ç—Ä–∞–∏–≤–∞–Ω–∏–µ –≤ —à–∞–±–ª–æ–Ω—ã (–µ—Å—Ç—å –≤ –ø–ª–∞–≥–∏–Ω–µ)
	‚Ä¢	PDP: woocommerce_single_product_summary (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç 25)
	‚Ä¢	–ö–∞—Ç–∞–ª–æ–≥: woocommerce_after_shop_loop_item_title (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç 11, –∫–ª–∞—Å—Å slu-stock-mini, hide_when_zero=true)
	‚Ä¢	–ö–æ—Ä–∑–∏–Ω–∞/—á–µ–∫–∞—É—Ç (—Å—Ç—Ä–æ–∫–∞ ¬´–°–ø–∏—Å–∞–Ω–∏–µ¬ª):
```
```
add_filter('woocommerce_get_item_data', 'slu_cart_allocation_row', 30, 2);
```
```
–•—É–∫–∏/—Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ
	‚Ä¢	–ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–ª–∞–Ω–∞ —Å–ø–∏—Å–∞–Ω–∏—è:
```
```
add_filter('slu_allocation_plan', function($plan, $product, $need, $strategy){
    // –≤–µ—Ä–Ω–∏ –º–∞—Å—Å–∏–≤ [ term_id => qty ], —á—Ç–æ–±—ã –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–º–µ–Ω–∏—Ç—å –ª–æ–≥–∏–∫—É
    return null; // –≤–µ—Ä–Ω—É—Ç—å –º–∞—Å—Å–∏–≤, —á—Ç–æ–±—ã –ø—Ä–∏–º–µ–Ω–∏–ª—Å—è –æ–Ω; null ‚Äî –æ—Å—Ç–∞–≤–∏—Ç—å –¥–µ—Ñ–æ–ª—Ç
}, 10, 4);
```
```
	‚Ä¢	–û—Ç–∫–ª—é—á–µ–Ω–∏–µ ¬´—Å—Ç–∞—Ä—ã—Ö¬ª —Å—Ç—Ä–æ–∫ —Å–∫–ª–∞–¥–æ–≤ –≤ –∫–æ—Ä–∑–∏–Ω–µ (–µ—Å–ª–∏ –∏—Ö –¥–æ–±–∞–≤–ª—è–µ—Ç –¥—Ä—É–≥–æ–π –º–æ–¥—É–ª—å):
// add_filter('pc_disable_legacy_cart_locations', '__return_true');

–®–æ—Ä—Ç–∫–æ–¥

–ü–æ–∫–∞–∑–∞—Ç—å –ø–ª–∞–Ω —Å–ø–∏—Å–∞–Ω–∏—è –≤ –ª—é–±–æ–º –º–µ—Å—Ç–µ:

[pc_stock_allocation product_id="43189" qty="3"]

–ö–ª–∞—Å—Å—ã –∏ —Å—Ç–∏–ª–∏ (–≤—à–∏—Ç—ã–µ; –º–æ–∂–Ω–æ –≤—ã–Ω–µ—Å—Ç–∏ –≤ —Ç–µ–º—É)
	‚Ä¢	slu-stock-box ‚Äî –±–∞–∑–æ–≤—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä (PDP)
	‚Ä¢	slu-stock-mini ‚Äî –∫–æ–º–ø–∞–∫—Ç–Ω—ã–π –≤–∏–¥ (–∫–∞—Ç–∞–ª–æ–≥)
	‚Ä¢	.is-preferred ‚Äî –ø–æ–¥—Å–≤–µ—Ç–∫–∞ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–æ–≥–æ —Å–∫–ª–∞–¥–∞
	‚Ä¢	.slu-nb .slu-stock-total ‚Äî ¬´–í—Å–µ–≥–æ: N¬ª —Ñ–∏–∫—Å–∏—Ä—É–µ–º –≤ –æ–¥–Ω—É —Å—Ç—Ä–æ–∫—É

‚∏ª

–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
	1.	–ù–∞ PDP/–∫–∞—Ç–∞–ª–æ–≥–µ –Ω–µ—Ç –±–ª–æ–∫–∞ ‚Äî –ø—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –æ—Å—Ç–∞—Ç–∫–æ–≤ > 0 (–Ω—É–ª–∏ —Å–∫—Ä—ã–≤–∞—é—Ç—Å—è), –∏ —á—Ç–æ —Ç–æ–≤–∞—Ä –ø—Ä–∏–≤—è–∑–∞–Ω –∫ —Ç–∞–∫—Å–æ–Ω–æ–º–∏–∏ location.
	2.	–ö–æ—Ä–∑–∏–Ω–∞ –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç ¬´–°–ø–∏—Å–∞–Ω–∏–µ¬ª ‚Äî —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –Ω–∞—Ö–æ–¥–∏—Ç –ø–ª–∞–Ω (slu_get_allocation_plan) –∏ —Ö—É–∫ woocommerce_get_item_data –∞–∫—Ç–∏–≤–µ–Ω.
	3.	–ù—É–∂–µ–Ω –¥—Ä—É–≥–æ–π –ø–æ—Ä—è–¥–æ–∫ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞ ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ–∏–ª—å—Ç—Ä slu_allocation_plan (–Ω–∞–ø—Ä–∏–º–µ—Ä, ¬´–≤—Å–µ–≥–¥–∞ —Å–Ω–∞—á–∞–ª–∞ –û–¥–µ—Å—Å–∞¬ª).
	4.	–í —Ä–µ–∂–∏–º–µ single –ø—É—Å—Ç–æ–π —Å–∫–ª–∞–¥ ‚Üí –±–ª–æ–∫ —Å–∫—Ä—ã–≤–∞–µ—Ç—Å—è –ø–æ –¥–∏–∑–∞–π–Ω—É.
```

</details>

üîé –ü–æ–∏—Å–∫ –∏ –ø–æ–¥—Å–≤–µ—Ç–∫–∞ (Relevanssi + MU)
<details>
<summary><strong>6) psu-search-filters.php ‚Äî –ü–æ–∏—Å–∫ –∏ –ø–æ–¥—Å–≤–µ—Ç–∫–∞ </strong></summary>

```text
–ß—Ç–æ –¥–∞—ë—Ç:
	‚Ä¢	–†–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–π –ø–æ–∏—Å–∫ (—á–µ—Ä–µ–∑ –ø–ª–∞–≥–∏–Ω Relevanssi).
	‚Ä¢	–ü–æ–¥—Å–≤–µ—Ç–∫–∞ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö —Å–ª–æ–≤ –≤ –∑–∞–≥–æ–ª–æ–≤–∫–∞—Ö –∫–∞—Ä—Ç–æ—á–µ–∫ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –ø–æ–∏—Å–∫–∞.
	‚Ä¢	(–û–ø—Ü.) –ë–∞–∑–æ–≤—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã ?location= –∏ ?in_stock=1 –¥–ª—è –≤–∏—Ç—Ä–∏–Ω Woo.

```
1) MU-–ø–ª–∞–≥–∏–Ω: wp-content/mu-plugins/psu-search-filters.php
2) –¢–µ–º–∞ (child): wp-content/themes/generatepress-child/functions.php

```php

// –°–Ω–∏–ø–ø–µ—Ç Relevanssi –ø–æ–¥ –∑–∞–≥–æ–ª–æ–≤–∫–æ–º –∫–∞—Ä—Ç–æ—á–∫–∏ –≤ –≤—ã–¥–∞—á–µ –ø–æ–∏—Å–∫–∞
add_action('woocommerce_after_shop_loop_item_title', function(){
    if (!is_search()) return;
    if (!function_exists('relevanssi_the_excerpt')) return;
    echo '<div class="relevanssi-snippet" style="margin:.35rem 0 .5rem; font-size:.9em; color:#555;">';
    relevanssi_the_excerpt();
    echo '</div>';
}, 8);

```

3) –¢–µ–º–∞ (child): style.css ‚Äî –ø–æ–¥—Å–≤–µ—Ç–∫–∞ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö —Å–ª–æ–≤

```css
/* === Search / Relevanssi highlights === */
.relevanssi-query-term{
  font-weight: 700;        /* –∂–∏—Ä–Ω—ã–π */
  background: #fff3a6;     /* –º—è–≥–∫–∞—è –∂—ë–ª—Ç–∞—è –ø–æ–¥–ª–æ–∂–∫–∞ */
}
/* === End Search === */

```

4) –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ Relevanssi

```text
	1.	Indexing ‚Üí Post types: –≤–∫–ª—é—á–∏—Ç—å product.
	2.	Indexing ‚Üí Custom fields: –¥–æ–±–∞–≤–∏—Ç—å _sku (–µ—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –∏—Å–∫–∞—Ç—å –ø–æ –∞—Ä—Ç–∏–∫—É–ª—É).
	3.	Searching ‚Üí Default operator: –æ–±—ã—á–Ω–æ AND (—Ç–æ—á–Ω–µ–µ –ø–æ —Ñ—Ä–∞–∑–∞–º).
	4.	Excerpts and highlights:
	‚Ä¢	–≤–∫–ª—é—á–∏—Ç—å Custom excerpts –∏ Highlighting search terms;
	‚Ä¢	–º–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å —Ç–∏–ø <strong> –∏–ª–∏ —Å—Ç–∏–ª—å/–∫–ª–∞—Å—Å –Ω–µ —Ç—Ä–æ–≥–∞—Ç—å (–º—ã –ø–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º —Å–≤–æ–∏–º –∫–ª–∞—Å—Å–æ–º).
	5.	Build the index (–ø–µ—Ä–≤—ã–π —Ä–∞–∑ ‚Äî –≤—Ä—É—á–Ω—É—é, –ø–æ—Ç–æ–º –∏–Ω–¥–µ–∫—Å –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏).
```

</details>
## üîå –ü–ª–∞–≥–∏–Ω—ã
<details>
<summary><strong>5) role-price/role-price.php ‚Äî —Ü–µ–Ω—ã –ø–æ —Ä–æ–ª—è–º (runtime)</strong></summary>

**–ò–¥–µ—è.** –î–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–æ–≤–∞—Ä–∞ –º–æ–∂–Ω–æ –∑–∞–¥–∞—Ç—å **—Å–≤–æ—é —Ü–µ–Ω—É –ø–æ–¥ —Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**.  
–ü–ª–∞–≥–∏–Ω –≤ —Ä–∞–Ω—Ç–∞–π–º–µ –ø–æ–¥–º–µ–Ω—è–µ—Ç —Ü–µ–Ω—É, –µ—Å–ª–∏ –¥–ª—è —Ç–µ–∫—É—â–µ–π —Ä–æ–ª–∏ –Ω–∞–π–¥–µ–Ω–∞ –º–µ—Ç–∞.

### –ö–∞–∫ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è –º–µ—Ç–∞-–∫–ª—é—á

wpc_price_role
```
–ü—Ä–∏–º–µ—Ä—ã:
- `_wpc_price_role_partner`
- `_wpc_price_role_opt`
- `_wpc_price_role_opt_osn`
- `_wpc_price_role_schule`

> –°—É—Ñ—Ñ–∏–∫—Å –±–µ—Ä—ë—Ç—Å—è –∏–∑ **–ø–µ—Ä–≤–æ–π —Ä–æ–ª–∏** –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: `$user->roles[0]`.

### –ì–¥–µ —Ö—Ä–∞–Ω–∏—Ç—Å—è
- –¢–∞–±–ª–∏—Ü–∞: `wp_postmeta`  
- –ö–ª—é—á: `_wpc_price_role_<role>`  
- –ó–Ω–∞—á–µ–Ω–∏–µ: —Ü–µ–Ω–∞ –∫–∞–∫ —Å—Ç—Ä–æ–∫–∞/decimal (–ø–æ—Ç–æ–º –ø—Ä–∏–≤–æ–¥–∏—Ç—Å—è –∫ `wc_get_price_decimals()`)

–ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤ –ë–î:
```sql
SELECT post_id, meta_key, meta_value
FROM wp_postmeta
WHERE meta_key LIKE '_wpc_price_role_%'
LIMIT 20;
```
–ö–∞–∫ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è —Ü–µ–Ω–∞ (—Ö—É–∫–∏ –∏ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã)

```
–≠—Ç–∞–ø                        –•—É–∫/–º–µ—Ö–∞–Ω–∏–∑–º                                   –ß—Ç–æ –¥–µ–ª–∞–µ—Ç

–ü–æ–¥–º–µ–Ω–∞ —Ü–µ–Ω—ã —Ç–æ–≤–∞—Ä–∞     woocommerce_product_get_price (prio 5)           –ï—Å–ª–∏ –Ω–∞–π–¥–µ–Ω–∞ —Ü–µ–Ω–∞ –ø–æ–¥ —Ä–æ–ª—å ‚Äî –≤–µ—Ä–Ω—É—Ç—å –µ—ë; 
                                                                            –∏–Ω–∞—á–µ –Ω–µ —Ç—Ä–æ–≥–∞—Ç—å ($price –∫–∞–∫ –±—ã–ª)
                                                                            
–ü–æ–¥–º–µ–Ω–∞ —Ü–µ–Ω—ã –≤–∞—Ä–∏–∞—Ü–∏–∏   woocommerce_product_variation_get_price (prio 5)  –¢–æ –∂–µ, –¥–ª—è –≤–∞—Ä–∏–∞—Ü–∏–π

–†–∞–∑–Ω—ã–µ —Ü–µ–Ω—ã –≤ –∫—ç—à–µ –≤–∞—Ä–∏–∞—Ü–∏–π   woocommerce_get_variation_prices_hash      –î–æ–±–∞–≤–ª—è–µ—Ç —Ä–æ–ª—å –≤ —Ö–µ—à: –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ 
                                                                        —Ç–æ–≤–∞—Ä –º–æ–∂–µ—Ç –∏–º–µ—Ç—å —Ä–∞–∑–Ω—ã–µ —Ü–µ–Ω—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ä–æ–ª–µ–π

–ü–µ—Ä–µ—Å—á—ë—Ç –≤ –∫–æ—Ä–∑–∏–Ω–µ        woocommerce_before_calculate_totals            –û–±–Ω–æ–≤–ª—è–µ—Ç —Ü–µ–Ω—É, –µ—Å–ª–∏ —Ç–æ–≤–∞—Ä –¥–æ–±–∞–≤–∏–ª–∏ ¬´–¥–æ¬ª 
                                                                          —Å–º–µ–Ω—ã —Ä–æ–ª–∏/–ø—Ä–∞–≤–∏–ª

–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 5 –≤—ã–±—Ä–∞–Ω —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ: –µ—Å–ª–∏ —Å–≤–æ–µ–π —Ü–µ–Ω—ã –Ω–µ—Ç, –º—ã –Ω–µ –º–µ—à–∞–µ–º —Å—Ç–æ—Ä–æ–Ω–Ω–∏–º —Å–∫–∏–¥–∫–∞–º/–ø–ª–∞–≥–∏–Ω–∞–º 
(–∫–æ—Ç–æ—Ä—ã–µ –æ–±—ã—á–Ω–æ –≤–∏—Å—è—Ç –Ω–∞ ~10 –∏ –Ω–∏–∂–µ).

```
CSV / –∏–º–ø–æ—Ä—Ç

–û–±—ã—á–Ω–æ —Ä–æ–ª–∏-—Ü–µ–Ω—ã –∑–∞–≤–æ–∑—è—Ç—Å—è –ø–∞–∫–µ—Ç–æ–º –≤–º–µ—Å—Ç–µ —Å–æ SKU (—Å–º. —Ä–∞–∑–¥–µ–ª ¬´SQL ‚Äî –≤–Ω–µ—Å–µ–Ω–∏–µ —Ü–µ–Ω¬ª).
–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π CSV:
```
sku;partner;opt;opt_osn;schule
CR-001;10.50;11.00;9.90;10.00
```
```
	‚Ä¢	–ü–æ—Å–ª–µ –∏–º–ø–æ—Ä—Ç–∞ —Ç—ã –ø–æ–ª—É—á–∏—à—å –º–µ—Ç—ã:
_wpc_price_role_partner, _wpc_price_role_opt, _wpc_price_role_opt_osn, _wpc_price_role_schule –Ω–∞ –ø–æ—Å—Ç–∞—Ö-—Ç–æ–≤–∞—Ä–∞—Ö.
	‚Ä¢	–°–∞–º role-price —Ç–æ–ª—å–∫–æ —á–∏—Ç–∞–µ—Ç —ç—Ç–∏ –º–µ—Ç—ã –∏ –ø–æ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Ü–µ–Ω—É –≤ —Ä–∞–Ω—Ç–∞–π–º–µ. –ò–º–ø–æ—Ä—Ç –¥–µ–ª–∞–µ—Ç –æ—Ç–¥–µ–ª—å–Ω—ã–π –º–æ–¥—É–ª—å/SQL.

–ê–ª–≥–æ—Ä–∏—Ç–º –ø–ª–∞–≥–∏–Ω–∞ (–≤ 3 —à–∞–≥–∞—Ö)
	1.	–ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –µ–≥–æ –ø–µ—Ä–≤—É—é —Ä–æ–ª—å.
	2.	–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –º–µ—Ç–∞-–∫–ª—é—á _wpc_price_role_<role> –∏ –ø—Ä–æ—á–∏—Ç–∞—Ç—å –º–µ—Ç—É –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ —Ç–æ–≤–∞—Ä–∞/–≤–∞—Ä–∏–∞—Ü–∏–∏.
	3.	–ï—Å–ª–∏ –º–µ—Ç–∞ –Ω–µ –ø—É—Å—Ç–∞—è ‚Äî –≤–µ—Ä–Ω—É—Ç—å —ç—Ç—É —Ü–µ–Ω—É; –∏–Ω–∞—á–µ –æ—Å—Ç–∞–≤–∏—Ç—å —Ç–æ, —á—Ç–æ –≤–µ—Ä–Ω—É–ª–æ —è–¥—Ä–æ/–¥—Ä—É–≥–∏–µ –ø–ª–∞–≥–∏–Ω—ã.

–ß–∞—Å—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã –∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
	‚Ä¢	¬´–¶–µ–Ω–∞ –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è¬ª ‚Äî –ø—Ä–æ–≤–µ—Ä—å, —á—Ç–æ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Ä–µ–∞–ª—å–Ω–æ –µ—Å—Ç—å —Ä–æ–ª—å (–∞ –Ω–µ guest) –∏ —á—Ç–æ —É —Ç–æ–≤–∞—Ä–∞ –µ—Å—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∞—è –º–µ—Ç–∞.
	‚Ä¢	¬´–°–∫–∏–¥–∫–∏ –Ω–µ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è¬ª ‚Äî —ç—Ç–æ –Ω–æ—Ä–º–∞, –µ—Å–ª–∏ –µ—Å—Ç—å –∫–∞—Å—Ç–æ–º–Ω–∞—è —Ä–æ–ª—å-—Ü–µ–Ω–∞: –æ–Ω–∞ –≥–ª–∞–≤–Ω–µ–µ. –ï—Å–ª–∏ —Ä–æ–ª–∏-—Ü–µ–Ω—ã –Ω–µ—Ç ‚Äî —Å–∫–∏–¥–∫–∏ —Å—Ç–æ—Ä–æ–Ω–Ω–∏—Ö –ø–ª–∞–≥–∏–Ω–æ–≤ –æ—Å—Ç–∞—é—Ç—Å—è.
	‚Ä¢	¬´–í–∞—Ä–∏–∞—Ü–∏–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –æ–¥–Ω—É —Ü–µ–Ω—É –¥–ª—è –≤—Å–µ—Ö¬ª ‚Äî –Ω—É–∂–µ–Ω —Ö—É–∫ woocommerce_get_variation_prices_hash (–æ–Ω –¥–æ–±–∞–≤–ª–µ–Ω).
	‚Ä¢	¬´–ü–æ—Å–ª–µ —Å–º–µ–Ω—ã —Ä–æ–ª–∏ –≤ –∫–æ—Ä–∑–∏–Ω–µ —Å—Ç–∞—Ä–∞—è —Ü–µ–Ω–∞¬ª ‚Äî –ø–µ—Ä–µ—Å—á—ë—Ç –¥–µ–ª–∞–µ—Ç —Ö—É–∫ woocommerce_before_calculate_totals (–æ–Ω –¥–æ–±–∞–≤–ª–µ–Ω).

–ö—É–¥–∞ —Å–º–æ—Ç—Ä–µ—Ç—å –≤ –∫–æ–¥–µ

wp-content/plugins/role-price/role-price.php
–ö–ª—é—á–µ–≤—ã–µ —Ç–æ—á–∫–∏:
	‚Ä¢	vp_role_price_override() ‚Äî –ø–æ–¥–º–µ–Ω–∞ —Ü–µ–Ω—ã —Ç–æ–≤–∞—Ä–∞/–≤–∞—Ä–∏–∞—Ü–∏–∏;
	‚Ä¢	—Ñ–∏–ª—å—Ç—Ä —Ö–µ—à–∞ –≤–∞—Ä–∏–∞—Ü–∏–π;
	‚Ä¢	–ø–µ—Ä–µ—Å—á—ë—Ç —Ü–µ–Ω—ã –≤ –∫–æ—Ä–∑–∏–Ω–µ.
```
</details>

<details>
<summary><strong>paint-shop-ux/paint-shop-ux.php ‚Äî UX-–ø—Ä–∞–≤–∫–∏ –∫–∞—Ç–∞–ª–æ–≥–∞</strong></summary>

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ.** –î–µ–ª–∞–µ—Ç –∫–∞—Ä—Ç–æ—á–∫–∏ —Ä–æ–≤–Ω–µ–µ –∏ –∫–æ–º–ø–∞–∫—Ç–Ω–µ–µ:
- –∫–æ—Ä–æ—Ç–∫–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è –≤ –∫–∞—Ç–∞–ª–æ–≥–µ (–±–µ—Ä—ë—Ç —á–∞—Å—Ç—å –ø–æ—Å–ª–µ `|`, –∏–Ω–∞—á–µ –ø–æ—Å–ª–µ–¥–Ω–∏–µ N —Å–∏–º–≤–æ–ª–æ–≤),
- –µ–¥–∏–Ω–∞—è –≤—ã—Å–æ—Ç–∞ –±–ª–æ–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (desktop/tablet/mobile),
- —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤—ã—Å–æ—Ç–∞ –∑–∞–≥–æ–ª–æ–≤–∫–∞ (—Ä–æ–≤–Ω–æ 2 —Å—Ç—Ä–æ–∫–∏), ¬´–ø–æ–¥–≤–∞–ª¬ª –∫–∞—Ä—Ç–æ—á–∫–∏ –ø—Ä–∏–∂–∞—Ç –≤–Ω–∏–∑,
- —á—É—Ç—å –º–µ–Ω—å—à–∏–π H1 –≤ –ª–∏—Å—Ç–∏–Ω–≥–∞—Ö –Ω–∞ –º–æ–±–∏–ª–∫–∞—Ö.

### –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã (—Ä—É—á–∫–∏ –ø–ª–∞–≥–∏–Ω–∞)
| –ö–æ–Ω—Å—Ç–∞–Ω—Ç–∞ | –ß—Ç–æ –¥–µ–ª–∞–µ—Ç | –î–µ—Ñ–æ–ª—Ç |
|---|---|---|
| `PSU_COLS_DESKTOP`  | —É–ø—Ä–∞–≤–ª—è—Ç—å –∫–æ–ª–æ–Ω–∫–∞–º–∏ PHP-–æ–º (–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è; —Å–µ—Ç–∫–∞ —É —Ç–µ–º—ã) | `0` (=–≤—ã–∫–ª) |
| `PSU_IMG_H_DESKTOP` | –≤—ã—Å–æ—Ç–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ –∫–∞—Ç–∞–ª–æ–≥–µ, px | `210` |
| `PSU_IMG_H_TABLET`  | –≤—ã—Å–æ—Ç–∞ –Ω–∞ –ø–ª–∞–Ω—à–µ—Ç–µ, px | `190` |
| `PSU_IMG_H_MOBILE`  | –≤—ã—Å–æ—Ç–∞ –Ω–∞ –º–æ–±–∏–ª–∫–µ, px | `180` |
| `PSU_TITLE_RESERVE` | –¥–ª–∏–Ω–∞ –∫–æ–º–ø–∞–∫—Ç–Ω–æ–≥–æ –Ω–∞–∑–≤–∞–Ω–∏—è (–µ—Å–ª–∏ –Ω–µ—Ç ¬´\|¬ª) | `25` |

> –°–µ—Ç–∫–∞ –∫–∞—Ç–∞–ª–æ–≥–∞ –æ—Å—Ç–∞—ë—Ç—Å—è –∑–∞ **child-theme** (CSS Grid); —ç—Ç–æ—Ç –ø–ª–∞–≥–∏–Ω –Ω–µ —Ç—Ä–æ–≥–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–ª–æ–Ω–æ–∫.

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç
- **–ö–æ–º–ø–∞–∫—Ç–Ω—ã–π title:** —Ö—É–∫ `woocommerce_shop_loop_item_title` –∑–∞–º–µ–Ω—ë–Ω –Ω–∞ —Å–≤–æ–π –≤—ã–≤–æ–¥.  
  –õ–æ–≥–∏–∫–∞: –µ—Å–ª–∏ –≤ –Ω–∞–∑–≤–∞–Ω–∏–∏ –µ—Å—Ç—å `|`, –±–µ—Ä—ë–º –ø—Ä–∞–≤—É—é —á–∞—Å—Ç—å. –ò–Ω–∞—á–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º **–ø–æ—Å–ª–µ–¥–Ω–∏–µ N —Å–∏–º–≤–æ–ª–æ–≤** (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 25, —é–Ω–∏–∫–æ–¥-–±–µ–∑–æ–ø–∞—Å–Ω–æ).
- **–ö–∞—Ä—Ç–∏–Ω–∫–∞:** –∏–Ω–ª–∞–π–Ω-CSS —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç –≤—ã—Å–æ—Ç—É, –¥–µ–ª–∞–µ—Ç `object-fit: contain`, –±–µ–ª—ã–π —Ñ–æ–Ω, –ø–∞–¥–¥–∏–Ω–≥–∏.
- **–†–æ–≤–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏:** `.product { display:flex; flex-direction:column }` –∏ –º–∞—Ä–¥–∂–∏–Ω—ã —É –∫–Ω–æ–ø–æ–∫/—Ü–µ–Ω—ã ‚Üí ¬´–ø–æ–¥–≤–∞–ª¬ª –≤—Å–µ–≥–¥–∞ –≤–Ω–∏–∑—É.
- **–ó–∞–≥–æ–ª–æ–≤–∫–∏ —Å–ø–∏—Å–∫–æ–≤:** `H1` –≤ –≤—ã–¥–∞—á–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –Ω–∞ –º–æ–±–∏–ª–∫–∞—Ö —É–º–µ–Ω—å—à–µ–Ω.

### –•—É–∫–∏
- `init` ‚Üí –æ—Ç–∫–ª—é—á–∞–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π `woocommerce_template_loop_product_title` –∏ –≤–∫–ª—é—á–∞–µ–º `psu_loop_title`.
- `wp_enqueue_scripts` ‚Üí –∏–Ω–ª–∞–π–Ω-CSS —Å –≤—ã—Å–æ—Ç–∞–º–∏ –∫–∞—Ä—Ç–∏–Ω–æ–∫ –∏ —Ñ–∏–∫—Å–∞–º–∏ –∫–∞—Ä—Ç–æ—á–µ–∫.
- (–æ–ø—Ü.) `loop_shop_columns` –∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω ‚Äî –Ω–µ –Ω—É–∂–µ–Ω –ø—Ä–∏ CSS Grid –∏–∑ —Ç–µ–º—ã.

### –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å
- **psu-force-per-page (MU):** —Å–æ–≤–º–µ—Å—Ç–∏–º. –≠—Ç–æ—Ç –ø–ª–∞–≥–∏–Ω –Ω–µ –º–µ–Ω—è–µ—Ç `per_page`, —Ç–æ–ª—å–∫–æ –≤—ë—Ä—Å—Ç–∫—É –∫–∞—Ä—Ç–æ—á–µ–∫.
- **–¢–µ–º–∞ (GeneratePress Child):** —Å–µ—Ç–∫–∞ (Grid) –∑–∞–¥–∞—ë—Ç—Å—è –≤ —Ç–µ–º–µ; –ø—Ä–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–µ —Å—Ç–∏–ª–µ–π ‚Äî —É–¥–∞–ª–∏ –¥—É–±–ª–∏—Ä—É—é—â–∏–µ—Å—è —Ä–µ—Å–µ—Ç—ã –∏–∑ `style.css` —Ç–µ–º—ã.

### –ë—ã—Å—Ç—Ä–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ (–ø—Ä–∏–º–µ—Ä—ã)
```php
// –°–¥–µ–ª–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤—ã—à–µ –Ω–∞ –¥–µ—Å–∫—Ç–æ–ø–µ –∏ –Ω–∏–∂–µ –Ω–∞ –º–æ–±–∏–ª–∫–µ
// –≤ –Ω–∞—á–∞–ª–µ –ø–ª–∞–≥–∏–Ω–∞ –æ–±–Ω–æ–≤–∏ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã:
const PSU_IMG_H_DESKTOP = 240;
const PSU_IMG_H_MOBILE  = 160;
```

```text
–ß—Ç–æ –º–µ–Ω—è—Ç—å, –µ—Å–ª–∏ ¬´–Ω–µ –ª–æ–≤–∏—Ç¬ª —á–∞—Å—Ç—å –ø–æ—Å–ª–µ |
	‚Ä¢	–ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –±–∞–∑–µ/–∏–º–µ–Ω–∏ —Ç–æ–≤–∞—Ä–∞ —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å ‚Äî –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–∞—è —á–µ—Ä—Ç–∞ | (–∞ –Ω–µ ¬´‚Äî¬ª/¬´-¬ª).
	‚Ä¢	–í —Ñ—É–Ω–∫—Ü–∏–∏ psu_compact_title_after_pipe($title, $reserve) –º–æ–∂–Ω–æ:
	‚Ä¢	–ó–∞–º–µ–Ω–∏—Ç—å strpos($t, '|') –Ω–∞ –ø–æ–∏—Å–∫ –ø–æ –¥—Ä—É–≥–æ–º—É —Å–∏–º–≤–æ–ª—É,
	‚Ä¢	–£–≤–µ–ª–∏—á–∏—Ç—å $reserve (—Å–∫–æ–ª—å–∫–æ —Å–∏–º–≤–æ–ª–æ–≤ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å, –µ—Å–ª–∏ | –Ω–µ—Ç).
```

</details>


```text
‚öôÔ∏è –ö–∞—Å—Ç–æ–º–Ω—ã–µ –º–æ–¥—É–ª–∏ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏


3) –ö–∞—Ç–∞–ª–æ–∂–Ω–∞—è ‚Äúqty + –≤ –∫–æ—Ä–∑–∏–Ω—É‚Äù (–∫–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø–Ω–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞)

–§–∞–π–ª: wp-content/plugins/paint-core/inc/scatalog-qty-add-to-cart.php (—É —Ç–µ–±—è –º–æ–∂–µ—Ç –Ω–∞–∑—ã–≤–∞—Ç—å—Å—è —á—É—Ç—å –∏–Ω–∞—á–µ, –Ω–æ —ç—Ç–æ UI-–ø–ª–∞–≥–∏–Ω –∫–∞—Ç–∞–ª–æ–≥–∞)
–ó–∞–¥–∞—á–∞:
	‚Ä¢	–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø–ª—é—Å/–º–∏–Ω—É—Å –∏ –ø–æ–ª–µ qty –≤ –ª–∏—Å—Ç–∏–Ω–≥–µ;
	‚Ä¢	–æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç –≤–≤–æ–¥ –ø–æ –¥–æ—Å—Ç—É–ø–Ω–æ–º—É –∫–æ–ª–∏—á–µ—Å—Ç–≤—É;
	‚Ä¢	–≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –∫–æ—Ä–∑–∏–Ω—ã.

–ö–ª—é—á–µ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏/—Ñ–∏–ª—å—Ç—Ä—ã:
	‚Ä¢	pcux_available_qty($product) ‚Äî –æ–±—â–∏–π –æ—Å—Ç–∞—Ç–æ–∫ (—Å—É–º–º–∞ _stock_at_% –ª–∏–±–æ _stock).
	‚Ä¢	pcux_available_for_add($product) ‚Äî –¥–æ—Å—Ç—É–ø–Ω–æ –∫ –¥–æ–±–∞–≤–ª–µ–Ω–∏—é = –æ–±—â–∏–π –æ—Å—Ç–∞—Ç–æ–∫ ‚àí —É–∂–µ –≤ –∫–æ—Ä–∑–∏–Ω–µ.
	‚Ä¢	woocommerce_add_to_cart_validation –∏ woocommerce_update_cart_validation ‚Äî —Å–µ—Ä–≤–µ—Ä–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞.
	‚Ä¢	–ï—Å–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω MU-—Ö–µ–ª–ø–µ—Ä, –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è \slu_total_available_qty() –∏ \slu_available_for_add().

–ì–¥–µ –ø—Ä–∞–≤–∏—Ç—å –ø–æ–≤–µ–¥–µ–Ω–∏–µ: –≤–Ω—É—Ç—Ä–∏ —Ñ—É–Ω–∫—Ü–∏–π pcux_available_qty/pcux_available_for_add –∏–ª–∏ –ø—Ä–æ–∫–∏–Ω—É—Ç—å —Å–≤–æ—é MU-—Ñ—É–Ω–∫—Ü–∏—é slu_*.

‚∏ª
5) –Ω–æ–≤–æ–æ–ø–∏—Å–∞–Ω–∏–µ –†–æ–∑–ø–æ–¥—ñ–ª —ñ —Ñ–∞–∫—Ç–∏—á–Ω–µ —Å–ø–∏—Å–∞–Ω–Ω—è –∑–∞–ª–∏—à–∫—ñ–≤ (—É–Ω—ñ—Ñ—ñ–∫–æ–≤–∞–Ω–æ)
–§–∞–π–ª: wp-content/plugins/paint-core/inc/order-allocator.php

–©–æ —Ä–æ–±–∏—Ç—å
	‚Ä¢	–ü–ª–∞–Ω —É —Ä—è–¥–∫–∞—Ö –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è: –Ω–∞ –µ—Ç–∞–ø—ñ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è –∑–∞–ø–∏—Å—É—î:
	‚Ä¢	_pc_alloc_plan (–¥–∂–µ—Ä–µ–ª–æ –∑ —Ö–µ–¥–µ—Ä–∞/—Å–≤—ñ—á–µ—Ä–∞),
	‚Ä¢	–≤–∏–¥–∏–º—É –º–µ—Ç—É ‚Äú–°–∫–ª–∞–¥: –ö–∏—ó–≤ √ó N, –û–¥–µ—Å–∞ √ó M‚Äù,
	‚Ä¢	_stock_location_id/_slug (–ø–µ—Ä—à–∏–π —Ä–µ–∞–ª—å–Ω–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–∏–π —Å–∫–ª–∞–¥).
	‚Ä¢	–†–µ–∞–ª—å–Ω–µ —Å–ø–∏—Å–∞–Ω–Ω—è: —á–∏—Ç–∞—î –ø–ª–∞–Ω —ñ –∑–º–µ–Ω—à—É—î _stock_at_{term_id} –¥–ª—è –≤—Å—ñ—Ö –ø–æ–∑–∏—Ü—ñ–π, –ø–æ—Ç—ñ–º –ø–µ—Ä–µ—Ä–∞—Ö–æ–≤—É—î _stock —Ç–∞ _stock_status.
–ê–Ω—Ç–∏–¥—É–±–ª—å: _pc_stock_reduced = yes.

–•—É–∫–∏
	‚Ä¢	–ü–æ–±—É–¥–æ–≤–∞ –ø–ª–∞–Ω—É: woocommerce_new_order (priority 5).
	‚Ä¢	–†–µ–¥—É–∫—Ü—ñ—è (–û–î–ò–ù —Ä–∞–∑):
woocommerce_order_status_processing (60),
woocommerce_order_status_completed (60).

–ù–∞ checkout_order_processed —Å–ø–∏—Å–∞–Ω—å –±—ñ–ª—å—à–µ –Ω–µ–º–∞—î.

–ü–µ—Ä–µ–æ–∑–Ω–∞—á–µ–Ω–Ω—è –∞–ª–≥–æ—Ä–∏—Ç–º—É
	‚Ä¢	–§—ñ–ª—å—Ç—Ä slu_allocation_plan ‚Äî —è–∫—â–æ –ø–æ–≤–µ—Ä–Ω—É—Ç–∏ –º–∞—Å–∏–≤ [term_id => qty], –±—É–¥–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–æ –≤–∞—à —Ä–æ–∑–ø–æ–¥—ñ–ª.
	‚Ä¢	–Ø–∫—â–æ —Ñ—ñ–ª—å—Ç—Ä –Ω—ñ—á–æ–≥–æ –Ω–µ –¥–∞–≤ ‚Äî –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è —Ü–µ–Ω—Ç—Ä–∞–ª—ñ–∑–æ–≤–∞–Ω–∏–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –∑ header-allocation-switcher.php (—Ñ—É–Ω–∫—Ü—ñ—è pc_calc_plan_for()).

–†—É—á–Ω—ñ –¥—ñ—ó –≤ –∞–¥–º—ñ–Ω—Ü—ñ
	‚Ä¢	Build stock allocation plan (PaintCore) ‚Äî –ø–µ—Ä–µ–±—É–¥—É–≤–∞—Ç–∏ –ø–ª–∞–Ω —ñ –º–µ—Ç–∏ —Ä—è–¥–∫—ñ–≤.
	‚Ä¢	Reduce stock from plan (PaintCore) ‚Äî –ø—Ä–∏–º—É—Å–æ–≤–æ —Å–ø–∏—Å–∞—Ç–∏.
	‚Ä¢	RESTORE stock from plan (PaintCore) ‚Äî –≤—ñ–¥–∫–æ—Ç–∏—Ç–∏ —Å–ø–∏—Å–∞–Ω–Ω—è (–ø–æ–≤–µ—Ä–Ω—É—Ç–∏ –∑–∞–ª–∏—à–∫–∏) —ñ –ø—Ä–∏–±—Ä–∞—Ç–∏ –º–µ—Ç—É _pc_stock_reduced.

–ó–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ/—Å—É–º—ñ—Å–Ω—ñ—Å—Ç—å
	‚Ä¢	–ü–æ–ª—è –∑–∞–ª–∏—à–∫—ñ–≤ –ø–æ —Å–∫–ª–∞–¥–∞—Ö: _stock_at_{TERM_ID}.
	‚Ä¢	–ó–∞–≥–∞–ª—å–Ω–∏–π _stock —Ä–∞—Ö—É—î—Ç—å—Å—è —è–∫ —Å—É–º–∞ –ø–æ _stock_at_*.
	‚Ä¢	–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–µ Woo-—Å–ø–∏—Å–∞–Ω–Ω—è –≤–∏–º–∫–Ω–µ–Ω–æ (—Ç–∏ –≤–∂–µ –≤–∏–¥–∞–ª–∏–≤ wc_maybe_reduce_stock_levels) + hold_stock_minutes = –ø–æ—Ä–æ–∂–Ω—å–æ.–Ω–æ–≤–æ–æ–ø–∏—Å–∞–Ω–∏–µ 



5) —Å—Ç–∞—Ä–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∏ —Ä–µ–∞–ª—å–Ω–æ–µ —Å–ø–∏—Å–∞–Ω–∏–µ –æ—Å—Ç–∞—Ç–∫–æ–≤

–§–∞–π–ª: wp-content/5) –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∏ —Ä–µ–∞–ª—å–Ω–æ–µ —Å–ø–∏—Å–∞–Ω–∏–µ –æ—Å—Ç–∞—Ç–∫–æ–≤

–§–∞–π–ª: wp-content/plugins/paint-core/inc/order-allocator.php
–ó–∞–¥–∞—á–∞:
	‚Ä¢	–ù–∞ —ç—Ç–∞–ø–µ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è/—Å—Ç–∞—Ç—É—Å–∞ —Å—Ç—Ä–æ–∏—Ç –ø–ª–∞–Ω —Å–ø–∏—Å–∞–Ω–∏—è –ø–æ —Å–∫–ª–∞–¥–∞–º –¥–ª—è –∫–∞–∂–¥–æ–π —Å—Ç—Ä–æ–∫–∏ –∑–∞–∫–∞–∑–∞
‚Üí –º–µ—Ç–∞ _pc_stock_breakdown = [ term_id => qty, ... ], –≤–∏–¥–∏–º–∞—è –º–µ—Ç–∞ ‚Äú–°–∫–ª–∞–¥: –ö–∏—ó–≤ √ó N, –û–¥–µ—Å–∞ √ó M‚Äù, _stock_location_id/_slug.
	‚Ä¢	–ü–æ—Ç–æ–º —Å–ø–∏—Å—ã–≤–∞–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–µ –æ—Å—Ç–∞—Ç–∫–∏ –∏–∑ –º–µ—Ç _stock_at_{term_id}, –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç _stock/_stock_status.
	‚Ä¢	–ê–Ω—Ç–∏–¥—É–±–ª—å: —Ñ–ª–∞–∂–æ–∫ _pc_stock_reduced = yes.

–•—É–∫–∏:
	‚Ä¢	–ü–ª–∞–Ω: woocommerce_new_order (—Ä–∞–Ω—å—à–µ), woocommerce_checkout_order_processed (40), woocommerce_order_status_processing/completed (30).
	‚Ä¢	–†–µ–¥—É–∫—Ü–∏—è: —Ç–µ –∂–µ —Å—Ç–∞—Ç—É—Å—ã, –Ω–æ (60) ‚Äî –ø–æ—Å–ª–µ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –ø–ª–∞–Ω–∞.

–ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∞–ª–≥–æ—Ä–∏—Ç–º–∞:
	‚Ä¢	—Ñ–∏–ª—å—Ç—Ä slu_allocation_plan ‚Äî –º–æ–∂–µ—à—å –≤–µ—Ä–Ω—É—Ç—å —Å–≤–æ–π [term_id => qty], —á—Ç–æ–±—ã –∏–∑–º–µ–Ω–∏—Ç—å —Å—Ç—Ä–∞—Ç–µ–≥–∏—é.

–ì–¥–µ –ø—Ä–∞–≤–∏—Ç—å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã:
	‚Ä¢	–≤ pc_build_allocation_plan() –ø–æ—Ä—è–¥–æ–∫ ‚Äî —Å–Ω–∞—á–∞–ª–∞ primary, –ø–æ—Ç–æ–º –ø–æ –∏–º–µ–Ω–∏ (–∏–ª–∏ –º–µ–Ω—è–π –Ω–∞ ‚Äú–ø–æ —É–±—ã–≤–∞–Ω–∏—é –æ—Å—Ç–∞—Ç–∫–æ–≤‚Äù).

‚∏ª
–ó–∞–¥–∞—á–∞:
	‚Ä¢	–ù–∞ —ç—Ç–∞–ø–µ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è/—Å—Ç–∞—Ç—É—Å–∞ —Å—Ç—Ä–æ–∏—Ç –ø–ª–∞–Ω —Å–ø–∏—Å–∞–Ω–∏—è –ø–æ —Å–∫–ª–∞–¥–∞–º –¥–ª—è –∫–∞–∂–¥–æ–π —Å—Ç—Ä–æ–∫–∏ –∑–∞–∫–∞–∑–∞
‚Üí –º–µ—Ç–∞ _pc_stock_breakdown = [ term_id => qty, ... ], –≤–∏–¥–∏–º–∞—è –º–µ—Ç–∞(—Å—Ç–∞—Ä–∞—è —É–∂–µ) ‚Äú–°–∫–ª–∞–¥: –ö–∏—ó–≤ √ó N, –û–¥–µ—Å–∞ √ó M‚Äù, _stock_location_id/_slug.
	‚Ä¢	–ü–æ—Ç–æ–º —Å–ø–∏—Å—ã–≤–∞–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–µ –æ—Å—Ç–∞—Ç–∫–∏ –∏–∑ –º–µ—Ç _stock_at_{term_id}, –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç _stock/_stock_status.
	‚Ä¢	–ê–Ω—Ç–∏–¥—É–±–ª—å: —Ñ–ª–∞–∂–æ–∫ _pc_stock_reduced = yes.

–•—É–∫–∏:
	‚Ä¢	–ü–ª–∞–Ω: woocommerce_new_order (—Ä–∞–Ω—å—à–µ), woocommerce_checkout_order_processed (40), woocommerce_order_status_processing/completed (30).
	‚Ä¢	–†–µ–¥—É–∫—Ü–∏—è: —Ç–µ –∂–µ —Å—Ç–∞—Ç—É—Å—ã, –Ω–æ (60) ‚Äî –ø–æ—Å–ª–µ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –ø–ª–∞–Ω–∞.

–ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∞–ª–≥–æ—Ä–∏—Ç–º–∞:
	‚Ä¢	—Ñ–∏–ª—å—Ç—Ä slu_allocation_plan ‚Äî –º–æ–∂–µ—à—å –≤–µ—Ä–Ω—É—Ç—å —Å–≤–æ–π [term_id => qty], —á—Ç–æ–±—ã –∏–∑–º–µ–Ω–∏—Ç—å —Å—Ç—Ä–∞—Ç–µ–≥–∏—é.

–ì–¥–µ –ø—Ä–∞–≤–∏—Ç—å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã:
	‚Ä¢	–≤ pc_build_allocation_plan() –ø–æ—Ä—è–¥–æ–∫ ‚Äî —Å–Ω–∞—á–∞–ª–∞ primary, –ø–æ—Ç–æ–º –ø–æ –∏–º–µ–Ω–∏ (–∏–ª–∏ –º–µ–Ω—è–π –Ω–∞ ‚Äú–ø–æ —É–±—ã–≤–∞–Ω–∏—é –æ—Å—Ç–∞—Ç–∫–æ–≤‚Äù).

‚∏ª

6) –ë–∞–∑–æ–≤—ã–π –∫–æ–Ω—Ñ–∏–≥ —è–¥—Ä–∞

–§–∞–π–ª: wp-content/plugins/paint-core/inc/Config.php (–∏–ª–∏ —Ä—è–¥–æ–º)
–ó–∞–¥–∞—á–∞/–Ω–∞—Å—Ç—Ä–æ–π–∫–∏:
	‚Ä¢	Config::DEBUG ‚Äî –≤–∫–ª—é—á–∞–µ—Ç pc_log() (–ª–æ–≥ –≤ error_log).
	‚Ä¢	Config::DISABLE_LEGACY_CART_LOCATIONS ‚Äî –æ—Ç–∫–ª—é—á–∞–µ—Ç ‚Äú—Å—Ç–∞—Ä—ã–µ‚Äù —Å—Ç—Ä–æ–∫–∏ —Å–∫–ª–∞–¥–æ–≤ –≤ –∫–æ—Ä–∑–∏–Ω–µ –∏–∑ —Å—Ç–∞—Ä–æ–≥–æ Paint Core.
	‚Ä¢	Config::ENABLE_STOCK_ALLOCATION ‚Äî –≤–∫–ª—é—á–∞–µ—Ç –Ω–æ–≤—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è.
	‚Ä¢	–•–µ–ª–ø–µ—Ä pc_log($msg) (–≤ –Ω–µ–π–º—Å–ø–µ–π—Å–µ PaintCore) ‚Äî –Ω–µ –∑–∞–±—ã–≤–∞–π use function PaintCore\pc_log; –≤ —Ñ–∞–π–ª–∞—Ö, –≥–¥–µ –∑–æ–≤—ë—à—å.

‚∏ª

7) –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Ä–µ–∂–∏–º–∞ —Å–∫–ª–∞–¥–æ–≤ (–µ—Å–ª–∏ –µ—Å—Ç—å)

–§–∞–π–ª: inc/header-allocation-switcher.php (–∏–ª–∏ –ø–æ—Ö–æ–∂–µ–µ –º–µ—Å—Ç–æ –≤ —Ç–µ–º–µ/–ø–ª–∞–≥–∏–Ω–µ)
–ó–∞–¥–∞—á–∞: UI –¥–ª—è auto/manual/single + –≤—ã–±—Ä–∞–Ω–Ω—ã–π term_id.
–í–∞–∂–Ω–æ: –ø–æ—Å–ª–µ —Å–º–µ–Ω—ã —Ä–µ–∂–∏–º–∞ –ø–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞—Ç—å PDP/–∫–∞—Ç–∞–ª–æ–≥. –ï—Å–ª–∏ –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è ‚Äî –ø—Ä–æ–≤–µ—Ä—å, —á—Ç–æ:
	‚Ä¢	—Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ö—Ä–∞–Ω–∏—Ç—Å—è (cookie/option/session?),
	‚Ä¢	—Ä–∞—Å—á—ë—Ç –≤ pc_build_stock_view() —á–∏—Ç–∞–µ—Ç –∏–º–µ–Ω–Ω–æ —ç—Ç–æ —Å–æ—Å—Ç–æ—è–Ω–∏–µ,
	‚Ä¢	–µ—Å—Ç—å —Ö—É–∫/JS, –∫–æ—Ç–æ—Ä—ã–π –¥—ë—Ä–≥–∞–µ—Ç –ø–µ—Ä–µ—Ä–∏—Å–æ–≤–∫—É (–∏–ª–∏ –æ–±—ã—á–Ω—ã–π reload).

‚∏ª

8) –¢–µ–º–∞: functions.php (–¥–æ—á–µ—Ä–Ω—è—è)

–§–∞–π–ª: wp-content/themes/generatepress-child/functions.php
–ß—Ç–æ —Ç—É—Ç —Ç–µ–ø–µ—Ä—å —Å—Ç–æ–∏—Ç –æ—Å—Ç–∞–≤–ª—è—Ç—å:
	‚Ä¢	–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Å—Ç–∏–ª–µ–π –¥–æ—á–µ—Ä–Ω–µ–π —Ç–µ–º—ã;
	‚Ä¢	–ú–µ–ª–∫–∏–µ –ø—Ä–∞–≤–∫–∏ (—Ö–ª–µ–±–Ω—ã–µ –∫—Ä–æ—à–∫–∏, –∑–∞–≥–æ–ª–æ–≤–∫–∏, –∏ —Ç.–ø.).
–ù–µ –¥–µ—Ä–∂–∏–º —Ç—É—Ç: –ª–æ–≥–∏–∫—É per-page (–≤—ã–Ω–µ—Å–µ–Ω–æ –≤ MU-–ø–ª–∞–≥–∏–Ω), —Å–µ—Ç–∫—É –º–æ–∂–Ω–æ –¥–µ—Ä–∂–∞—Ç—å –≤ style.css.

‚∏ª

–ß–∞—Å—Ç—ã–µ –∑–∞–¥–∞—á–∏ –∏ –≥–¥–µ –ø—Ä–∞–≤–∏—Ç—å
	‚Ä¢	‚Äú–ù–µ –¥–æ–±–∏–≤–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ–¥–Ω–∏–π —Ä—è–¥‚Äù: —Å–º. MU-–ø–ª–∞–≥–∏–Ω (—Ä—è–¥—ã/–∫–æ–ª–æ–Ω–∫–∏), CSS minmax, cookie psu_cols/psu_rows.
	‚Ä¢	‚Äú–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –Ω—É–ª–µ–≤–æ–π —Å–∫–ª–∞–¥‚Äù: stock-locations-ui.php ‚Üí pc_build_stock_view() ‚Äî —Ñ–∏–ª—å—Ç—Ä—É–µ–º –Ω—É–ª–∏.
	‚Ä¢	‚Äú–í –∫–æ—Ä–∑–∏–Ω–µ/—á–µ–∫–∞—É—Ç–µ –ø–ª–∞–Ω –ø–µ—Ä–µ—Å—á–∏—Ç–∞–ª—Å—è –Ω–µ —Ç–∞–∫‚Äù: —Å–º. order-allocator.php (–ø–ª–∞–Ω/—Ä–µ–¥—É–∫—Ü–∏—è), —Ñ–∏–ª—å—Ç—Ä slu_allocation_plan.
	‚Ä¢	‚Äú–•–æ—á—É –ø–µ—Ä–≤–∏—á–Ω–æ —Å–ø–∏—Å—ã–≤–∞—Ç—å –∏–∑ –û–¥–µ—Å—Å—ã‚Äù: –ª–∏–±–æ —Å–¥–µ–ª–∞–π –µ—ë primary –≤ –º–µ—Ç–∞—Ö Yoast, –ª–∏–±–æ –ø–µ—Ä–µ–ø–∏—à–∏ –ø–æ—Ä—è–¥–æ–∫ –≤ slu_allocation_plan.
	‚Ä¢	‚Äú–ö–∞—Ç–∞–ª–æ–≥ –¥–∞—ë—Ç –¥–æ–±–∞–≤–∏—Ç—å –±–æ–ª—å—à–µ, —á–µ–º –Ω–∞ –≤—ã–±—Ä–∞–Ω–Ω–æ–º —Å–∫–ª–∞–¥–µ‚Äù: —Å–µ–π—á–∞—Å –ª–∏–º–∏—Ç –∏–¥—ë—Ç –æ—Ç –æ–±—â–µ–≥–æ –æ—Å—Ç–∞—Ç–∫–∞. –ï—Å–ª–∏ –Ω–∞–¥–æ ‚Äú–ø–æ –≤—ã–±—Ä–∞–Ω–Ω–æ–º—É —Å–∫–ª–∞–¥—É‚Äù –≤ —Ä–µ–∂–∏–º–µ single, —Å–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–π pcux_available_qty()/pcux_available_for_add() (–∏–ª–∏ –¥–∞–π MU-—Ñ—É–Ω–∫—Ü–∏–∏ slu_* —É—á–∏—Ç—ã–≤–∞—Ç—å —Ç–µ–∫—É—â–∏–π —Ä–µ–∂–∏–º).

‚∏ª

–ë—ã—Å—Ç—Ä—ã–π —á–µ–∫-–ª–∏—Å—Ç (–¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞)
	1.	–í–Ω–∏–∑—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã (–µ—Å–ª–∏ PSUFP_DEBUG = true) ‚Äî —Å—Ç—Ä–æ–∫–∞ –≤–∏–¥–∞:
cols=5, rows=3, per_page=15 (–ø–æ–º–æ–≥–∞–µ—Ç –ø–æ–Ω—è—Ç—å, —á—Ç–æ –∏–º–µ–Ω–Ω–æ —Å—á–∏—Ç–∞–µ—Ç –∫–ª–∏–µ–Ω—Ç/—Å–µ—Ä–≤–µ—Ä).
	2.	–í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ ‚Äî —Å–æ–æ–±—â–µ–Ω–∏—è [PSUFP] ‚Ä¶ (–∫–æ–ª–æ–Ω–∫–∏/—Ä—è–¥—ã/–ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞).
	3.	–í PHP-–ª–æ–≥–∞—Ö ‚Äî [PSU] ‚Ä¶ –æ –ø–µ—Ä–µ—Ö–≤–∞—Ç–µ posts_per_page.
	4.	–ü—Ä–æ–≤–µ—Ä–∏—Ç—å cookie psu_cols/psu_rows.
	5.	–û—Ç–∫—Ä—ã—Ç—å devtools ‚Üí Elements: —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ .woocommerce ul.products –∏–º–µ–µ—Ç –Ω–∞—à grid-template-columns –∏ —á—Ç–æ .columns-* –Ω–µ –ª–æ–º–∞—é—Ç.

‚∏ª

–ï—Å–ª–∏ —Ö–æ—á–µ—à—å, —É–ø–∞–∫—É—é –≤—Å—ë —ç—Ç–æ –≤ –æ–¥–∏–Ω ‚Äú–∂–∏–≤–æ–π‚Äù README.md (—Å –∫–æ–¥–æ–≤—ã–º–∏ —Å–Ω–∏–ø–ø–µ—Ç–∞–º–∏), –ª–∏–±–æ –¥–æ–±–∞–≤–ª—é –≤ –∞–¥–º–∏–Ω–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É ‚Äú–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–∞—Ç–∞–ª–æ–≥–∞‚Äù, –≥–¥–µ –º–æ–∂–Ω–æ –º–µ–Ω—è—Ç—å PSUFP_ROWS_* –∏ minmax –±–µ–∑ –ª–µ–∑–∞–Ω–∏—è –≤ —Ñ–∞–π–ª—ã.
```

## 1) –£–¥–∞–ª—è–µ–º –¥—É–±–ª–∏ _stock_at_*, –æ—Å—Ç–∞–≤–ª—è—è –ø–æ—Å–ª–µ–¥–Ω—é—é –∑–∞–ø–∏—Å—å

```sql

-- A. –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å, —á—Ç–æ –∏–º–µ–Ω–Ω–æ —É–¥–∞–ª–∏–º (–ø—Ä–µ–≤—å—é TOP 20)
SELECT pm.post_id, pm.meta_key, pm.meta_id, pm.meta_value
FROM wp_postmeta pm
JOIN (
  SELECT post_id, meta_key, MAX(meta_id) AS keep_id
  FROM wp_postmeta
  WHERE meta_key REGEXP '^_stock_at_[0-9]+$'
  GROUP BY post_id, meta_key
  HAVING COUNT(*) > 1
) d ON d.post_id = pm.post_id AND d.meta_key = pm.meta_key
WHERE pm.meta_id <> d.keep_id
ORDER BY pm.post_id, pm.meta_key
LIMIT 20;

-- B. –£–¥–∞–ª–µ–Ω–∏–µ –¥—É–±–ª–µ–π (–æ—Å—Ç–∞–≤–ª—è–µ–º –∑–∞–ø–∏—Å—å —Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–º meta_id)
DELETE pm
FROM wp_postmeta pm
JOIN (
  SELECT post_id, meta_key, MAX(meta_id) AS keep_id
  FROM wp_postmeta
  WHERE meta_key REGEXP '^_stock_at_[0-9]+$'
  GROUP BY post_id, meta_key
  HAVING COUNT(*) > 1
) d ON d.post_id = pm.post_id AND d.meta_key = pm.meta_key
WHERE pm.meta_id <> d.keep_id;

```

## 2) –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º _stock —Å —Å—É–º–º–æ–π –ø–æ —Å–∫–ª–∞–¥–∞–º

–û—Å—Ç–∞–≤–ª—è–µ–º _stock (–≤—ã —Å–∞–º–∏ –ø–∏—Å–∞–ª–∏, —á—Ç–æ –Ω–∞ –Ω–µ–≥–æ –∫–æ–µ-—á—Ç–æ —Å—Å—ã–ª–∞–µ—Ç—Å—è), –Ω–æ –ø—Ä–∏–≤–æ–¥–∏–º –µ–≥–æ –∫ —Å—É–º–º–µ _stock_at_%.

```sql

-- –û–±–Ω–æ–≤–∏—Ç—å _stock —Ç–∞–º, –≥–¥–µ –æ–Ω —É–∂–µ –µ—Å—Ç—å
UPDATE wp_postmeta s
JOIN (
  SELECT post_id, SUM(CAST(meta_value AS DECIMAL(10,3))) AS sum_qty
  FROM wp_postmeta
  WHERE meta_key LIKE '_stock_at\_%'
  GROUP BY post_id
) t ON t.post_id = s.post_id
SET s.meta_value = t.sum_qty
WHERE s.meta_key = '_stock';

-- –°–æ–∑–¥–∞—Ç—å _stock —Ç–∞–º, –≥–¥–µ –µ–≥–æ –Ω–µ—Ç, –Ω–æ –µ—Å—Ç—å _stock_at_*
INSERT INTO wp_postmeta (post_id, meta_key, meta_value)
SELECT t.post_id, '_stock', t.sum_qty
FROM (
  SELECT post_id, SUM(CAST(meta_value AS DECIMAL(10,3))) AS sum_qty
  FROM wp_postmeta
  WHERE meta_key LIKE '_stock_at\_%'
  GROUP BY post_id
) t
LEFT JOIN wp_postmeta s
  ON s.post_id = t.post_id AND s.meta_key = '_stock'
WHERE s.post_id IS NULL;

```

## 3) –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞

```sql

-- –î–æ–ª–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å 0 —Å—Ç—Ä–æ–∫ (–Ω–µ—Ç –¥—É–±–ª–µ–π)
SELECT post_id, meta_key, COUNT(*) c
FROM wp_postmeta
WHERE meta_key REGEXP '^_stock_at_[0-9]+$'
GROUP BY post_id, meta_key
HAVING c > 1
ORDER BY post_id, meta_key;

-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –ø—Ä–æ–±–ª–µ–º–Ω—ã–π —Ç–æ–≤–∞—Ä (–ø—Ä–∏–º–µ—Ä: 17410)
SELECT meta_key, meta_value
FROM wp_postmeta
WHERE post_id=17410
  AND (meta_key='_stock' OR meta_key LIKE '_stock_at\_%')
ORDER BY meta_key;

```